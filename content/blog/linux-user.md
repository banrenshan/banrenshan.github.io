---
title: linux用户和权限
tags:
  - linux
categories:
  - 操作系统
  - linux
date: 2022-12-01 11:21:20
---

登陆 Linux 系统时，虽然输入的是自己的用户名和密码，但其实 Linux 并不认识你的用户名称，它只认识用户名对应的 ID 号（也就是一串数字）。

要论证 "Linux系统不认识用户名" 也很简单，网络上下载过 ".tar.gz" 或 ".tar.bz2" 格式的文件，解压缩之后的文件中，有时，你会发现文件拥有者的属性显示的是一串数字，这串数字就是用户的 ID（UID）号。之所以没有显示出用户名称，是因为找不到UID对应的用户。

Linux 系统中，每个用户的 ID 细分为 2 种，分别是用户 ID（User ID，简称 UID）和组 ID（Group ID，简称 GID），这与文件有拥有者和拥有群组两种属性相对应。

# 管理用户的文件

创建用户的时候，会默认分配与用户同名的用户组，这个创建时自动分配的用户组叫做初始组。 后面又给该用户添加的其他用户组，叫做附加组。

每个文件都有自己的拥有者 ID 和群组 ID，当显示文件属性时，系统会根据 /etc/passwd 和 /etc/group 文件中的内容，分别找到 UID 和 GID 对应的用户名和群组名，然后显示出来。

## /etc/passwd 文件

```
root@zzq:~# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
```

这些用户中的绝大多数是系统或服务正常运行所必需的用户，这种用户通常称为系统用户或伪用户。系统用户无法用来登录系统，但也不能删除，因为一旦删除，依赖这些用户运行的服务或程序就不能正常执行，会导致系统问题。  

不仅如此，每行用户信息都以 "：" 作为分隔符，划分为 7 个字段，每个字段所表示的含义如下：

用户名：密码：UID（用户ID）：GID（组ID）：描述性信息：主目录：默认Shell

### 密码

"x" 表示此用户设有密码，但不是真正的密码，真正的密码保存在 /etc/shadow 文件中。此文件只有 root 用户可以浏览和操作，这样就最大限度地保证了密码的安全。需要注意的是，虽然 "x" 并不表示真正的密码，但也不能删除，如果删除了 "x"，那么系统会认为这个用户没有密码，从而导致只输入用户名而不用输入密码就可以登陆

### UID

UID，也就是用户 ID。每个用户都有唯一的一个 UID，Linux 系统通过 UID 来识别不同的用户。 实际上，UID 就是一个 0~65535 之间的数，不同范围的数字表示不同的用户身份。

| UID 范围  | 用户身份                                                     |
| --------- | ------------------------------------------------------------ |
| 0         | 超级用户。UID 为 0 就代表这个账号是管理员账号。在 Linux 中，如何把普通用户升级成管理员呢？只需把其他用户的 UID 修改为 0 就可以了，这一点和 Windows 是不同的。不过不建议建立多个管理员账号。 |
| 1~499     | 系统用户（伪用户）。也就是说，此范围的 UID 保留给系统使用。其中，1~99 用于系统自行创建的账号；100~499 分配给有系统账号需求的用户。  其实，除了 0 之外，其他的 UID 并无不同，这里只是默认 500 以下的数字给系统作为保留账户，只是一个公认的习惯而已。 |
| 500~65535 | 普通用户。通常这些 UID 已经足够用户使用了。但不够用也没关系，2.6.x 内核之后的 Linux 系统已经可以支持 2^32^ 个 UID 了。 |

### GID

全称“Group ID”，简称“组ID”，表示用户初始组的组 ID 号。这里需要解释一下初始组和附加组的概念。  

初始组，指用户登陆时就拥有这个用户组的相关权限。每个用户的初始组只能有一个，通常就是将和此用户的用户名相同的组名作为该用户的初始组。比如说，我们手工添加用户 lamp，在建立用户 lamp 的同时，就会建立 lamp 组作为 lamp 用户的初始组。  

附加组，指用户可以加入多个其他的用户组，并拥有这些组的权限。每个用户只能有一个初始组，除初始组外，用户再加入其他的用户组，这些用户组就是这个用户的附加组。附加组可以有多个，而且用户可以有这些附加组的权限。  

举例来说，刚刚的 lamp 用户除属于初始组 lamp 外，我又把它加入了 users 组，那么 lamp 用户同时属于 lamp 组和 users 组，其中 lamp 是初始组，users 是附加组。  

当然，初始组和附加组的身份是可以修改的，但是我们在工作中不修改初始组，只修改附加组，因为修改了初始组有时会让管理员逻辑混乱。  

需要注意的是，在 /etc/passwd 文件的第四个字段中看到的 ID 是这个用户的初始组。  

### 描述性信息

这个字段并没有什么重要的用途，只是用来解释这个用户的意义而已。  

### 主目录

也就是用户登录后有操作权限的访问目录，通常称为用户的主目录。  

例如，root 超级管理员账户的主目录为 /root，普通用户的主目录为 /home/yourIDname，即在 /home/ 目录下建立和用户名相同的目录作为主目录，如 lamp 用户的主目录就是 /home/lamp/ 目录。

### 默认的Shell

Shell 就是 Linux 的命令解释器，是用户和 Linux 内核之间沟通的桥梁。  

我们知道，用户登陆 Linux 系统后，通过使用 Linux 命令完成操作任务，但系统只认识类似 0101 的机器语言，这里就需要使用命令解释器。也就是说，Shell 命令解释器的功能就是将用户输入的命令转换成系统可以识别的机器语言。  

通常情况下，Linux 系统默认使用的命令解释器是 bash（/bin/bash），当然还有其他命令解释器，例如 sh、csh 等。

在 /etc/passwd 文件中，大家可以把这个字段理解为用户登录之后所拥有的权限。如果这里使用的是 bash 命令解释器，就代表这个用户拥有权限范围内的所有权限。例如：

```
[root@localhost ~]# vi /etc/passwd
lamp:x:502:502::/home/lamp:/bin/bash
```

我手工添加了 lamp 用户，它使用的是 bash 命令解释器，那么这个用户就可以使用普通用户的所有权限。  

如果我把 lamp 用户的 Shell 命令解释器修改为 /sbin/nologin，那么，这个用户就不能登录了，例如：

```
[root@localhost ~]# vi /etc/passwd
lamp:x:502:502::/home/lamp:/sbin/nologin
```

因为 /sbin/nologin 就是禁止登录的 Shell。同样，如果我在这里放入的系统命令，如 /usr/bin/passwd，例如：

```
[root@localhost ~]#vi /etc/passwd
lamp:x:502:502::/home/lamp:/usr/bin/passwd
```

那么这个用户可以登录，但登录之后就只能修改自己的密码。但是，这里不能随便写入和登陆没有关系的命令（如 ls），系统不会识别这些命令，同时也就意味着这个用户不能登录。

## /etc/shadow 文件

存储 Linux 系统中用户的密码信息，又称为“影子文件”。只有 root 用户拥有读权限，其他用户没有任何权限，这样就保证了用户密码的安全性。

```
kibana:*:19068:0:99999:7:::
elastic:$6$jylN2qTRibNDyZEP$W3BZjYRU5fwTBx4Fy4gB04qZh82q4GGcT4x8jqosTgs7FvIJ2ia.LVUy01whTPe45j6RqM.C.BuuxYGp8SZH9.:19068:0:99999:7:::
elasticsearch:!:19068:0:99999:7:::
wang:!:19102:0:99999:7:::
wang2:!:19102:0:99999:7:::
```

每行用户信息被划分为 9 个字段，格式如下：

用户名：加密密码：最后一次修改时间：最小修改时间间隔：密码有效期：密码需要变更前的警告天数：密码过期后的宽限时间：账号失效时间：保留字段

所有伪用户的密码都是 ! 或 *，代表没有密码是不能登录的。当然，新创建的用户如果不设定密码，那么它的密码项也是 !，代表这个用户没有密码，不能登录。

### 最后一次修改时间

此字段表示最后一次修改密码的时间，可是，为什么 root 用户显示的是 15775 呢？  

这是因为，Linux 计算日期的时间是以 1970 年 1 月 1 日作为 1 不断累加得到的时间，到 1971 年 1 月 1 日，则为 366 天。这里显示 15775 天，也就是说，此 root 账号在 1970 年 1 月 1 日之后的第 15775 天修改的 root 用户密码。

### 最小修改时间间隔

最小修改间隔时间，也就是说，该字段规定了从第 3 字段（最后一次修改密码的日期）起，多长时间之内不能修改密码。如果是 0，则密码可以随时修改；如果是 10，则代表密码修改后 10 天之内不能再次修改密码。

### 密码有效期

为了强制要求用户变更密码，这个字段可以指定距离第 3 字段（最后一次更改密码）多长时间内需要再次变更密码，否则该账户密码进行过期处理。该字段的默认值为 99999，也就是 273 年，可认为是永久生效。如果改为 90，则表示密码被修改 90 天之后必须再次修改，否则该用户即将过期。管理服务器时，通过这个字段强制用户定期修改密码。

### 密码需要变更前的警告天数

当账户密码有效期快到时，系统会发出警告信息给此账户，提醒用户 "再过 n 天你的密码就要过期了，请尽快重新设置你的密码！"。  

该字段的默认值是 7，也就是说，距离密码有效期的第 7 天开始，每次登录系统都会向该账户发出 "修改密码" 的警告信息。  

### 密码过期后的宽限天数

也称为“口令失效日”，简单理解就是，在密码过期后，用户如果还是没有修改密码，则在此字段规定的宽限天数内，用户还是可以登录系统的；如果过了宽限天数，系统将不再让此账户登陆，也不会提示账户过期，是完全禁用。  

比如说，此字段规定的宽限天数是 10，则代表密码过期 10 天后失效；如果是 0，则代表密码过期后立即失效；如果是 -1，则代表密码永远不会失效。  

### 账号失效时间

使用自 1970 年 1 月 1 日以来的总天数作为账户的失效时间。该字段表示，账号在此字段规定的时间之外，不论你的密码是否过期，都将无法使用！  

该字段通常被使用在具有收费服务的系统中。  

### 保留

这个字段目前没有使用，等待新功能的加入。

### 忘记密码怎么办

对于普通账户的密码遗失，可以通过 root 账户解决，它会重新给你配置好指定账户的密码，而不需知道你原有的密码（利用 root 的身份使用 passwd 命令即可）。

如果 root 账号的密码遗失，则需要重新启动进入单用户模式，系统会提供 root 权限的 bash 接口，此时可以用 passwd 命令修改账户密码；也可以通过挂载根目录，修改 /etc/shadow，将账户的 root 密码清空的方法。

## /etc/group文件

用户组配置文件，即用户组的所有信息都存放在此文件中。

```
kibana:x:120:
elastic:x:1000:
elasticsearch:x:1001:
wang:x:1002:
wang2:x:1003:
```

分为 4 个字段，每个字段对应的含义为：

组名：密码：GID：该用户组中的用户列表

### 组密码

和 /etc/passwd 文件一样，这里的 "x" 仅仅是密码标识，真正加密后的组密码默认保存在 /etc/gshadow 文件中。  

不过，用户设置密码是为了验证用户的身份，那用户组设置密码是用来做什么的呢？用户组密码主要是用来指定组管理员的，由于系统中的账号可能会非常多，root 用户可能没有时间进行用户的组调整，这时可以给用户组指定组管理员，如果有用户需要加入或退出某用户组，可以由该组的组管理员替代 root 进行管理。但是这项功能目前很少使用，我们也很少设置组密码。如果需要赋予某用户调整某个用户组的权限，则可以使用 sudo 命令代替。

### 组中的用户

此字段列出每个群组包含的所有用户。需要注意的是，如果该用户组是这个用户的初始组，则该用户不会写入这个字段，可以这么理解，该字段显示的用户都是这个用户组的附加用户。  

一般情况下，用户的初始组就是在建立用户的同时建立的和用户名相同的组。

## /etc/login.defs文件

用于在创建用户时，对用户的一些基本属性做默认设置，例如指定用户 UID 和 GID 的范围，用户的过期时间，密码的最大长度，等等。  

需要注意的是，该文件的用户默认配置对 root 用户无效。并且，当此文件中的配置与 /etc/passwd 和 /etc/shadow 文件中的用户信息有冲突时，系统会以/etc/passwd 和 /etc/shadow 为准。

| 设置项                   | 含义                                                         |
| ------------------------ | ------------------------------------------------------------ |
| MAIL_DIR /var/spool/mail | 创建用户时，系统会在目录 /var/spool/mail 中创建一个用户邮箱， 比如 lamp 用户的邮箱是 /var/spool/mail/lamp。 |
| PASS_MAX_DAYS 99999      | 密码有效期，99999 是自 1970 年 1 月 1 日起密码有效的天数， 相当于 273 年，可理解为密码始终有效。 |
| PASS_MIN_DAYS 0          | 表示自上次修改密码以来，最少隔多少天后用户才能再次修改密码， 默认值是 0。 |
| PASS_MIN_LEN 5           | 指定密码的最小长度，默认不小于 5 位，但是现在用户登录时验证 已经被 PAM 模块取代，所以这个选项并不生效。 |
| PASS_WARN_AGE 7          | 指定在密码到期前多少天，系统就开始通过用户密码即将到期，默认 为 7 天。 |
| UID_MIN 500              | 指定最小 UID 为 500，也就是说，添加用户时，默认 UID 从 500 开始。 注意，如果手工指定了一个用户的 UID 是 550，那么下一个创建的用户的 UID 就会从 551 开始，哪怕 500~549 之间的 UID 没有使用。 |
| UID_MAX 60000            | 指定用户最大的 UID 为 60000。                                |
| GID_MIN 500              | 指定最小 GID 为 500，也就是在添加组时，组的 GID 从 500 开始。 |
| GID_MAX 60000            | 用户 GID 最大为 60000。                                      |
| CREATE_HOME yes          | 指定在创建用户时，是否同时创建用户主目录，yes 表示创建，no 则不 创建，默认是 yes。 |
| UMASK 077                | 用户主目录的权限默认设置为 077。                             |
| USERGROUPS_ENAB yes      | 指定删除用户的时候是否同时删除用户组，准备地说，这里指的是删除 用户的初始组，此项的默认值为 yes。 |
| ENCRYPT_METHOD SHA512    | 指定用户密码采用的加密规则，默认采用 SHA512，这是新的密码 加密模式，原先的 Linux 只能用 DES 或 MD5 加密。 |

# 管理用户的命令

## 创建用户

使用 useradd 命令新建用户，该命令常用的选项如下:

| 选项        | 含义                                                         |
| ----------- | ------------------------------------------------------------ |
| -u UID      | 手工指定用户的 UID，注意 UID 的范围（不要小于 500）。        |
| -d 主目录   | 手工指定用户的主目录。主目录必须写绝对路径，而且如果 需要手工指定主目录，则一定要注意权限； |
| -c 用户说明 | 手工指定/etc/passwd文件中第 5 个字段的描述性内容             |
| -g 组名     | 手工指定用户的初始组。一般以和用户名相同的组作为用户 的初始组，在创建用户时会默认建立初始组。一旦手动指定， 则系统将不会创建此默认的初始组目录。 |
| -G 组名     | 指定用户的附加组。我们把用户加入其他组，一般都使用附加组；   |
| -s shell    | 手工指定用户的登录 Shell，默认是 /bin/bash；                 |
| -e 曰期     | 指定用户的失效曰期，格式为 "YYYY-MM-DD"。 也就是 /etc/shadow 文件的第八个字段； |
| -o          | 允许创建的用户的 UID 相同。例如，执行 "useradd -u 0 -o usertest" 命令 建立用户 usertest，它的 UID 和 root 用户的 UID 相同，都是 0； |
| -m          | 建立用户时强制建立用户的家目录。在建立系统用户时，该选项是默认的； |
| -r          | 创建系统用户，也就是 UID 在 1~499 之间，供系统程序使用的用户。由于 系统用户主要用于运行系统所需服务的权限配置，因此系统用户的创建默认 不会创建主目录。 |

其实，系统已经帮我们规定了非常多的默认值，在没有特殊要求下，无需使用任何选项即可成功创建用户。例如：

```
root@zzq:~# useradd  lamp 
```

不要小看这条简单的命令，它会完成以下几项操作：

1. 在 /etc/passwd 文件中创建一行与 lamp 用户相关的数据

2. 在 /etc/shadow 文件中新增了一行与 lamp 用户密码相关的数据
3. 在 /etc/group 文件中创建一行与用户名一模一样的群组
4. 在 /etc/gshadow 文件中新增一行与新增群组相关的密码信息
5. 创建用户的主目录（/home/lamp/目录）和邮箱（/var/spool/mail/lamp文件）
6. 将 /etc/skel 目录中的配置文件复制到新用户的主目录中

useradd 命令在添加用户时参考的默认值文件主要有两个，分别是 /etc/default/useradd 和 /etc/login.defs。

```
[root@localhost ~]#vim /etc/default/useradd
# useradd defaults file
GR0UP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes
```

| 参数                  | 含义                                                         |
| --------------------- | ------------------------------------------------------------ |
| GR0UP=100             | 这个选项用于建立用户的默认组，也就是说，在添加每个用户时， 用户的初始组就是 GID 为 100 的这个用户组。但 CentOS 并不 是这样的，而是在添加用户时会自动建立和用户名相同的组作为 此用户的初始组。也就是说这个选项并不会生效。  Linux 中默认用户组有两种机制：一种是私有用户组机制，系统会创建 一个和用户名相同的用户组作为用户的初始组；另一种是公共用户组机制， 系统用 GID 是 100 的用户组作为所有新建用户的初始组。目前我们采用的 是私有用户组机制。 |
| HOME=/home            | 指的是用户主目录的默认位置，所有新建用户的主目录默认都在 /home/ 下，刚刚新建的 lamp1 用户的主目录就为 /home/lamp1/。 |
| INACTIVE=-1           | 指的是密码过期后的宽限天数，也就是 /etc/shadow 文件的第七个字段。 这里默认值是 -1，代表所有新建立的用户密码永远不会失效。 |
| EXPIRE=               | 表示密码失效时间，也就是 /etc/shadow 文件的第八个字段。默认值是空， 代表所有新建用户没有失效时间，永久有效。 |
| SHELL=/bin/bash       | 表示所有新建立的用户默认 Shell 都是 /bin/bash。              |
| SKEL=/etc/skel        | 在创建一个新用户后，你会发现，该用户主目录并不是空目录，而是有 .bash_profile、.bashrc 等文件，这些文件都是从 /etc/skel 目录中自动 复制过来的。因此，更改 /etc/skel 目录下的内容就可以改变新建用户默认 主目录中的配置文件信息。 |
| CREATE_MAIL_SPOOL=yes | 指的是给新建用户建立邮箱，默认是创建。也就是说，对于所有的新建用户， 系统都会新建一个邮箱，放在 /var/spool/mail/ 目录下，和用户名相同。 例如，lamp1 的邮箱位于 /var/spool/mail/lamp1。 |

## 修改用户密码

普通用户只能使用 passwd 命令修改自己的密码，而不能修改其他用户的密码。并且，普通用户修改自己的密码需要先输入自己的旧密码，只有旧密码输入正确才能输入新密码。另外，此种修改方式对密码的复杂度有严格的要求，新密码太短、太简单，都会被系统检测出来并禁止用户使用。

root用户则没有上述限制。

```shell
# 查询密码信息，也就是 /etc/shadow 文件中此用户密码的内容。
# 仅 root 用户可用；
root@zzq:/var/spool/mail# passwd -S zzq
zzq P 04/20/2022 0 99999 7 -1

# 锁定用户，仅 root 用户可用
# 该选项会在 /etc/shadow 文件中指定用户的加密密码串前添加 "!"，使密码失效。
root@zzq:/var/spool/mail# passwd -l zzq
passwd: password expiry information changed.

# 解锁用户，仅 root 用户可用
root@zzq:/var/spool/mail# passwd -u zzq
passwd: password expiry information changed.

#调用管道符，给 lamp 用户设置密码 "123"
[root@localhost ~]# echo "123" | passwd --stdin lamp
```

除了 passwd -S 命令可以查看用户的密码信息外，还可以利用 chage 命令，它可以显示更加详细的用户密码信息，并且和 passwd 命令一样，提供了修改用户密码信息的功能。此外，还可以强制用户在第一次登录后，必须先修改密码，并利用新密码重新登陆系统。下面演示这个示例：

```shell
#创建新用户 lamp
[root@localhost ~]#useradd lamp
#设置用户初始密码为 lamp
[root@localhost ~]#echo "lamp" | passwd --stdin lamp
#通过chage命令设置此账号密码创建的日期为 1970 年 1 月 1 日（0 就表示这一天），这样用户登陆后就必须修改密码
[root@localhost ~]#chage -d 0 lamp
```

我们尝试用 lamp 用户登陆系统：

```shell
local host login:lamp
Password:     <--输入密码登陆
You are required to change your password immediately (root enforced)
changing password for lamp.     <--有一些提示，就是说明 root 强制你登录后修改密码
(current)UNIX password:
#输入旧密码
New password:
Retype new password:
#输入两次新密码
```

## 删除用户

userdel 命令功能很简单，就是删除用户的相关数据。此命令只有 root 用户才能使用。

```
# -r 选项表示在删除用户的同时删除用户的家目录。
userdel -r zzq
```

## 修改用户信息

方式有两种：

- 使用 Vim 文本编辑器手动修改涉及用户信息的相关文件（/etc/passwd、/etc/shadow、/etc/group、/etc/gshadow）

-  usermod 命令专门用于修改用户信息。

这里一定要分清 useradd 命令和 usermod 命令的区别，前者用于添加用户，当然，添加用户时可以对用户信息进行定制；后者针对与已存在的用户，使用该命令可以修改它们的信息。

主要选项：

- -c 用户说明：修改用户的说明信息，即修改 /etc/passwd 文件目标用户信息的第 5 个字段；

- -d 主目录：修改用户的主目录，即修改 /etc/passwd 文件中目标用户信息的第 6 个字段，需要注意的是，主目录必须写绝对路径；

- -e 日期：修改用户的失效曰期，格式为 "YYYY-MM-DD"，即修改 /etc/shadow 文件目标用户密码信息的第 8 个字段；

- -g 组名：修改用户的初始组，即修改 /etc/passwd 文件目标用户信息的第 4 个字段（GID）；

- -u UID：修改用户的UID，即修改 /etc/passwd 文件目标用户信息的第 3 个字段（UID）；

- -G 组名：修改用户的附加组，其实就是把用户加入其他用户组，即修改 /etc/group 文件；

- -l 用户名：修改用户名称；

- -L：临时锁定用户（Lock）；

- -U：解锁用户（Unlock），和 -L 对应；

- -s shell：修改用户的登录 Shell，默认是 /bin/bash。

## 查看用户和用户组

查看用户是否存在

```shell
# gid(初始组ID), groups是用户所在的所有组
root@zzq:~# id wang
uid=1002(wang) gid=1002(wang) groups=1002(wang)
```

## 用户切换

### su

su 是最简单的用户切换命令，通过该命令可以实现任何身份的切换，包括从普通用户切换为 root 用户、从 root 用户切换为普通用户以及普通用户之间的切换。

普通用户之间切换以及普通用户切换至 root 用户，都需要知晓对方的密码，只有正确输入密码，才能实现切换；从 root 用户切换至其他用户，无需知晓对方密码，直接可切换成功。

重要选项：

- -：当前用户不仅切换为指定用户的身份，同时所用的工作环境也切换为此用户的环境（包括 PATH 变量、MAIL 变量等），使用 - 选项可省略用户名，默认会切换为 root 用户。

- -l：同 - 的使用类似，也就是在切换用户身份的同时，完整切换工作环境，但后面需要添加当前账号。

- -p：表示切换为指定用户的身份，但不改变当前的工作环境（不使用切换用户的配置文件）。

- -m：和 -p 一样；

- -c 命令：仅切换用户执行一次命令，执行后自动切换回来，该选项后通常会带有要执行的命令。

注意，使用 su 命令时，有 - 和没有 - 是完全不同的，- 选项表示在切换用户身份的同时，连当前使用的环境变量也切换成指定用户的。我们知道，环境变量是用来定义操作系统环境的，因此如果系统环境没有随用户身份切换，很多命令无法正确执行。  

举个例子，普通用户 lamp 通过 su 命令切换成 root 用户，但没有使用 - 选项，这样情况下，虽然看似是 root 用户，但系统中的 `$PATH` 环境变量依然是 lamp 的（而不是 root 的），因此当前工作环境中，并不包含 /sbin、/usr/sbin等超级用户命令的保存路径，这就导致很多管理员命令根本无法使用。不仅如此，当 root 用户接受邮件时，会发现收到的是 lamp 用户的邮件，因为环境变量 $MAIL 也没有切换。

示例：使用别的用户执行命令

```shell
su - zzq -c "ls /etc"
```

### sudo







## 查看当前登录用户

whoami 命令打印当前执行操作的用户名

who am i 命令打印登陆当前 Linux 系统的用户名

```shell
[Cyuyan@localhost ~]$ whoami
Cyuyan
[Cyuyan@localhost ~]$ who am i
Cyuyan    pts/0    2017-10-09 15:30 (:0.0)

[Cyuyan@localhost ~] su - root
[root@localhost ~]$ whoami
root
[root@localhost ~]$ who am i
Cyuyan    pts/0    2017-10-09 15:30 (:0.0)
```

也就是说，使用 su 或者 sudo 命令切换用户身份，骗得过 whoami，但骗不过 who am i。要解释这背后的运行机制，需要搞清楚什么是实际用户（UID）和有效用户（EUID，即 Effective UID）。

所谓实际用户，指的是登陆 Linux 系统时所使用的用户，因此在整个登陆会话过程中，实际用户是不会发生变化的；而有效用户，指的是当前执行操作的用户，也就是说真正决定权限高低的用户，这个是能够利用 su 或者 sudo 命令进行任意切换的。  

一般情况下，实际用户和有效用户是相同的，如果出现用户身份切换的情况，它们会出现差异。需要注意的是，实际用户和有效用户出现差异，切换用户并不是唯一的触发机制，至于其他的触发条件，后续章节会做详细介绍。



## **使用 compgen 查看存在的用户**

如果只想列出用户名（而不包含其他的附加信息），可以使用带有 -u 选项的 compgen 命令：
```
compgen -u
```

其输出如下：
```
$ compgen -u
root
daemon
bin
sys
sync
games
man
lp
mail
```

## **列出所有在线用户**

如果我们想要查看当前哪些用户已经登录到当前的 Linux 系统中，可以使用 who 命令，它将会列出当前已连接到系统中的用户名与其活动会话：

```shell

user@system:~$ who
johndoe   :0           2019-01-28 21:35 (:0)
harrysmith   pts/0        2019-02-01 09:51 (192.168.1.1)
stevejones   pts/1        2019-02-02 09:51 (192.168.1.173)
```

上述输出不仅会列出已连接到系统的用户名，而且还会显示其是如何连接的，以及何时、从何处开始连接的。

1. 第一列即为用户名。
2. 第二列显示它的连接类型；如果是“:N”形式的，其中N是一个数字，那么表示是使用图形用户界面（GUI）或桌面会话，比如Gnome，XDE等；如果显示的是“pts/N”形式的，其中N是一个数字，则表示它是通过 ssh 协议（命令行）建立的连接。
3. 第三列显示其连接到系统的开始时间（日期和时间）；第四列和最后一列显示连接的位置，如果是远程连接，它会显示进行连接的IP地址，如果是本地（如GUI），它会显示 "(:N)"，其中 N 是本列中的会话编号，与第二列中的编号相匹配。



## 用户组命令

添加用户组：groupadd

- -g GID：指定组 ID；

- -r：创建系统群组。

修改用户组：groupmod

- -g GID：修改组 ID；

- -n 新组名：修改组名；groupmod -n newgroup oldgroup

删除用户组：groupdel

- 如果有群组还是某用户的初始群组，则无法使用 groupdel 命令成功删除
