<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.36" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://banrenshan.github.io/Spring/spring%E4%BA%8B%E5%8A%A1.html"><meta property="og:site_name" content="心之所向，素履以往"><meta property="og:title" content="Spring 事务"><meta property="og:description" content="Spring 事务模型的优势 传统上，EE应用程序开发人员对事务管理有两种选择：全局事务或本地事务，这两种选择都有深刻的局限性。在接下来的两个部分中，将回顾全局和本地事务管理，然后讨论Spring Framework的事务管理支持如何解决全局和本地交易模型的局限性。 全局事务 全局事务允许您使用多个事务资源，通常是关系数据库和消息队列。应用服务器通过J..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-24T08:19:31.000Z"><meta property="article:author" content="banrenshan"><meta property="article:tag" content="Spring"><meta property="article:tag" content="事务"><meta property="article:published_time" content="2023-10-08T00:00:00.000Z"><meta property="article:modified_time" content="2024-04-24T08:19:31.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring 事务","image":[""],"datePublished":"2023-10-08T00:00:00.000Z","dateModified":"2024-04-24T08:19:31.000Z","author":[{"@type":"Person","name":"banrenshan","url":"https://github.com/banrenshan"}]}</script><title>Spring 事务 | 心之所向，素履以往</title><meta name="description" content="Spring 事务模型的优势 传统上，EE应用程序开发人员对事务管理有两种选择：全局事务或本地事务，这两种选择都有深刻的局限性。在接下来的两个部分中，将回顾全局和本地事务管理，然后讨论Spring Framework的事务管理支持如何解决全局和本地交易模型的局限性。 全局事务 全局事务允许您使用多个事务资源，通常是关系数据库和消息队列。应用服务器通过J...">
    <link rel="preload" href="/assets/style-wL6mR3b5.css" as="style"><link rel="stylesheet" href="/assets/style-wL6mR3b5.css">
    <link rel="modulepreload" href="/assets/app-JRZgQj53.js"><link rel="modulepreload" href="/assets/spring事务.html-B7sDNLtI.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-CtorWC6w.js" as="script"><link rel="prefetch" href="/assets/go-Context.html-DbeLFt-q.js" as="script"><link rel="prefetch" href="/assets/go命令行.html--H5zpWbr.js" as="script"><link rel="prefetch" href="/assets/go基础.html-BmpbClAf.js" as="script"><link rel="prefetch" href="/assets/go并发.html-Cr5FEon6.js" as="script"><link rel="prefetch" href="/assets/go标准库-json.html-CEqgudhU.js" as="script"><link rel="prefetch" href="/assets/go标准库-time.html-CJUYz9Ju.js" as="script"><link rel="prefetch" href="/assets/go模块.html-By9Z7-ur.js" as="script"><link rel="prefetch" href="/assets/go泛型.html-DUlIkcry.js" as="script"><link rel="prefetch" href="/assets/go环境.html-BEoA1Gyf.js" as="script"><link rel="prefetch" href="/assets/go面向对象.html-CAHN_AG_.js" as="script"><link rel="prefetch" href="/assets/k8s-client-go.html-DsfMvQcd.js" as="script"><link rel="prefetch" href="/assets/虚拟环境.html-szaqHjcj.js" as="script"><link rel="prefetch" href="/assets/ews邮箱.html-O2YQOdSH.js" as="script"><link rel="prefetch" href="/assets/gradle.html-DG6N0Bng.js" as="script"><link rel="prefetch" href="/assets/gradle高级.html-Dqkhgnca.js" as="script"><link rel="prefetch" href="/assets/spring-gradle插件.html-rct5X4f9.js" as="script"><link rel="prefetch" href="/assets/spring-http-interface.html-D8TgQJfo.js" as="script"><link rel="prefetch" href="/assets/spring-resource.html-Drp10MNX.js" as="script"><link rel="prefetch" href="/assets/spring-restclient.html-DTfcm4N5.js" as="script"><link rel="prefetch" href="/assets/spring-resttemplate.html-q-pCQ1tC.js" as="script"><link rel="prefetch" href="/assets/spring-webclient.html-Dz_5u1Jf.js" as="script"><link rel="prefetch" href="/assets/spring-容器基础.html-CO4zONOY.js" as="script"><link rel="prefetch" href="/assets/spring-容器高级.html-Bo540B5I.js" as="script"><link rel="prefetch" href="/assets/spring-类型转换.html-CgNnLyvT.js" as="script"><link rel="prefetch" href="/assets/spring-表达式.html-DHq9ECbc.js" as="script"><link rel="prefetch" href="/assets/校验注解.html-DGWXeQVJ.js" as="script"><link rel="prefetch" href="/assets/helm.html-BFYXfCy5.js" as="script"><link rel="prefetch" href="/assets/istio.html-i_eFmMoC.js" as="script"><link rel="prefetch" href="/assets/minikube.html-DswO5Gji.js" as="script"><link rel="prefetch" href="/assets/AirFlow.html-Dcqwvhrv.js" as="script"><link rel="prefetch" href="/assets/ER图.html-DiZFHDht.js" as="script"><link rel="prefetch" href="/assets/Resilience4j.html-D3U8vyrV.js" as="script"><link rel="prefetch" href="/assets/filebeat.html-CPYuG9kG.js" as="script"><link rel="prefetch" href="/assets/go语言.html-2FBNo6Eo.js" as="script"><link rel="prefetch" href="/assets/gradle-basic.html-CVibnDMk.js" as="script"><link rel="prefetch" href="/assets/gradle-depedency.html-CUIUd6tP.js" as="script"><link rel="prefetch" href="/assets/gradle-java.html-DA-HWVYD.js" as="script"><link rel="prefetch" href="/assets/grafana-1.html-DTPLiGvv.js" as="script"><link rel="prefetch" href="/assets/grafana.html-DetA8TP1.js" as="script"><link rel="prefetch" href="/assets/java接口.html-DyS76HoL.js" as="script"><link rel="prefetch" href="/assets/java日期.html-CJ-p7KDb.js" as="script"><link rel="prefetch" href="/assets/java注解.html-DCgLlPRs.js" as="script"><link rel="prefetch" href="/assets/loki.html-DP6Fhc2z.js" as="script"><link rel="prefetch" href="/assets/nginx.html-BV8p8uEa.js" as="script"><link rel="prefetch" href="/assets/remoteConnection.html-C4D2vwjQ.js" as="script"><link rel="prefetch" href="/assets/zero-copy.html-BElFFCQV.js" as="script"><link rel="prefetch" href="/assets/多线程-Exchanger.html-9IHwn_Rq.js" as="script"><link rel="prefetch" href="/assets/00-金融知识.html-6zeMp-sJ.js" as="script"><link rel="prefetch" href="/assets/01-flyway.html-Dy5Mjnrf.js" as="script"><link rel="prefetch" href="/assets/02-jsonassert.html-C-o6QzkK.js" as="script"><link rel="prefetch" href="/assets/03-Junit5.html-TvB4XW72.js" as="script"><link rel="prefetch" href="/assets/04-mocktio.html-1p-pLYQM.js" as="script"><link rel="prefetch" href="/assets/05-jsonpath.html-DgLLIYrk.js" as="script"><link rel="prefetch" href="/assets/06-spring-cloud-common.html-DD5YlQBL.js" as="script"><link rel="prefetch" href="/assets/07-oracle.html-CapgyQLF.js" as="script"><link rel="prefetch" href="/assets/08-快捷键.html-BSs3si8s.js" as="script"><link rel="prefetch" href="/assets/09-编程规范.html-CDy6xnlO.js" as="script"><link rel="prefetch" href="/assets/10-多线程.html-tFfitW5o.js" as="script"><link rel="prefetch" href="/assets/11-分布式事务.html-_KIsCt8a.js" as="script"><link rel="prefetch" href="/assets/12-autosys.html-BPMK2ZzU.js" as="script"><link rel="prefetch" href="/assets/13-spring-retry官方指南.html-BYl0jhAv.js" as="script"><link rel="prefetch" href="/assets/14-spring-integration.html-4RcWHUXp.js" as="script"><link rel="prefetch" href="/assets/15-Hibernate.html-CIGRCc2c.js" as="script"><link rel="prefetch" href="/assets/16-开发环境.html-TFFzF7XH.js" as="script"><link rel="prefetch" href="/assets/17-OpenShift路由.html-Cb3H2FdA.js" as="script"><link rel="prefetch" href="/assets/mysql优化.html-DQpz7Nh_.js" as="script"><link rel="prefetch" href="/assets/mysql索引.html-BSpPnpIV.js" as="script"><link rel="prefetch" href="/assets/mysql运维和监控.html-Bz2V6psA.js" as="script"><link rel="prefetch" href="/assets/mysql高级.html-CnPEIS1b.js" as="script"><link rel="prefetch" href="/assets/spring-data-jpa.html-D8xqor3E.js" as="script"><link rel="prefetch" href="/assets/spring-data-redis.html-kQtPEEzW.js" as="script"><link rel="prefetch" href="/assets/Vscode.html-oEEpXGNr.js" as="script"><link rel="prefetch" href="/assets/git.html-CVvw056D.js" as="script"><link rel="prefetch" href="/assets/openrewrite.html-DiYaeant.js" as="script"><link rel="prefetch" href="/assets/代理.html-BhjraMUZ.js" as="script"><link rel="prefetch" href="/assets/404.html-CK7rVGj_.js" as="script"><link rel="prefetch" href="/assets/index.html-5qvTlPeh.js" as="script"><link rel="prefetch" href="/assets/index.html-B-VcbQwD.js" as="script"><link rel="prefetch" href="/assets/index.html-DElhgt-X.js" as="script"><link rel="prefetch" href="/assets/index.html-OyJvgNTS.js" as="script"><link rel="prefetch" href="/assets/index.html-BmEDTm3k.js" as="script"><link rel="prefetch" href="/assets/index.html-DOW90v9K.js" as="script"><link rel="prefetch" href="/assets/index.html-DqB442cc.js" as="script"><link rel="prefetch" href="/assets/index.html-BVc6ZR3u.js" as="script"><link rel="prefetch" href="/assets/index.html-CNLvXym9.js" as="script"><link rel="prefetch" href="/assets/index.html-DDhkgfIW.js" as="script"><link rel="prefetch" href="/assets/index.html-Bk72ABJ2.js" as="script"><link rel="prefetch" href="/assets/index.html-BEVqKWGT.js" as="script"><link rel="prefetch" href="/assets/index.html-AZhwcInF.js" as="script"><link rel="prefetch" href="/assets/index.html-DyAtwAvg.js" as="script"><link rel="prefetch" href="/assets/index.html-1tXQJlXB.js" as="script"><link rel="prefetch" href="/assets/index.html-CNLvXym9.js" as="script"><link rel="prefetch" href="/assets/index.html-C_B2F1IX.js" as="script"><link rel="prefetch" href="/assets/index.html-CgfTfz2L.js" as="script"><link rel="prefetch" href="/assets/index.html-D7_HdpeH.js" as="script"><link rel="prefetch" href="/assets/index.html-DQn0C6fR.js" as="script"><link rel="prefetch" href="/assets/index.html-BEVqKWGT.js" as="script"><link rel="prefetch" href="/assets/index.html-BohMs0AY.js" as="script"><link rel="prefetch" href="/assets/index.html-v93uvn1B.js" as="script"><link rel="prefetch" href="/assets/index.html-Db3RggyC.js" as="script"><link rel="prefetch" href="/assets/index.html-BOpVmAvQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CdS7tJDo.js" as="script"><link rel="prefetch" href="/assets/index.html-DXDhl1nB.js" as="script"><link rel="prefetch" href="/assets/index.html-Dd3TfSfn.js" as="script"><link rel="prefetch" href="/assets/index.html-AZhwcInF.js" as="script"><link rel="prefetch" href="/assets/index.html-C2s9phL9.js" as="script"><link rel="prefetch" href="/assets/index.html-DRiXpwx2.js" as="script"><link rel="prefetch" href="/assets/index.html-Dw4lurYW.js" as="script"><link rel="prefetch" href="/assets/index.html-AxoFDqdN.js" as="script"><link rel="prefetch" href="/assets/index.html-DAAONmqq.js" as="script"><link rel="prefetch" href="/assets/index.html-9PH2V_PU.js" as="script"><link rel="prefetch" href="/assets/index.html-XrcNjEHe.js" as="script"><link rel="prefetch" href="/assets/index.html-B4rh0UdE.js" as="script"><link rel="prefetch" href="/assets/index.html-DGQxqaDB.js" as="script"><link rel="prefetch" href="/assets/index.html-B4rh0UdE.js" as="script"><link rel="prefetch" href="/assets/index.html-CAO-TUB4.js" as="script"><link rel="prefetch" href="/assets/index.html-D0sjJbR8.js" as="script"><link rel="prefetch" href="/assets/index.html-jBzF6ZLO.js" as="script"><link rel="prefetch" href="/assets/index.html-Bb8RLsbe.js" as="script"><link rel="prefetch" href="/assets/index.html-D9k4b5Sz.js" as="script"><link rel="prefetch" href="/assets/index.html-CiVbn4vy.js" as="script"><link rel="prefetch" href="/assets/index.html-DnrJ0Ga8.js" as="script"><link rel="prefetch" href="/assets/index.html-rYqsa-I3.js" as="script"><link rel="prefetch" href="/assets/index.html-Bl7_hpiY.js" as="script"><link rel="prefetch" href="/assets/index.html-Cz7YQ7hB.js" as="script"><link rel="prefetch" href="/assets/index.html-DIOKOTOA.js" as="script"><link rel="prefetch" href="/assets/index.html-CDzQm1cS.js" as="script"><link rel="prefetch" href="/assets/index.html-D1oHVURu.js" as="script"><link rel="prefetch" href="/assets/index.html-C_XVSHdx.js" as="script"><link rel="prefetch" href="/assets/index.html-ezgsA2LC.js" as="script"><link rel="prefetch" href="/assets/index.html-CTFFYV3d.js" as="script"><link rel="prefetch" href="/assets/index.html-ImlLvyS9.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Sah1fv.js" as="script"><link rel="prefetch" href="/assets/index.html-B4hUiRxa.js" as="script"><link rel="prefetch" href="/assets/index.html-CuoXvQN-.js" as="script"><link rel="prefetch" href="/assets/index.html-CZh0whai.js" as="script"><link rel="prefetch" href="/assets/index.html-BEc26_x_.js" as="script"><link rel="prefetch" href="/assets/index.html-Ct8UvmHm.js" as="script"><link rel="prefetch" href="/assets/index.html-B7-ERYyu.js" as="script"><link rel="prefetch" href="/assets/index.html-CQQbAsKr.js" as="script"><link rel="prefetch" href="/assets/index.html-DZr6jM8f.js" as="script"><link rel="prefetch" href="/assets/index.html-C8ELegvw.js" as="script"><link rel="prefetch" href="/assets/index.html-l3U6mEa_.js" as="script"><link rel="prefetch" href="/assets/index.html-DJTmYTr7.js" as="script"><link rel="prefetch" href="/assets/index.html-CeiJX9tz.js" as="script"><link rel="prefetch" href="/assets/index.html-DJvwc5kl.js" as="script"><link rel="prefetch" href="/assets/index.html-CffeAXa0.js" as="script"><link rel="prefetch" href="/assets/index.html-DhS2wyYb.js" as="script"><link rel="prefetch" href="/assets/index.html--l549uVp.js" as="script"><link rel="prefetch" href="/assets/index.html-CoIEIciD.js" as="script"><link rel="prefetch" href="/assets/index.html-BsIMZ9a5.js" as="script"><link rel="prefetch" href="/assets/index.html-Cnf-ELIQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DypGD8fR.js" as="script"><link rel="prefetch" href="/assets/index.html-U55gdJC4.js" as="script"><link rel="prefetch" href="/assets/index.html-C6qZ4TYA.js" as="script"><link rel="prefetch" href="/assets/index.html-DvC9T08i.js" as="script"><link rel="prefetch" href="/assets/index.html-DKfxwdD9.js" as="script"><link rel="prefetch" href="/assets/index.html-DM80uAl4.js" as="script"><link rel="prefetch" href="/assets/index.html-gOLWOOcf.js" as="script"><link rel="prefetch" href="/assets/index.html-Dh_Rgo1b.js" as="script"><link rel="prefetch" href="/assets/index.html-lujOxXkN.js" as="script"><link rel="prefetch" href="/assets/index.html-BJrAEH_u.js" as="script"><link rel="prefetch" href="/assets/index.html-D0Hov_iK.js" as="script"><link rel="prefetch" href="/assets/index.html-DCqdfa4i.js" as="script"><link rel="prefetch" href="/assets/index.html-ChKtuZnj.js" as="script"><link rel="prefetch" href="/assets/index.html-C-FYfRJA.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">心之所向，素履以往</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/post/" aria-label="博文"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>博文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/timeline/" aria-label="事件轴"><span class="font-icon icon fa-fw fa-sm fas fa-timeline" style=""></span>事件轴<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/tag/" aria-label="标签"><span class="font-icon icon fa-fw fa-sm fas fa-tags" style=""></span>标签<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/category/" aria-label="分类"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>分类<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/banrenshan/banrenshan.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link nav-link vp-sidebar-title" href="/gudie/" aria-label="指南"><!---->指南<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/12-autosys.html" aria-label="AutoSys"><!---->AutoSys<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/01-flyway.html" aria-label="flyway指南"><!---->flyway指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/15-Hibernate.html" aria-label="Hibernate 指南"><!---->Hibernate 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/02-jsonassert.html" aria-label="JSONassert指南"><!---->JSONassert指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/05-jsonpath.html" aria-label="JsonPath 指南"><!---->JsonPath 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/03-Junit5.html" aria-label="JUnit5指南"><!---->JUnit5指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/04-mocktio.html" aria-label="mocktio指南"><!---->mocktio指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/17-OpenShift%E8%B7%AF%E7%94%B1.html" aria-label="OpenShift 路由"><!---->OpenShift 路由<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/07-oracle.html" aria-label="Oracle基础 指南"><!---->Oracle基础 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/spring-data-redis.html" aria-label="redis支持"><!---->redis支持<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/spring-data-jpa.html" aria-label="Spring Data Repositories"><!---->Spring Data Repositories<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/14-spring-integration.html" aria-label="Spring Integration 指南"><!---->Spring Integration 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/13-spring-retry%E5%AE%98%E6%96%B9%E6%8C%87%E5%8D%97.html" aria-label="Spring Retry 指南"><!---->Spring Retry 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/06-spring-cloud-common.html" aria-label="Spring-CLoud-Common"><!---->Spring-CLoud-Common<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E4%BC%98%E5%8C%96.html" aria-label="sql语句上的优化"><!---->sql语句上的优化<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/11-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/10-%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" aria-label="多线程"><!---->多线程<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E9%AB%98%E7%BA%A7.html" aria-label="安装"><!---->安装<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/16-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" aria-label="开发环境"><!---->开发环境<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/08-%E5%BF%AB%E6%8D%B7%E9%94%AE.html" aria-label="快捷键"><!---->快捷键<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E7%B4%A2%E5%BC%95.html" aria-label="概述"><!---->概述<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E8%BF%90%E7%BB%B4%E5%92%8C%E7%9B%91%E6%8E%A7.html" aria-label="监控"><!---->监控<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/09-%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83.html" aria-label="编程规范"><!---->编程规范<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/00-%E9%87%91%E8%9E%8D%E7%9F%A5%E8%AF%86.html" aria-label="金融知识"><!---->金融知识<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/AirFlow.html" aria-label="AirFlow"><!---->AirFlow<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/ER%E5%9B%BE.html" aria-label="ER图"><!---->ER图<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/filebeat.html" aria-label="filebeat"><!---->filebeat<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/go%E8%AF%AD%E8%A8%80.html" aria-label="go基础语法"><!---->go基础语法<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-depedency.html" aria-label="gradle 依赖解析"><!---->gradle 依赖解析<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-basic.html" aria-label="gradle-basic"><!---->gradle-basic<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-java.html" aria-label="gradle-java"><!---->gradle-java<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/grafana-1.html" aria-label="grafana1"><!---->grafana1<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/grafana.html" aria-label="grafana2"><!---->grafana2<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%8E%A5%E5%8F%A3.html" aria-label="Java 接口"><!---->Java 接口<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%97%A5%E6%9C%9F.html" aria-label="Java 日期 API"><!---->Java 日期 API<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%B3%A8%E8%A7%A3.html" aria-label="Java 注解"><!---->Java 注解<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/loki.html" aria-label="loki"><!---->loki<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/Resilience4j.html" aria-label="Resilience4j"><!---->Resilience4j<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/zero-copy.html" aria-label="zero-copy"><!---->zero-copy<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/%E5%A4%9A%E7%BA%BF%E7%A8%8B-Exchanger.html" aria-label="多线程-Exchanger"><!---->多线程-Exchanger<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/remoteConnection.html" aria-label="远程管理协议"><!---->远程管理协议<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Go</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go-Context.html" aria-label="Go Context"><!---->Go Context<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A0%87%E5%87%86%E5%BA%93-json.html" aria-label="Go Json"><!---->Go Json<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A0%87%E5%87%86%E5%BA%93-time.html" aria-label="Go Time"><!---->Go Time<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%91%BD%E4%BB%A4%E8%A1%8C.html" aria-label="Go 命令行"><!---->Go 命令行<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%9F%BA%E7%A1%80.html" aria-label="Go 基础"><!---->Go 基础<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%B9%B6%E5%8F%91.html" aria-label="Go 并发"><!---->Go 并发<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A8%A1%E5%9D%97.html" aria-label="Go 模块"><!---->Go 模块<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.html" aria-label="Go 面向对象"><!---->Go 面向对象<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%B3%9B%E5%9E%8B.html" aria-label="Go泛型"><!---->Go泛型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E7%8E%AF%E5%A2%83.html" aria-label="Go环境"><!---->Go环境<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/k8s-client-go.html" aria-label="Kubernate Go"><!---->Kubernate Go<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">云技术</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/helm.html" aria-label="Helm 指南"><!---->Helm 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/istio.html" aria-label="Istio 指南"><!---->Istio 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/minikube.html" aria-label="minikube 指南"><!---->minikube 指南<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Python</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Python/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83.html" aria-label="虚拟环境"><!---->虚拟环境<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Tools</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/git.html" aria-label="git"><!---->git<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/Vscode.html" aria-label="Vscode"><!---->Vscode<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/%E4%BB%A3%E7%90%86.html" aria-label="各种代理设置"><!---->各种代理设置<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/openrewrite.html" aria-label="概述"><!---->概述<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Spring</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-webclient.html" aria-label="/Spring/spring-webclient.html"><!---->/Spring/spring-webclient.html<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/ews%E9%82%AE%E7%AE%B1.html" aria-label="ews 邮箱API"><!---->ews 邮箱API<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/gradle.html" aria-label="Gradle指南"><!---->Gradle指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-gradle%E6%8F%92%E4%BB%B6.html" aria-label="Spring Gradle 插件"><!---->Spring Gradle 插件<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-http-interface.html" aria-label="Spring Http Interface"><!---->Spring Http Interface<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-restclient.html" aria-label="Spring RestClient"><!---->Spring RestClient<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-resttemplate.html" aria-label="Spring RestTemplate"><!---->Spring RestTemplate<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3.html" aria-label="Spring Validation"><!---->Spring Validation<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/Spring/spring%E4%BA%8B%E5%8A%A1.html" aria-label="Spring 事务"><!---->Spring 事务<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E5%AE%B9%E5%99%A8%E5%9F%BA%E7%A1%80.html" aria-label="Spring 容器基础"><!---->Spring 容器基础<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E5%AE%B9%E5%99%A8%E9%AB%98%E7%BA%A7.html" aria-label="Spring 容器高级"><!---->Spring 容器高级<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html" aria-label="Spring 类型转换"><!---->Spring 类型转换<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E8%A1%A8%E8%BE%BE%E5%BC%8F.html" aria-label="Spring 表达式"><!---->Spring 表达式<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-resource.html" aria-label="Spring 资源处理"><!---->Spring 资源处理<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/gradle%E9%AB%98%E7%BA%A7.html" aria-label="文件API"><!---->文件API<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Spring 事务</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/banrenshan" target="_blank" rel="noopener noreferrer">banrenshan</a></span><span property="author" content="banrenshan"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-10-08T00:00:00.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/Spring/spring%E4%BA%8B%E5%8A%A1.html" data-page-key="/Spring/spring%E4%BA%8B%E5%8A%A1.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 24 分钟</span><meta property="timeRequired" content="PT24M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#全局事务">全局事务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#本地事务">本地事务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#原理">原理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#transactiontemplate">TransactionTemplate</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#transactionaloperator">TransactionalOperator</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#transactionmanager">TransactionManager</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用-platformtransactionmanager">使用 PlatformTransactionManager</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#使用-reactivetransactionmanager">使用 ReactiveTransactionManager</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#代理模式下的方法可见性和-transactional">代理模式下的方法可见性和@Transactional</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#事务的传播机制">事务的传播机制</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#propagation-required">PROPAGATION_REQUIRED</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#propagation-requires-new">PROPAGATION_REQUIRES_NEW</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#propagation-nested">PROPAGATION_NESTED</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="spring-事务模型的优势" tabindex="-1"><a class="header-anchor" href="#spring-事务模型的优势"><span>Spring 事务模型的优势</span></a></h1><p>传统上，EE应用程序开发人员对事务管理有两种选择：全局事务或本地事务，这两种选择都有深刻的局限性。在接下来的两个部分中，将回顾全局和本地事务管理，然后讨论Spring Framework的事务管理支持如何解决全局和本地交易模型的局限性。</p><h2 id="全局事务" tabindex="-1"><a class="header-anchor" href="#全局事务"><span>全局事务</span></a></h2><p>全局事务允许您使用多个事务资源，通常是关系数据库和消息队列。应用服务器通过JTA管理全局事务，JTA是一个繁琐的API（部分原因是其异常模型）。此外，JTA 通常需要来自JNDI的支持。全局事务的使用限制了应用程序代码的任何潜在重用，因为JTA通常只在应用程序服务器环境中可用。</p><p>以前，使用全局事务的首选方式是通过EJB CMT（容器管理事务）。CMT是一种声明性事务管理形式（区别于程序化事务管理）。EJB CMT消除了与事务相关的JNDI查找的需要，尽管EJB本身的使用需要使用JNDI。它消除了编写Java代码来控制事务的大部分（但不是全部）需要。显著的缺点是CMT与JTA和应用服务器环境绑定在一起。此外，只有当选择在EJB中实现业务逻辑（或者至少在事务EJB门面后面）时，它才可用。EJB的负面影响是如此之大，以至于这不是一个有吸引力的提议，尤其是在声明性事务管理的令人信服的替代方案面前。</p><h2 id="本地事务" tabindex="-1"><a class="header-anchor" href="#本地事务"><span>本地事务</span></a></h2><p>本地事务是特定于资源的，例如与JDBC连接相关联的事务。本地事务可能更容易使用，但有一个显著的缺点：它们不能跨多个事务资源工作。例如，通过使用JDBC连接来管理事务的代码不能在全局JTA事务中运行。由于应用程序服务器不参与事务管理，因此它无法帮助确保跨多个资源的正确性。值得注意的是，大多数应用程序都使用单个事务资源。另一个缺点是本地事务会侵入编程模型。</p><p>Spring解决了全局和本地事务的缺点。它允许应用程序开发人员在任何环境中使用一致的编程模型。您只需编写一次代码，就可以从不同环境中的不同事务管理策略中获益。Spring框架提供声明性和程序性事务管理。</p><p>Spring Framework事务抽象，可以在任何底层事务基础设施上运行。对于首选的声明性模型，开发人员通常很少编写或不编写与事务管理相关的代码，因此不依赖于Spring Framework事务API或任何其他事务API。</p><h1 id="事务抽象-transactionmanager" tabindex="-1"><a class="header-anchor" href="#事务抽象-transactionmanager"><span>事务抽象-TransactionManager</span></a></h1><figure><img src="/assets/image-20231119210148011-CAEh4KLN.png" alt="image-20231119210148011" tabindex="0" loading="lazy"><figcaption>image-20231119210148011</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token keyword">extends</span> <span class="token class-name">TransactionManager</span> <span class="token punctuation">{</span><span class="token comment">//TransactionManager 是标记接口</span>
	<span class="token class-name">TransactionStatus</span> <span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionDefinition</span> definition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token class-name">TransactionStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>方法抛出的<code>TransactionException</code>都是未检查的（也就是说，它扩展了<code>java.lang.RuntimeException</code>类）。事务基础结构故障几乎总是致命的，只有至少的情况可以从事务失败中恢复，但spring允许开发人员自由选择是否捕获和处理<code>TransactionException</code>。</p><p><code>getTransaction</code>方法根据<code>TransactionDefinition</code>参数返回<code>TransactionStatus</code>对象。如果当前调用堆栈中存在匹配的事务，则返回的<code>TransactionStatus</code>可能表示新事务，也可能表示现有事务。后一种情况的含义是，与Jakarta EE事务上下文一样，<code>TransactionStatus</code>与执行线程相关联。</p><p><code>TransactionDefinition</code> 指定如下信息：</p><ul><li>Propagation：通常，事务范围内的所有代码都在该事务中运行。但是，如果在事务上下文已经存在的情况下运行事务方法，则可以指定行为。例如，代码可以在现有事务中继续运行（常见情况），或者可以挂起现有事务并创建新事务。</li><li>Isolation：此事务与其他事务的工作隔离的级别。例如，此事务是否可以看到来自其他事务的未提交写入？</li><li>Timeout：事务的超时时间，超时后将回滚事务。</li><li>Read-only：当代码读取但不修改数据时，可以使用只读事务。在某些情况下，只读事务可能是一种有用的优化，例如当您使用Hibernate时。</li></ul><p>TransactionStatus接口为事务代码提供了一种简单的方式来控制事务执行和查询事务状态：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TransactionStatus</span> <span class="token keyword">extends</span> <span class="token class-name">TransactionExecution</span><span class="token punctuation">,</span> <span class="token class-name">SavepointManager</span><span class="token punctuation">,</span> <span class="token class-name">Flushable</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">boolean</span> <span class="token function">isNewTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">hasSavepoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">void</span> <span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">boolean</span> <span class="token function">isRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">boolean</span> <span class="token function">isCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TransactionManager实现通常需要了解其工作环境：JDBC、JTA、Hibernate等等。以下示例显示了如何定义本地PlatformTransactionManager实现（在本例中，使用普通JDBC）：</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果您在Jakarta EE容器中使用JTA，那么您将使用通过JNDI获得的容器DataSource以及Spring的JtaTransactionManager：</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xmlns:</span>jee</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/jee<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>
		http://www.springframework.org/schema/beans
		https://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/jee
		https://www.springframework.org/schema/jee/spring-jee.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jee:</span>jndi-lookup</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jndi-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc/jpetstore<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.transaction.jta.JtaTransactionManager<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在所有Spring事务设置中，应用程序代码不需要更改。您可以仅通过更改配置来更改事务的管理方式，即使这种更改意味着从本地事务转移到全局事务，反之亦然。</p><p>您还可以轻松地使用Hibernate本地事务，如以下示例所示。在这种情况下，您需要定义一个Hibernate LocalSessionFactoryBean，您的应用程序代码可以使用它来获取Hibernate会话实例。</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.orm.hibernate5.LocalSessionFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mappingResources<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernateProperties<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>
			hibernate.dialect=${hibernate.dialect}
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.orm.hibernate5.HibernateTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如何创建不同的事务管理器，以及如何将它们链接到需要同步到事务的相关资源已经很清楚了。例如 DataSourceTransactionManager 到JDBC DataSource，HibernateTransactionManager 到 Hibernate SessionFactory</p><p>本节介绍应用程序代码（直接或间接地，通过使用持久性API，如JDBC、Hibernate或JPA）如何确保正确创建、重用和清理这些资源</p><p>首选方法是使用Spring的最高级别的基于模板的持久性集成API，或者使用具有事务感知工厂bean或代理的本地ORM API来管理本地资源工厂。这些事务感知解决方案在内部处理资源创建和重用、清理、资源的可选事务同步以及异常映射。因此，用户数据访问代码不必处理这些任务，而是可以纯粹关注非样板持久性逻辑。通常，您使用原生的ORM API，或者通过使用JdbcTemplate对JDBC访问采用模板方法。这些解决方案将在本参考文档的后续章节中详细介绍。</p><p>DataSourceUtils（用于JDBC）、EntityManagerFactoryUtils（适用于JPA）、SessionFactoryUtil（适用于Hibernate）等类存在于较低级别。当您希望应用程序代码直接处理本机持久性API的资源类型时，您可以使用这些类来确保获得正确的Spring Framework托管实例，同步事务（可选），并将进程中发生的异常正确映射到一致的API。</p><p>例如，在JDBC的情况下，您可以使用Spring的org.springframework.JDBC.DataSource.DataSourceUtils类，而不是在DataSource上调用getConnection（）方法的传统JDBC方法，如下所示：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DataSourceUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果现有事务已经有一个同步（链接）到它的连接，则返回该实例。否则，方法调用会触发创建一个新连接，该连接（可选）与任何现有事务同步，并可在同一事务中进行后续重用。如前所述，任何SQLException都封装在Spring Framework CannotGetJdbcConnectionException中，这是Spring Framework的未检查DataAccessException类型的层次结构之一。这种方法为您提供了比从SQLException轻松获得的信息更多的信息，并确保了跨数据库甚至跨不同持久性技术的可移植性。</p><p>这种方法也可以在没有Spring事务管理的情况下工作（事务同步是可选的），因此无论是否使用Spring进行事务管理，都可以使用它。</p><p>当然，一旦您使用了Spring的JDBC支持、JPA支持或Hibernate支持，您通常不喜欢使用DataSourceUtils或其他辅助类，因为与直接使用相关API相比，您更喜欢使用Spring抽象。例如，如果您使用Spring JdbcTemplate或jdbc.object包来简化jdbc的使用，则可以在后台进行正确的连接检索，并且无需编写任何特殊代码。</p><p>在最底层存在TransactionAwareDataSourceProxy类。这是目标DataSource的代理，它封装目标DataSource以添加对Spring托管事务的感知。在这方面，它类似于由Jakarta EE服务器提供的事务性JNDI DataSource。</p><p>您几乎不应该需要或想要使用此类，除非必须调用现有代码并传递标准JDBC DataSource接口实现。在这种情况下，该代码可能是可用的，但参与了Spring管理的事务。您可以使用前面提到的高级抽象来编写新代码。</p><h1 id="声明式事务" tabindex="-1"><a class="header-anchor" href="#声明式事务"><span>声明式事务</span></a></h1><p>Spring框架的声明性事务管理是通过Spring面向方面编程（AOP）实现的。Spring Framework的声明性事务管理类似于EJB CMT，因为您可以指定事务行为（或不指定事务行为），直到单个方法级别。如果需要，可以在事务上下文中调用setRollbackOnly。这两种类型的交易管理的区别在于：</p><ul><li>与绑定到JTA的EJB CMT不同，Spring框架的声明性事务管理适用于任何环境。它可以使用JDBC、JPA或Hibernate通过调整配置文件来处理JTA事务或本地事务。</li><li>您可以将SpringFramework声明性事务管理应用于任何类，而不仅仅是EJB之类的特殊类。</li><li>Spring框架提供了声明性回滚规则，这是一个没有EJB等效功能的特性。提供了对回滚规则的程序性和声明性支持。</li><li>Spring Framework允许您使用AOP自定义事务行为。例如，您可以在事务回滚的情况下插入自定义行为。您还可以添加任意建议以及事务性建议。使用EJB CMT，除了使用setRollbackOnly（）之外，您不能影响容器的事务管理。</li><li>Spring Framework不像高端应用程序服务器那样支持跨远程调用传播事务上下文。如果您需要此功能，我们建议您使用EJB。但是，在使用这样的功能之前要仔细考虑，因为通常情况下，不希望事务跨越远程调用。</li></ul><p>回滚规则的概念很重要。它们允许您指定哪些异常（和可丢弃的）应导致自动回滚。您可以在配置中以声明方式指定，而不是在Java代码中。因此，尽管您仍然可以对TransactionStatus对象调用setRollbackOnly（）来回滚当前事务，但大多数情况下，您可以指定MyApplicationException必须始终导致回滚的规则。此选项的显著优点是业务对象不依赖于事务基础结构。例如，他们通常不需要导入Spring事务API或其他Spring API。</p><p>尽管EJB容器默认行为在系统异常（通常是运行时异常）上自动回滚事务，EJB CMT不会在应用程序异常（即除java.rmi.RemoteException之外的已检查异常）上自动回滚事务。虽然声明性事务管理的Spring默认行为遵循EJB约定（仅在未检查异常上自动回滚），但自定义此行为通常很有用。</p><h2 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h2><p>仅仅告诉你用@Transactional注释来注释你的类，将@EnableTransactionManagement添加到你的配置中，并期望你了解它是如何工作的，这是不够的。为了提供更深入的理解，本节将在事务相关问题的上下文中解释Spring Framework的声明性事务基础设施的内部工作。</p><p>关于Spring Framework的声明性事务支持，需要掌握的最重要的概念是，这种支持是通过AOP代理启用的，并且事务建议是由元数据驱动的（目前是基于XML或注释的）。AOP与事务元数据的组合产生了一个AOP代理，该代理使用TransactionInterceptor与适当的TransactionManager实现来驱动方法调用周围的事务。</p><p>Spring Framework的TransactionInterceptor为命令式和反应式编程模型提供事务管理。拦截器通过检查方法返回类型来检测所需的事务管理风格。返回响应式类型（如Publisher或Kotlin Flow（或其子类型）的方法符合响应式事务管理的条件。包括void在内的所有其他返回类型都使用命令式事务管理的代码路径。</p><p>事务管理会影响需要哪个事务管理器。强制事务需要PlatformTransactionManager，而响应事务使用ReactiveTransactionManager实现。</p><p>@Transactional通常使用PlatformTransactionManager管理的线程绑定事务，将事务暴露给当前执行线程中的所有数据访问操作。注意：这不会传播到方法中新启动的线程。 由ReactiveTransactionManager管理的反应事务使用Reactor上下文而不是线程本地属性。因此，所有参与的数据访问操作都需要在同一反应管道中的同一Reactor上下文中执行。</p><p>下图显示了在事务代理上调用方法的概念视图：</p><figure><img src="/assets/tx-CONAbfrl.png" alt="tx" tabindex="0" loading="lazy"><figcaption>tx</figcaption></figure><h1 id="编程式事务管理" tabindex="-1"><a class="header-anchor" href="#编程式事务管理"><span>编程式事务管理</span></a></h1><p>Spring Framework提供了两种编程事务管理方法：</p><ul><li>TransactionTemplate 或 TransactionalOperator</li><li>直接使用 TransactionManager 实现。</li></ul><p>Spring团队通常建议TransactionTemplate用于命令流中的程序化事务管理，TransactionalOperator用于响应式代码。第二种方法类似于使用JTA UserTransaction API，但简化了异常处理。</p><h2 id="transactiontemplate" tabindex="-1"><a class="header-anchor" href="#transactiontemplate"><span><code>TransactionTemplate</code></span></a></h2><p>TransactionTemplate采用了与其他Spring模板（如JdbcTemplate）相同的方法。它使用回调方法，使应用程序代码不必使用样板获取和释放事务资源。</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>public class SimpleService implements Service {

	// single TransactionTemplate shared amongst all methods in this instance
	private final TransactionTemplate transactionTemplate;

	// use constructor-injection to supply the PlatformTransactionManager
	public SimpleService(PlatformTransactionManager transactionManager) {
		this.transactionTemplate = new TransactionTemplate(transactionManager);
	}

	public Object someServiceMethod() {
		return transactionTemplate.execute(new TransactionCallback() {
			// the code in this method runs in a transactional context
			public Object doInTransaction(TransactionStatus status) {
				updateOperation1();
				return resultOfUpdateOperation2();
			}
		});
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不需要返回值：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>transactionTemplate.execute(new TransactionCallbackWithoutResult() {
	protected void doInTransactionWithoutResult(TransactionStatus status) {
		updateOperation1();
		updateOperation2();
	}
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>回调中的代码可以通过对提供的TransactionStatus对象调用setRollbackOnly（）方法来回滚事务，如下所示：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>transactionTemplate.execute(new TransactionCallbackWithoutResult() {

	protected void doInTransactionWithoutResult(TransactionStatus status) {
		try {
			updateOperation1();
			updateOperation2();
		} catch (SomeBusinessException ex) {
			status.setRollbackOnly();
		}
	}
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您可以在TransactionTemplate上指定事务设置（如传播模式、隔离级别、超时等）。默认情况下，TransactionTemplate实例具有默认的事务设置。你可以通过下面方式自定义：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>public class SimpleService implements Service {

	private final TransactionTemplate transactionTemplate;

	public SimpleService(PlatformTransactionManager transactionManager) {
		this.transactionTemplate = new TransactionTemplate(transactionManager);

		// the transaction settings can be set here explicitly if so desired
		this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
		this.transactionTemplate.setTimeout(30); // 30 seconds
		// and so forth...
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>TransactionTemplate类的实例是线程安全的，因为实例不维护任何会话状态。但是，TransactionTemplate实例确实维护配置状态。因此，虽然许多类可能共享一个TransactionTemplate实例，但如果一个类需要使用具有不同设置（例如，不同隔离级别）的TransactionTemplate，则需要创建两个不同的TransactionTemplate实例。</p></blockquote><h2 id="transactionaloperator" tabindex="-1"><a class="header-anchor" href="#transactionaloperator"><span><code>TransactionalOperator</code></span></a></h2><p>必须在事务上下文中运行并显式使用TransactionalOperator的应用程序代码示例：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>public class SimpleService implements Service {

	// single TransactionalOperator shared amongst all methods in this instance
	private final TransactionalOperator transactionalOperator;

	// use constructor-injection to supply the ReactiveTransactionManager
	public SimpleService(ReactiveTransactionManager transactionManager) {
		this.transactionalOperator = TransactionalOperator.create(transactionManager);
	}

	public Mono&lt;Object&gt; someServiceMethod() {

		// the code in this method runs in a transactional context

		Mono&lt;Object&gt; update = updateOperation1();

		return update.then(resultOfUpdateOperation2).as(transactionalOperator::transactional);
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TransactionalOperator可以通过两种方式使用：</p><ul><li>reactor 类型的操作符：<code>mono.as(transactionalOperator::transactional)</code></li><li>适用于其他案例的回调：<code>transactionalOperator.execute(TransactionCallback&lt;T&gt;)</code></li></ul><p>回调中的代码可以通过对提供的ReactiveTransaction对象调用setRollbackOnly方法来回滚事务，如下所示：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>transactionalOperator.execute(new TransactionCallback&lt;&gt;() {

	public Mono&lt;Object&gt; doInTransaction(ReactiveTransaction status) {
		return updateOperation1().then(updateOperation2)
					.doOnError(SomeBusinessException.class, e -&gt; status.setRollbackOnly());
		}
	}
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在Reactive Streams中，订阅服务器可以取消其订阅并停止其发布服务器。Project Reactor中的运算符以及其他库中的运算符，如next（）、take（long）、timeout（Duration），都可以发出取消操作。无法知道取消的原因，无论是由于错误还是根本没有兴趣进一步消费。由于取消信号导致回滚。因此，重要的是要考虑事务发布服务器下游使用的运算符。特别是在Flux或其他多值发布服务器的情况下，必须消耗全部输出才能完成事务。</p><p>您可以在<code>TransactionalOperator</code>上指定事务设置（如传播模式、隔离级别、超时等）。默认情况下，<code>TransactionalOperator</code>实例具有默认的事务设置。你可以通过下面方式自定义：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>public class SimpleService implements Service {

	private final TransactionalOperator transactionalOperator;

	public SimpleService(ReactiveTransactionManager transactionManager) {
		DefaultTransactionDefinition definition = new DefaultTransactionDefinition();

		// the transaction settings can be set here explicitly if so desired
		definition.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
		definition.setTimeout(30); // 30 seconds
		// and so forth...

		this.transactionalOperator = TransactionalOperator.create(transactionManager, definition);
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="transactionmanager" tabindex="-1"><a class="header-anchor" href="#transactionmanager"><span><code>TransactionManager</code></span></a></h2><h3 id="使用-platformtransactionmanager" tabindex="-1"><a class="header-anchor" href="#使用-platformtransactionmanager"><span>使用 <code>PlatformTransactionManager</code></span></a></h3><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>DefaultTransactionDefinition def = new DefaultTransactionDefinition();
// explicitly setting the transaction name is something that can be done only programmatically
def.setName(&quot;SomeTxName&quot;);
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
try {
	// put your business logic here
} catch (MyException ex) {
	txManager.rollback(status);
	throw ex;
}
txManager.commit(status);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-reactivetransactionmanager" tabindex="-1"><a class="header-anchor" href="#使用-reactivetransactionmanager"><span>使用 <code>ReactiveTransactionManager</code></span></a></h3><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>DefaultTransactionDefinition def = new DefaultTransactionDefinition();
// explicitly setting the transaction name is something that can be done only programmatically
def.setName(&quot;SomeTxName&quot;);
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

Mono&lt;ReactiveTransaction&gt; reactiveTx = txManager.getReactiveTransaction(def);

reactiveTx.flatMap(status -&gt; {

	Mono&lt;Object&gt; tx = ...; // put your business logic here

	return tx.then(txManager.commit(status))
			.onErrorResume(ex -&gt; txManager.rollback(status).then(Mono.error(ex)));
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="事务事件处理" tabindex="-1"><a class="header-anchor" href="#事务事件处理"><span>事务事件处理</span></a></h1><p>您可以使用<code>@EventListener</code>注册常规事件侦听器。如果需要将其绑定到事务，请使用<code>@TransactionalEventListener</code>。侦听器默认绑定到事务的提交阶段。</p><figure><img src="/assets/image-20231119182617420-DvsjjZX5.png" alt="image-20231119182617420" tabindex="0" loading="lazy"><figcaption>image-20231119182617420</figcaption></figure><ul><li><p><code>TransactionalApplicationListenerAdapter</code> 注册实现 ApplicationListener 的实例，并监听事件。</p></li><li><p><code>TransactionalApplicationListenerMethodAdapter</code> 注册用 @TransactionalEventListener 标注的方法，并监听事件。</p></li></ul><p>TransactionalApplicationListenerSynchronization：发送触发事件，被上面的adapter调用。</p><p>AbstractPlatformTransactionManager</p><p>下一个例子展示了这个概念。假设一个组件发布了一个订单创建的事件，并且我们希望定义一个侦听器，该侦听器只应在发布该事件的事务成功提交后才处理该事件。以下示例设置了这样一个事件侦听器：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>@Component
public class MyComponent {

	@TransactionalEventListener
	public void handleOrderCreatedEvent(CreationEvent&lt;Order&gt; creationEvent) {
		// ...
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@TransactionalEventListener注释公开了一个阶段属性，该属性允许您自定义侦听器应绑定到的事务的阶段。有效阶段为BEFORE_COMMIT、AFTER_COMMIT（默认）、AFTER_ROLLBACK以及聚合事务完成（无论是提交还是回滚）的AFTER_COMPLETION。</p><p>如果没有事务正在运行，则根本不会调用侦听器，因为我们无法遵守所需的语义。但是，您可以通过将注释的fallbackExecution属性设置为true来覆盖该行为。</p><p>从6.1起，@TransactionalEventListener可以处理PlatformTransactionManager管理的线程绑定事务以及ReactiveTransactionManager管理。对于前者，侦听器可以保证看到当前的线程绑定事务。由于后者使用Reactor上下文而不是线程本地变量，因此事务上下文需要作为事件源包含在已发布的事件实例中。有关详细信息，请参阅TransactionalEventPublisher javadoc。</p><h1 id="transactional" tabindex="-1"><a class="header-anchor" href="#transactional"><span><code>@Transactional</code></span></a></h1><p>如上所述在类级别使用，注释指示声明类（及其子类）的所有方法的默认值。或者，每个方法都可以单独进行注释。有关Spring认为哪些方法是事务性的，请参阅方法可见性。请注意，类级注释不适用于类层次结构上的祖先类；在这种情况下，继承的方法需要在本地重新声明，以便参与子类级别的注释。</p><p>当像上面这样的POJO类在Spring上下文中被定义为bean时，您可以通过@Configuration类中的@EnableTransactionManagement注释使bean实例具有事务性。有关详细信息，请参阅javadoc。</p><h3 id="代理模式下的方法可见性和-transactional" tabindex="-1"><a class="header-anchor" href="#代理模式下的方法可见性和-transactional"><span>代理模式下的方法可见性和@Transactional</span></a></h3><p>@Transactional注释通常用于具有公共可见性的方法。从6.0开始，默认情况下，对于基于类的代理，受保护或包可见的方法也可以是事务性的。请注意，基于接口的代理中的事务方法必须始终是公共的，并在代理接口中定义。对于这两种代理，只拦截通过代理传入的外部方法调用。</p><p>如果您希望在不同类型的代理之间一致地处理方法可见性（这是5.3之前的默认设置），请考虑指定publicMethodsOnly：</p><div class="language-JAVA line-numbers-mode" data-ext="JAVA" data-title="JAVA"><pre class="language-JAVA"><code>@Bean
TransactionAttributeSource transactionAttributeSource() {
	return new AnnotationTransactionAttributeSource(true);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以将@Transactional注释应用于接口定义、接口上的方法、类定义或类上的方法。然而，仅仅存在@Transactional注释不足以激活事务行为。@Transactional注释只是相应的运行时基础设施可以使用的元数据，该基础设施使用该元数据来配置具有事务行为的适当bean。在前面的示例中，<a class="route-link" href="/Spring/tx:annotation-driven/">tx:annotation-driven/</a>元素在运行时打开实际事务管理。</p><p>Spring团队建议您使用@Transactional注释来注释具体类的方法，而不是依赖于接口中的注释方法，即使后者在5.0之前确实适用于基于接口和目标类代理。由于Java注释不是从接口继承的，所以在使用AspectJ模式时，编织基础结构仍然无法识别接口声明的注释，因此不会应用方面。因此，您的事务注释可能会被默默地忽略：您的代码可能看起来“正常工作”，直到您测试回滚场景为止。</p><p>在代理模式（这是默认模式）下，只有通过代理传入的外部方法调用才会被拦截。这意味着自调用（实际上，目标对象中的一个方法调用目标对象的另一个方法）在运行时不会导致实际事务，即使调用的方法标记为@Transactional。此外，代理必须完全初始化才能提供预期的行为，因此您不应该在初始化代码中依赖此功能 — 例如在@PostConstruct方法中。</p><p>如果您希望自调用也包含事务，请考虑使用AspectJ模式。在这种情况下，首先没有代理。相反，目标类被编织也就是说，它的字节码被修改，以支持@Transactional运行时行为。AspectJ编织需要类路径中的spring-aspects.jar，并启用加载时编织（或编译时编织）。</p><table><thead><tr><th>注解属性</th><th style="text-align:left;">默认值</th><th>描述</th></tr></thead><tbody><tr><td>参考TransactionManagementConfigurer</td><td style="text-align:left;">transactionManager</td><td>要使用的事务管理器的名称。</td></tr><tr><td>mode</td><td style="text-align:left;">proxy</td><td>默认模式（proxy）通过使用Spring的AOP框架来处理要代理的带注释的bean（如前所述，遵循代理语义，仅适用于通过代理传入的方法调用）。替代模式（aspectj）将受影响的类与Spring的aspectj事务方面编织在一起，修改目标类字节码以应用于任何类型的方法调用。</td></tr><tr><td>proxyTargetClass</td><td style="text-align:left;">false</td><td>仅适用于代理模式。控制创建什么类型的事务代理。如果代理目标类属性设置为true，则会创建基于类的代理。如果proxy-target类为false或省略了属性，则会创建标准的JDK接口代理。</td></tr><tr><td>order</td><td style="text-align:left;"><code>Ordered.LOWEST_PRECEDENCE</code></td><td></td></tr></tbody></table><p>代理模式下，同一类中的本地调用不能被拦截。</p><p>@Transactional注释是指定接口、类或方法必须具有事务语义的元数据（例如，“在调用此方法时启动全新的只读事务，挂起任何现有事务”）。默认的@Transactional设置如下：</p><ul><li>PROPAGATION_REQUIRED</li><li>ISOLATION_DEFAULT</li><li>事务是可读可写的</li><li>事务超时默认为底层事务系统的默认超时，如果不支持超时，则为无。</li><li>任何RuntimeException或Error都会触发回滚，而可检查的Exception则不会。</li></ul><p>注解上可配置的元数据：</p><table><thead><tr><th style="text-align:left;">Property</th><th style="text-align:left;">Type</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/annotations.html#tx-multiple-tx-mgrs-with-attransactional" target="_blank" rel="noopener noreferrer">value<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">String</td><td style="text-align:left;">指定要使用的事务管理器的可选限定符。</td></tr><tr><td style="text-align:left;"><code>transactionManager</code></td><td style="text-align:left;"><code>String</code></td><td style="text-align:left;">Alias for <code>value</code>.</td></tr><tr><td style="text-align:left;"><code>label</code></td><td style="text-align:left;">“字符串”标签数组，用于向事务添加表达性描述。</td><td style="text-align:left;">标签可以由事务管理器进行评估，以实现特定的行为与实际事务相关联。</td></tr><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/tx-propagation.html" target="_blank" rel="noopener noreferrer">propagation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>enum</code>: <code>Propagation</code></td><td style="text-align:left;">Optional propagation setting.</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;"><code>enum</code>: <code>Isolation</code></td><td style="text-align:left;">可选隔离级别。仅适用于“REQUIRED”或“REQUIRES_NEW”的传播值。</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;"><code>int</code> (in seconds of granularity)</td><td style="text-align:left;">可选事务超时。仅适用于“REQUIRED”或“REQUIRES_NEW”的传播值。</td></tr><tr><td style="text-align:left;"><code>timeoutString</code></td><td style="text-align:left;"><code>String</code> (in seconds of granularity)</td><td style="text-align:left;">将“timeout”（以秒为单位）指定为“String”值的替代方法 — 例如作为占位符。</td></tr><tr><td style="text-align:left;"><code>readOnly</code></td><td style="text-align:left;"><code>boolean</code></td><td style="text-align:left;">读写事务与只读事务。仅适用于“REQUIRED”或“REQUIRES_NEW”的值。</td></tr><tr><td style="text-align:left;"><code>rollbackFor</code></td><td style="text-align:left;">Array of <code>Class</code> objects, which must be derived from <code>Throwable.</code></td><td style="text-align:left;">Optional array of exception types that must cause rollback.</td></tr><tr><td style="text-align:left;"><code>rollbackForClassName</code></td><td style="text-align:left;">Array of exception name patterns.</td><td style="text-align:left;">Optional array of exception name patterns that must cause rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackFor</code></td><td style="text-align:left;">Array of <code>Class</code> objects, which must be derived from <code>Throwable.</code></td><td style="text-align:left;">Optional array of exception types that must not cause rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackForClassName</code></td><td style="text-align:left;">Array of exception name patterns.</td><td style="text-align:left;">Optional array of exception name patterns that must not cause rollback.</td></tr></tbody></table><p>目前，您无法显式控制事务的名称，其中“name”表示出现在事务监视器和日志输出中的事务名称。对于声明性事务，事务名称始终是完全限定的类名+.+事务建议类的方法名。例如，如果BusinessService类的handlePayment（..）方法启动了一个事务，则该事务的名称将为：com.example.BusinessService.handlePayment。</p><h2 id="事务的传播机制" tabindex="-1"><a class="header-anchor" href="#事务的传播机制"><span>事务的传播机制</span></a></h2><p>逻辑事务和物理事务</p><h2 id="propagation-required" tabindex="-1"><a class="header-anchor" href="#propagation-required"><span><code>PROPAGATION_REQUIRED</code></span></a></h2><figure><img src="/assets/tx_prop_required-IY7nf9Tk.png" alt="tx prop required" tabindex="0" loading="lazy"><figcaption>tx prop required</figcaption></figure><p>PROPAGATION_REQUIRED强制你的代码包裹在物理事务中，如果还不存在事务，则为当前作用域创建事务，或者向上参与为更大作用域定义的现有“外部”事务。在同一线程内的堆栈调用中，这是一个很好的默认设置。例如，一个服务，调用几个存储库方法，其中所有底层资源都必须参与服务级别事务。</p><p>默认情况下，当前执行方法加入外部作用域的事务中时，会忽略本地隔离级别、超时值或只读标志（如果有的话）。如果您希望在参与具有不同隔离级别的现有事务时拒绝隔离级别声明，请考虑在事务管理器上将validateExistingTransactions标志切换为true。这种非宽松模式还拒绝只读不匹配（即，内部读写事务方法试图参与只读外部作用域事务）。</p><p>当传播设置为propagation_REQUIRED时，将为应用该设置的每个方法创建一个逻辑事务范围。每个这样的逻辑事务作用域可以单独确定仅回滚状态，外部事务作用域在逻辑上独立于内部事务作用域。在标准PROPAGATION_REQUIRED行为的情况下，所有这些作用域都映射到同一物理事务。因此，在内部事务范围中设置的仅回滚标记确实会影响外部事务实际提交的机会。</p><p>然而，在内部事务范围设置仅回滚标记的情况下，外部事务尚未决定回滚本身，因此回滚（由内部事务范围静默触发）是意外的。此时会引发相应的UnexpectedRollbackException。这是预期的行为，因此事务的调用方永远不会被误导，以为提交是在实际没有执行的情况下执行的。因此，如果内部事务（外部调用方不知道该事务）以静默方式将事务标记为仅回滚，则外部调用方仍然调用commit。外部调用程序需要接收一个UnexpectedRollbackException，以清楚地表明已执行回滚。</p><h2 id="propagation-requires-new" tabindex="-1"><a class="header-anchor" href="#propagation-requires-new"><span><code>PROPAGATION_REQUIRES_NEW</code></span></a></h2><figure><img src="/assets/tx_prop_requires_new-BXDbXlWI.png" alt="tx prop requires new" tabindex="0" loading="lazy"><figcaption>tx prop requires new</figcaption></figure><p>与PROPAGATION_REQUIRED相比，PROPAGATION_REQUIRES_NEW始终为每个受影响的事务范围使用独立的物理事务，从不参与外部范围的现有事务。在这种安排中，底层事务资源是不同的，因此可以独立提交或回滚，外部事务不受内部事务回滚状态的影响，内部事务的锁在完成后立即释放。这样一个独立的内部事务还可以声明自己的隔离级别、超时和只读设置，而不继承外部事务的特性。</p><p>当内部事务获取自己的资源（如新的数据库连接）时，附加到外部事务的资源将保持绑定。如果几个线程有一个活动的外部事务并等待为其内部事务获取新连接，而连接池无法再分发任何此类内部连接，这可能会导致连接池耗尽，并可能导致死锁。除非连接池大小适当，并发线程数至少1，否则不要使用PROPAGATION_REQUIRES_NEW。</p><h2 id="propagation-nested" tabindex="-1"><a class="header-anchor" href="#propagation-nested"><span><code>PROPAGATION_NESTED</code></span></a></h2><p>PROPAGATION_NESTED使用具有多个保存点的单个物理事务，可以回滚到这些保存点。这种部分回滚使内部事务作用域触发其作用域的回滚，而外部事务能够继续物理事务，尽管某些操作已回滚。此设置通常映射到JDBC保存点，因此它仅适用于JDBC资源事务。请参阅Spring的DataSourceTransactionManager。</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/banrenshan/banrenshan.github.io/edit/main/src/Spring/spring事务.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: CP_zhaozhiqiang@163.com">banrenshan</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/Spring/%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3.html" aria-label="Spring Validation"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Spring Validation</div></a><a class="route-link nav-link next" href="/Spring/spring-%E5%AE%B9%E5%99%A8%E5%9F%BA%E7%A1%80.html" aria-label="Spring 容器基础"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Spring 容器基础<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-JRZgQj53.js" defer></script>
  </body>
</html>
