<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.36" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://banrenshan.github.io/gudie/15-Hibernate.html"><meta property="og:site_name" content="心之所向，素履以往"><meta property="og:title" content="Hibernate 指南"><meta property="og:description" content="概述 image-20240424144856481image-20240424144856481 Hibernate作为一种ORM解决方案，位于应用程序数据访问层和关系数据库之间，如上图所示。 Java 应用程序利用 Hibernate API 来加载、存储、查询等其域数据。 作为 Jakarta Persistence 提供商，Hibernate ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-24T08:19:31.000Z"><meta property="article:author" content="banrenshan"><meta property="article:tag" content="Hibernate"><meta property="article:published_time" content="2024-04-20T00:00:00.000Z"><meta property="article:modified_time" content="2024-04-24T08:19:31.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Hibernate 指南","image":[""],"datePublished":"2024-04-20T00:00:00.000Z","dateModified":"2024-04-24T08:19:31.000Z","author":[{"@type":"Person","name":"banrenshan","url":"https://github.com/banrenshan"}]}</script><title>Hibernate 指南 | 心之所向，素履以往</title><meta name="description" content="概述 image-20240424144856481image-20240424144856481 Hibernate作为一种ORM解决方案，位于应用程序数据访问层和关系数据库之间，如上图所示。 Java 应用程序利用 Hibernate API 来加载、存储、查询等其域数据。 作为 Jakarta Persistence 提供商，Hibernate ...">
    <link rel="preload" href="/assets/style-wL6mR3b5.css" as="style"><link rel="stylesheet" href="/assets/style-wL6mR3b5.css">
    <link rel="modulepreload" href="/assets/app-Brzzz3sI.js"><link rel="modulepreload" href="/assets/15-Hibernate.html-DlmkLCrJ.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-Dinhrg_m.js" as="script"><link rel="prefetch" href="/assets/go-Context.html-B9y274l-.js" as="script"><link rel="prefetch" href="/assets/go命令行.html-CBkl9V82.js" as="script"><link rel="prefetch" href="/assets/go基础.html-Dhe5z5iV.js" as="script"><link rel="prefetch" href="/assets/go并发.html-2pdsFREW.js" as="script"><link rel="prefetch" href="/assets/go标准库-json.html-DX9g76i_.js" as="script"><link rel="prefetch" href="/assets/go标准库-time.html-Dnr_nGkQ.js" as="script"><link rel="prefetch" href="/assets/go模块.html-CqUvC54G.js" as="script"><link rel="prefetch" href="/assets/go泛型.html-CtnEqPl9.js" as="script"><link rel="prefetch" href="/assets/go环境.html-Cfhqt8Nd.js" as="script"><link rel="prefetch" href="/assets/go面向对象.html-YRQxSVki.js" as="script"><link rel="prefetch" href="/assets/k8s-client-go.html-DenJcaiu.js" as="script"><link rel="prefetch" href="/assets/虚拟环境.html-DdNTYG6D.js" as="script"><link rel="prefetch" href="/assets/ews邮箱.html-CyQ_yAhL.js" as="script"><link rel="prefetch" href="/assets/gradle.html-DBxnGzfo.js" as="script"><link rel="prefetch" href="/assets/spring-resource.html-DJy3Qh1h.js" as="script"><link rel="prefetch" href="/assets/spring-容器基础.html-FdaYNYBW.js" as="script"><link rel="prefetch" href="/assets/spring-容器高级.html-BIJHmz3r.js" as="script"><link rel="prefetch" href="/assets/spring-类型转换.html-C8v1iAs-.js" as="script"><link rel="prefetch" href="/assets/spring-表达式.html-hdFlsVek.js" as="script"><link rel="prefetch" href="/assets/spring事务.html-pVZA4H0g.js" as="script"><link rel="prefetch" href="/assets/校验注解.html-DbdGZYOh.js" as="script"><link rel="prefetch" href="/assets/helm.html-B4lErKcF.js" as="script"><link rel="prefetch" href="/assets/istio.html-D160nfaa.js" as="script"><link rel="prefetch" href="/assets/minikube.html-CbGNEAsJ.js" as="script"><link rel="prefetch" href="/assets/00-金融知识.html-DeFNATDO.js" as="script"><link rel="prefetch" href="/assets/01-flyway.html-DwqpjRP4.js" as="script"><link rel="prefetch" href="/assets/02-jsonassert.html-D21e1m5E.js" as="script"><link rel="prefetch" href="/assets/03-Junit5.html-BDBFUK1y.js" as="script"><link rel="prefetch" href="/assets/04-mocktio.html-BAzCT5IH.js" as="script"><link rel="prefetch" href="/assets/05-jsonpath.html-CWASClsf.js" as="script"><link rel="prefetch" href="/assets/06-spring-cloud-common.html-DTTraJW6.js" as="script"><link rel="prefetch" href="/assets/07-oracle.html-BU2mygyY.js" as="script"><link rel="prefetch" href="/assets/08-快捷键.html-Cfi_FVzA.js" as="script"><link rel="prefetch" href="/assets/09-编程规范.html-Cvc67TlT.js" as="script"><link rel="prefetch" href="/assets/10-多线程.html-DtxX_Z-r.js" as="script"><link rel="prefetch" href="/assets/11-分布式事务.html-B7kr4vAT.js" as="script"><link rel="prefetch" href="/assets/12-autosys.html-BJ0TlSgO.js" as="script"><link rel="prefetch" href="/assets/13-spring-retry官方指南.html-Bu0gm_nJ.js" as="script"><link rel="prefetch" href="/assets/14-spring-integration.html-Pq5Vkpri.js" as="script"><link rel="prefetch" href="/assets/16-开发环境.html-rpGP80tq.js" as="script"><link rel="prefetch" href="/assets/17-OpenShift路由.html-zD7l51Zv.js" as="script"><link rel="prefetch" href="/assets/mysql优化.html-BWZJck4j.js" as="script"><link rel="prefetch" href="/assets/mysql索引.html-Dp2oyuPO.js" as="script"><link rel="prefetch" href="/assets/mysql运维和监控.html--3dxmT23.js" as="script"><link rel="prefetch" href="/assets/mysql高级.html-CPik6PyE.js" as="script"><link rel="prefetch" href="/assets/spring-data-jpa.html-DLUiglUg.js" as="script"><link rel="prefetch" href="/assets/spring-data-redis.html-BnXYc559.js" as="script"><link rel="prefetch" href="/assets/AirFlow.html-DFSFXqUB.js" as="script"><link rel="prefetch" href="/assets/ER图.html-Dtg06qDp.js" as="script"><link rel="prefetch" href="/assets/Resilience4j.html-CPSYgC-E.js" as="script"><link rel="prefetch" href="/assets/filebeat.html-V3n59LqF.js" as="script"><link rel="prefetch" href="/assets/go语言.html-BLFUZhuj.js" as="script"><link rel="prefetch" href="/assets/gradle-basic.html-CWzpDfp7.js" as="script"><link rel="prefetch" href="/assets/gradle-depedency.html-PzrtMNnp.js" as="script"><link rel="prefetch" href="/assets/gradle-java.html-Bsxp6hjN.js" as="script"><link rel="prefetch" href="/assets/grafana-1.html-Bdul0kun.js" as="script"><link rel="prefetch" href="/assets/grafana.html-DWECnLLE.js" as="script"><link rel="prefetch" href="/assets/java接口.html-BIT41e-e.js" as="script"><link rel="prefetch" href="/assets/java日期.html-brlDnyrc.js" as="script"><link rel="prefetch" href="/assets/java注解.html-C7Np5uh_.js" as="script"><link rel="prefetch" href="/assets/loki.html-BQEgNYfj.js" as="script"><link rel="prefetch" href="/assets/nginx.html-CBBV20Lv.js" as="script"><link rel="prefetch" href="/assets/remoteConnection.html-C7p4sv1o.js" as="script"><link rel="prefetch" href="/assets/zero-copy.html-CsS6PNZb.js" as="script"><link rel="prefetch" href="/assets/多线程-Exchanger.html-KEWkLWwQ.js" as="script"><link rel="prefetch" href="/assets/Vscode.html-D95lJEzK.js" as="script"><link rel="prefetch" href="/assets/代理.html-CftJCGF3.js" as="script"><link rel="prefetch" href="/assets/404.html-DJvsvHv3.js" as="script"><link rel="prefetch" href="/assets/index.html-dlFkNtQh.js" as="script"><link rel="prefetch" href="/assets/index.html-esL2x_tP.js" as="script"><link rel="prefetch" href="/assets/index.html-gP4rIQ5C.js" as="script"><link rel="prefetch" href="/assets/index.html-DJz4LLY2.js" as="script"><link rel="prefetch" href="/assets/index.html-B42KFFcF.js" as="script"><link rel="prefetch" href="/assets/index.html-DyW7deL4.js" as="script"><link rel="prefetch" href="/assets/index.html-D8a-rO9S.js" as="script"><link rel="prefetch" href="/assets/index.html-6WPFi9VW.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx-xy0pN.js" as="script"><link rel="prefetch" href="/assets/index.html--JcF2rfJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DtT6rAfM.js" as="script"><link rel="prefetch" href="/assets/index.html-ChmW0nSO.js" as="script"><link rel="prefetch" href="/assets/index.html-loUlgZ--.js" as="script"><link rel="prefetch" href="/assets/index.html-CmukK9da.js" as="script"><link rel="prefetch" href="/assets/index.html-Db_ZHdgv.js" as="script"><link rel="prefetch" href="/assets/index.html-CTQPr8dV.js" as="script"><link rel="prefetch" href="/assets/index.html-ChmW0nSO.js" as="script"><link rel="prefetch" href="/assets/index.html-b1DhYuwz.js" as="script"><link rel="prefetch" href="/assets/index.html-DMKyMfY-.js" as="script"><link rel="prefetch" href="/assets/index.html-CCqTcQyL.js" as="script"><link rel="prefetch" href="/assets/index.html-DRrlpmMy.js" as="script"><link rel="prefetch" href="/assets/index.html--k1J9biO.js" as="script"><link rel="prefetch" href="/assets/index.html-hgggnEPA.js" as="script"><link rel="prefetch" href="/assets/index.html-J7gntB6K.js" as="script"><link rel="prefetch" href="/assets/index.html-loUlgZ--.js" as="script"><link rel="prefetch" href="/assets/index.html-D4YuB0dI.js" as="script"><link rel="prefetch" href="/assets/index.html-DlD4BYA6.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx-xy0pN.js" as="script"><link rel="prefetch" href="/assets/index.html-Dyp2Glwt.js" as="script"><link rel="prefetch" href="/assets/index.html-DVCFTVaZ.js" as="script"><link rel="prefetch" href="/assets/index.html-rYUCBV_X.js" as="script"><link rel="prefetch" href="/assets/index.html-DjVn7ypW.js" as="script"><link rel="prefetch" href="/assets/index.html-CyvG6Zt0.js" as="script"><link rel="prefetch" href="/assets/index.html-4330Sk5c.js" as="script"><link rel="prefetch" href="/assets/index.html-Bcs72AKU.js" as="script"><link rel="prefetch" href="/assets/index.html-Brx6N4M1.js" as="script"><link rel="prefetch" href="/assets/index.html-CMO2WPpa.js" as="script"><link rel="prefetch" href="/assets/index.html-BusLHqZV.js" as="script"><link rel="prefetch" href="/assets/index.html-DnNw564h.js" as="script"><link rel="prefetch" href="/assets/index.html-C0fYdOoe.js" as="script"><link rel="prefetch" href="/assets/index.html-BCgsA13P.js" as="script"><link rel="prefetch" href="/assets/index.html-DpaaCnf5.js" as="script"><link rel="prefetch" href="/assets/index.html-1GpCJWFC.js" as="script"><link rel="prefetch" href="/assets/index.html-C3xRuFlM.js" as="script"><link rel="prefetch" href="/assets/index.html-DiI2Oajp.js" as="script"><link rel="prefetch" href="/assets/index.html-Dp8I4P7_.js" as="script"><link rel="prefetch" href="/assets/index.html-C2DLrje6.js" as="script"><link rel="prefetch" href="/assets/index.html-yA4XFgZ7.js" as="script"><link rel="prefetch" href="/assets/index.html-BtftND-t.js" as="script"><link rel="prefetch" href="/assets/index.html-2bXD5u9n.js" as="script"><link rel="prefetch" href="/assets/index.html-CkLAHvCn.js" as="script"><link rel="prefetch" href="/assets/index.html-DI-Xsb6D.js" as="script"><link rel="prefetch" href="/assets/index.html-Bfx-5tpZ.js" as="script"><link rel="prefetch" href="/assets/index.html-9ogZgMJf.js" as="script"><link rel="prefetch" href="/assets/index.html-BhaDTUj9.js" as="script"><link rel="prefetch" href="/assets/index.html-DduD1OZ8.js" as="script"><link rel="prefetch" href="/assets/index.html-DKo99vaw.js" as="script"><link rel="prefetch" href="/assets/index.html-C05dsm4y.js" as="script"><link rel="prefetch" href="/assets/index.html-BPKJoHfy.js" as="script"><link rel="prefetch" href="/assets/index.html-lMdoztGy.js" as="script"><link rel="prefetch" href="/assets/index.html-DvMgqPI7.js" as="script"><link rel="prefetch" href="/assets/index.html-CxdHwVRk.js" as="script"><link rel="prefetch" href="/assets/index.html-D8MyKXNy.js" as="script"><link rel="prefetch" href="/assets/index.html-B1B8-RbD.js" as="script"><link rel="prefetch" href="/assets/index.html-CxMsPdKB.js" as="script"><link rel="prefetch" href="/assets/index.html-ByNRG9Hf.js" as="script"><link rel="prefetch" href="/assets/index.html-WEmpua9_.js" as="script"><link rel="prefetch" href="/assets/index.html-pOZrTPvD.js" as="script"><link rel="prefetch" href="/assets/index.html-ByKBak0a.js" as="script"><link rel="prefetch" href="/assets/index.html-5l395_fX.js" as="script"><link rel="prefetch" href="/assets/index.html-Brx6N4M1.js" as="script"><link rel="prefetch" href="/assets/index.html-CKimLbNe.js" as="script"><link rel="prefetch" href="/assets/index.html-_R6M7tB8.js" as="script"><link rel="prefetch" href="/assets/index.html-xz1O6DKj.js" as="script"><link rel="prefetch" href="/assets/index.html-C6-9qgjY.js" as="script"><link rel="prefetch" href="/assets/index.html-CvV3tPrA.js" as="script"><link rel="prefetch" href="/assets/index.html-BJW5qfyQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DOEskld8.js" as="script"><link rel="prefetch" href="/assets/index.html-CjvMhBLW.js" as="script"><link rel="prefetch" href="/assets/index.html-O3ekEhBq.js" as="script"><link rel="prefetch" href="/assets/index.html-zttt1MoW.js" as="script"><link rel="prefetch" href="/assets/index.html-DHd_Qtlh.js" as="script"><link rel="prefetch" href="/assets/index.html-DVVMQD8G.js" as="script"><link rel="prefetch" href="/assets/index.html-B36P80aI.js" as="script"><link rel="prefetch" href="/assets/index.html-C7Un48U-.js" as="script"><link rel="prefetch" href="/assets/index.html-JI6OVoJ1.js" as="script"><link rel="prefetch" href="/assets/index.html-DF6TXU_s.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">心之所向，素履以往</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/post/" aria-label="博文"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>博文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/timeline/" aria-label="事件轴"><span class="font-icon icon fa-fw fa-sm fas fa-timeline" style=""></span>事件轴<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/tag/" aria-label="标签"><span class="font-icon icon fa-fw fa-sm fas fa-tags" style=""></span>标签<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/category/" aria-label="分类"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>分类<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/banrenshan/banrenshan.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link nav-link active vp-sidebar-title" href="/gudie/" aria-label="指南"><!---->指南<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/12-autosys.html" aria-label="AutoSys"><!---->AutoSys<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/01-flyway.html" aria-label="flyway指南"><!---->flyway指南<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/gudie/15-Hibernate.html" aria-label="Hibernate 指南"><!---->Hibernate 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/02-jsonassert.html" aria-label="JSONassert指南"><!---->JSONassert指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/05-jsonpath.html" aria-label="JsonPath 指南"><!---->JsonPath 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/03-Junit5.html" aria-label="JUnit5指南"><!---->JUnit5指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/04-mocktio.html" aria-label="mocktio指南"><!---->mocktio指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/17-OpenShift%E8%B7%AF%E7%94%B1.html" aria-label="OpenShift 路由"><!---->OpenShift 路由<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/07-oracle.html" aria-label="Oracle基础 指南"><!---->Oracle基础 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/spring-data-redis.html" aria-label="redis支持"><!---->redis支持<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/spring-data-jpa.html" aria-label="Spring Data Repositories"><!---->Spring Data Repositories<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/14-spring-integration.html" aria-label="Spring Integration 指南"><!---->Spring Integration 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/13-spring-retry%E5%AE%98%E6%96%B9%E6%8C%87%E5%8D%97.html" aria-label="Spring Retry 指南"><!---->Spring Retry 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/06-spring-cloud-common.html" aria-label="Spring-CLoud-Common"><!---->Spring-CLoud-Common<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E4%BC%98%E5%8C%96.html" aria-label="sql语句上的优化"><!---->sql语句上的优化<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/11-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/10-%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" aria-label="多线程"><!---->多线程<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E9%AB%98%E7%BA%A7.html" aria-label="安装"><!---->安装<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/16-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html" aria-label="开发环境"><!---->开发环境<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/08-%E5%BF%AB%E6%8D%B7%E9%94%AE.html" aria-label="快捷键"><!---->快捷键<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E7%B4%A2%E5%BC%95.html" aria-label="概述"><!---->概述<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/mysql%E8%BF%90%E7%BB%B4%E5%92%8C%E7%9B%91%E6%8E%A7.html" aria-label="监控"><!---->监控<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/09-%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83.html" aria-label="编程规范"><!---->编程规范<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/gudie/00-%E9%87%91%E8%9E%8D%E7%9F%A5%E8%AF%86.html" aria-label="金融知识"><!---->金融知识<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/AirFlow.html" aria-label="AirFlow"><!---->AirFlow<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/ER%E5%9B%BE.html" aria-label="ER图"><!---->ER图<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/filebeat.html" aria-label="filebeat"><!---->filebeat<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/go%E8%AF%AD%E8%A8%80.html" aria-label="go基础语法"><!---->go基础语法<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-depedency.html" aria-label="gradle 依赖解析"><!---->gradle 依赖解析<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-basic.html" aria-label="gradle-basic"><!---->gradle-basic<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/gradle-java.html" aria-label="gradle-java"><!---->gradle-java<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/grafana-1.html" aria-label="grafana1"><!---->grafana1<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/grafana.html" aria-label="grafana2"><!---->grafana2<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%8E%A5%E5%8F%A3.html" aria-label="Java 接口"><!---->Java 接口<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%97%A5%E6%9C%9F.html" aria-label="Java 日期 API"><!---->Java 日期 API<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/java%E6%B3%A8%E8%A7%A3.html" aria-label="Java 注解"><!---->Java 注解<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/loki.html" aria-label="loki"><!---->loki<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/nginx.html" aria-label="nginx"><!---->nginx<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/Resilience4j.html" aria-label="Resilience4j"><!---->Resilience4j<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/zero-copy.html" aria-label="zero-copy"><!---->zero-copy<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/%E5%A4%9A%E7%BA%BF%E7%A8%8B-Exchanger.html" aria-label="多线程-Exchanger"><!---->多线程-Exchanger<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/post/remoteConnection.html" aria-label="远程管理协议"><!---->远程管理协议<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Go</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go-Context.html" aria-label="Go Context"><!---->Go Context<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A0%87%E5%87%86%E5%BA%93-json.html" aria-label="Go Json"><!---->Go Json<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A0%87%E5%87%86%E5%BA%93-time.html" aria-label="Go Time"><!---->Go Time<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%91%BD%E4%BB%A4%E8%A1%8C.html" aria-label="Go 命令行"><!---->Go 命令行<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%9F%BA%E7%A1%80.html" aria-label="Go 基础"><!---->Go 基础<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E5%B9%B6%E5%8F%91.html" aria-label="Go 并发"><!---->Go 并发<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%A8%A1%E5%9D%97.html" aria-label="Go 模块"><!---->Go 模块<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.html" aria-label="Go 面向对象"><!---->Go 面向对象<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E6%B3%9B%E5%9E%8B.html" aria-label="Go泛型"><!---->Go泛型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/go%E7%8E%AF%E5%A2%83.html" aria-label="Go环境"><!---->Go环境<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Go/k8s-client-go.html" aria-label="Kubernate Go"><!---->Kubernate Go<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">云技术</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/helm.html" aria-label="Helm 指南"><!---->Helm 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/istio.html" aria-label="Istio 指南"><!---->Istio 指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/cloud/minikube.html" aria-label="minikube 指南"><!---->minikube 指南<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Python</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Python/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83.html" aria-label="虚拟环境"><!---->虚拟环境<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Tools</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/Vscode.html" aria-label="Vscode"><!---->Vscode<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/tool/%E4%BB%A3%E7%90%86.html" aria-label="各种代理设置"><!---->各种代理设置<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Spring</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/ews%E9%82%AE%E7%AE%B1.html" aria-label="ews 邮箱API"><!---->ews 邮箱API<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/gradle.html" aria-label="Gradle指南"><!---->Gradle指南<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3.html" aria-label="Spring Validation"><!---->Spring Validation<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring%E4%BA%8B%E5%8A%A1.html" aria-label="Spring 事务"><!---->Spring 事务<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E5%AE%B9%E5%99%A8%E5%9F%BA%E7%A1%80.html" aria-label="Spring 容器基础"><!---->Spring 容器基础<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E5%AE%B9%E5%99%A8%E9%AB%98%E7%BA%A7.html" aria-label="Spring 容器高级"><!---->Spring 容器高级<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html" aria-label="Spring 类型转换"><!---->Spring 类型转换<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-%E8%A1%A8%E8%BE%BE%E5%BC%8F.html" aria-label="Spring 表达式"><!---->Spring 表达式<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Spring/spring-resource.html" aria-label="Spring 资源处理"><!---->Spring 资源处理<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Hibernate 指南</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/banrenshan" target="_blank" rel="noopener noreferrer">banrenshan</a></span><span property="author" content="banrenshan"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-04-20T00:00:00.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/gudie/15-Hibernate.html" data-page-key="/gudie/15-Hibernate.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 48 分钟</span><meta property="timeRequired" content="PT48M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#值类型">值类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#实体类型">实体类型</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#basic">@Basic</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#column">@Column</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#formula">@Formula</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#映射基本类型">映射基本类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#枚举">枚举</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#boolean">Boolean</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#byte">Byte</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#short">Short</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#integer">Integer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#long">Long</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#biginteger">BigInteger</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#double">Double</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#float">Float</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bigdecimal">BigDecimal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#character">Character</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#string">String</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#字符数组">字符数组</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#clob-nclob">Clob / NClob</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#byte-array">Byte array</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#blob">Blob</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#duration">Duration</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#instant">Instant</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#localdatetime">LocalDateTime</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#localtime">LocalTime</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#offsetdatetime">OffsetDateTime</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#offsettime">OffsetTime</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timezone">TimeZone</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#zoneddatetime">ZonedDateTime</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#calendar、date、time、timestamp">Calendar、Date、Time、Timestamp</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class">Class</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#currency">Currency</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#locale">Locale</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uuid">UUID</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inetaddress">InetAddress</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#json-mapping">JSON mapping</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#xml-mapping">XML mapping</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基本数组映射">基本数组映射</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#基本集合类型">基本集合类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#组合基本类型的映射">组合基本类型的映射</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#自定义类型映射">自定义类型映射</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#处理时间数据">处理时间数据</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#timezonestorage">@TimeZoneStorage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#attributeconverters">AttributeConverters</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#registries">Registries</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#typecontributor">TypeContributor</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#案例研究-bitset">案例研究：BitSet</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sql引用标识符">SQL引用标识符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#生成属性">生成属性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#列转化换器-读取和写入表达式">列转化换器：读取和写入表达式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#条件查询的类型">条件查询的类型</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#选择实体">选择实体</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#选择表达式">选择表达式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#选择多个值">选择多个值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#选择-包装器">选择 包装器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#元组条件查询">元组条件查询</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#from子句">from子句</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#roots">roots</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#joins">joins</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#fetches">Fetches</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#path-expressions">Path expressions</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#使用参数">使用参数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#using-group-by">Using group by</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#path导航">path导航</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h1><figure><img src="/assets/image-20240424144856481-0crb4rQp.png" alt="image-20240424144856481" tabindex="0" loading="lazy"><figcaption>image-20240424144856481</figcaption></figure><p>Hibernate作为一种ORM解决方案，位于应用程序数据访问层和关系数据库之间，如上图所示。 Java 应用程序利用 Hibernate API 来加载、存储、查询等其域数据。</p><p>作为 Jakarta Persistence 提供商，Hibernate 实现了 Java Persistence API 规范，Jakarta Persistence 接口与 Hibernate 特定实现之间的关联可以在下图中可视化：</p><figure><img src="/assets/image-20240424145000570-CmsFKTfE.png" alt="image-20240424145000570" tabindex="0" loading="lazy"><figcaption>image-20240424145000570</figcaption></figure><ul><li><p>SessionFactory (<code>org.hibernate.SessionFactory</code>)：线程安全，表示域模型到DB的映射。充当org.hibernate.Session实例的工厂。Jakarta Persistence中的EntityManagerFactory是与SessionFactory等效的，这两个元素使用相同的SessionFactory实现。</p><p>SessionFactory的创建非常昂贵，因此，对于任何给定的数据库，应用程序应该只有一个关联的SessionFactory。SessionFactory维护Hibernate在所有会话中使用的服务，如二级缓存、连接池、事务系统集成等。</p></li><li><p>Session (<code>org.hibernate.Session</code>)：单线程， 在Jakarta Persistence术语中，会话由EntityManager表示。在幕后，Hibernate Session包装了一个JDBC java.sql.Connection，并充当org.ibernate.Transaction实例的工厂。它维护应用程序域模型的一般“可重复读取”持久性上下文（一级缓存）。</p></li><li><p>Transaction (<code>org.hibernate.Transaction</code>)： 单线程，与Jakarta Persistence 中的 EntityTransaction等效，两者都充当抽象API，将应用程序与正在使用的底层事务系统（JDBC或JTA）隔离开来。</p></li></ul><h1 id="域模型" tabindex="-1"><a class="header-anchor" href="#域模型"><span>域模型</span></a></h1><p>Hibernate同时理解应用程序数据的Java和JDBC表示。Hibernate类型的功能是从数据库中读取/写入数据。在这种用法中，类型是org.ibernate.type.type接口的实现。该Hibernate类型还描述了Java类型的各种行为方面，例如如何检查相等性、如何克隆值等。</p><p>Hibernate类型既不是Java类型，也不是SQL数据类型。它提供了有关将Java类型映射到SQL类型的信息，以及如何将给定的Java类型持久化并从关系数据库中获取。 为了帮助理解类型分类，让我们看一个表和域模型的简单映射。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> Contact <span class="token punctuation">(</span>
    id <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token keyword">first</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">last</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    middle <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    notes <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    starred <span class="token keyword">boolean</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    website <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Contact&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Contact</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Name</span> name<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> notes<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">URL</span> website<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">boolean</span> starred<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Embeddable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Name</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>

	<span class="token comment">// getters and setters omitted</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从广义上讲，Hibernate将类型分为两组：</p><ul><li>值类型</li><li>实体类型</li></ul><h2 id="值类型" tabindex="-1"><a class="header-anchor" href="#值类型"><span>值类型</span></a></h2><p>值类型是一段不定义其自身生命周期的数据。实际上，它由一个实体拥有，该实体定义了它的生命周期。从另一个角度来看，实体的所有状态都完全由值类型组成。这些状态字段或JavaBean 属性称为持久属性。Contact类的持久属性是值类型。</p><p>值类型进一步分为三类：</p><ul><li>基本类型:在映射Contact表时，除了name之外的所有属性都将是基本类型。</li><li>嵌入类型：name属性属于嵌入类型</li><li>集合类型：虽然在前面的示例中没有出现，但集合类型在值类型中也是一个独特的类别</li></ul><h2 id="实体类型" tabindex="-1"><a class="header-anchor" href="#实体类型"><span>实体类型</span></a></h2><p>实体由于其唯一标识符的性质，独立于其他对象而存在。实体是使用唯一标识符与数据库表中的行相关的域模型类。由于需要唯一标识符，实体独立存在并定义自己的生命周期。Contact类本身就是一个实体的示例。</p><h1 id="基本类型" tabindex="-1"><a class="header-anchor" href="#基本类型"><span>基本类型</span></a></h1><p>基本类型是Java类型和单个数据库列之间的映射。Hibernate可以将许多标准Java类型（Integer、String等）映射为基本类型。此外，Hibernate提供了多种灵活的方式来指示Java类型应该如何映射到数据库。</p><p>Jakarta Persistence规范严格限制那些Java类型可以标记为basic,如下：</p><table><thead><tr><th style="text-align:left;">Category</th><th style="text-align:left;">Package</th><th style="text-align:left;">Types</th></tr></thead><tbody><tr><td style="text-align:left;">Java primitive types</td><td style="text-align:left;"></td><td style="text-align:left;"><code>boolean</code>, <code>int</code>, <code>double</code>, etc.</td></tr><tr><td style="text-align:left;">Primitive wrappers</td><td style="text-align:left;"><code>java.lang</code></td><td style="text-align:left;"><code>Boolean</code>, <code>Integer</code>, <code>Double</code>, etc.</td></tr><tr><td style="text-align:left;">Strings</td><td style="text-align:left;"><code>java.lang</code></td><td style="text-align:left;"><code>String</code></td></tr><tr><td style="text-align:left;">Arbitrary-precision numeric types</td><td style="text-align:left;"><code>java.math</code></td><td style="text-align:left;"><code>BigInteger</code> and <code>BigDecimal</code></td></tr><tr><td style="text-align:left;">Date/time types</td><td style="text-align:left;"><code>java.time</code></td><td style="text-align:left;"><code>LocalDate</code>, <code>LocalTime</code>, <code>LocalDateTime</code>, <code>OffsetTime</code>, <code>OffsetDateTime</code>, <code>Instant</code></td></tr><tr><td style="text-align:left;">Deprecated date/time types</td><td style="text-align:left;"><code>java.util</code></td><td style="text-align:left;"><code>Date</code> and <code>Calendar</code></td></tr><tr><td style="text-align:left;">Deprecated date/time types from</td><td style="text-align:left;"><code>java.sql</code></td><td style="text-align:left;"><code>Date</code>, <code>Time</code>, <code>Timestamp</code></td></tr><tr><td style="text-align:left;">Byte and character arrays</td><td style="text-align:left;"></td><td style="text-align:left;"><code>byte[]</code> or <code>Byte[]</code>, <code>char[]</code> or <code>Character[]</code></td></tr><tr><td style="text-align:left;">Java enumerated types</td><td style="text-align:left;"></td><td style="text-align:left;">Any <code>enum</code></td></tr><tr><td style="text-align:left;">Serializable types</td><td style="text-align:left;"></td><td style="text-align:left;">Any type that implements <code>java.io.Serializable</code></td></tr></tbody></table><blockquote><p>Java Persistence 2.1引入了jakarta.Persistence.AttributeConverter，它支持处理规范中定义的类型以外的类型。有关此主题的详细信息，请参阅AttributeConverters。</p></blockquote><h3 id="basic" tabindex="-1"><a class="header-anchor" href="#basic"><span>@Basic</span></a></h3><p>严格来说，基本类型由jakarta.persistence.basic注释表示。通常，@Basic注释可以被忽略。以下两个示例最终都是相同的。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@Basic</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Basic</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> sku<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Basic</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Basic</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> sku<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Basic 定义了两个属性：</p><ul><li><code>optional</code> - boolean (默认true)：定义此属性是否允许空值。如果属性是java的基础类型，则该属性被忽略。只要类型不是基础类型，Hibernate就会接受这个值。</li><li><code>fetch</code> - FetchType (默认EAGER)：EAGER表示将作为所有者的一部分获取该值。LAZY表示仅当访问值时才获取值。Jakarta Persistence要求提供程序支持EAGER，而对LAZY的支持是可选的。只要您使用其字节码增强支持，Hibernate就支持延迟加载。</li></ul><h3 id="column" tabindex="-1"><a class="header-anchor" href="#column"><span>@Column</span></a></h3><p>Jakarta Persistence隐式确定表和列名称的规则。对于基本类型属性，隐式命名规则是：<code>列名与属性名相同</code>。如果隐式命名规则不符合您的要求，您可以明确告诉Hibernate（和其他提供程序）要使用的列名。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> sku<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;NOTES&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="formula" tabindex="-1"><a class="header-anchor" href="#formula"><span>@Formula</span></a></h3><p>@Formula允许将任何数据库计算值映射为虚拟只读列。</p><blockquote><p>@Formula注释采用可能影响数据库可移植性的 native SQL子句。@Formula是Hibernate特有的映射构造，Jakarta Persistence没有涉及。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Double</span> credit<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Double</span> rate<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Formula</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;credit * rate&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Double</span> interest<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载Account实体时，Hibernate将使用配置的@Formula计算interest属性：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token function">doInJPA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">entityManagerFactory</span><span class="token punctuation">,</span> entityManager <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
	<span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	account<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	account<span class="token punctuation">.</span><span class="token function">setCredit</span><span class="token punctuation">(</span><span class="token number">5000d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	account<span class="token punctuation">.</span><span class="token function">setRate</span><span class="token punctuation">(</span><span class="token number">1.25</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">doInJPA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">entityManagerFactory</span><span class="token punctuation">,</span> entityManager <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
	<span class="token class-name">Account</span> account <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">62.5d</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account<span class="token punctuation">.</span><span class="token function">getInterest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token constant">INSERT</span> <span class="token constant">INTO</span> <span class="token class-name">Account</span> <span class="token punctuation">(</span>credit<span class="token punctuation">,</span> rate<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token constant">VALUES</span> <span class="token punctuation">(</span><span class="token number">5000.0</span><span class="token punctuation">,</span> <span class="token number">0.0125</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token constant">SELECT</span>
    a<span class="token punctuation">.</span>id as id1_0_0_<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>credit as credit2_0_0_<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>rate as rate3_0_0_<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>credit <span class="token operator">*</span> a<span class="token punctuation">.</span>rate as formula0_0_
<span class="token constant">FROM</span>
    <span class="token class-name">Account</span> a
<span class="token constant">WHERE</span>
    a<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>@Formula注释定义的SQL片段可以任意复杂，甚至可以包含子查询。</p><h3 id="映射基本类型" tabindex="-1"><a class="header-anchor" href="#映射基本类型"><span>映射基本类型</span></a></h3><p>为了处理基本类型的值，Hibernate需要了解一些有关映射的信息：</p><ul><li><p>Java类型的方法。例如：</p><ul><li><p>如何比较值</p></li><li><p>如何计算哈希码</p></li><li><p>如何将此类型的值强制为另一类型</p></li></ul></li><li><p>使用的JDBC类型</p><ul><li><p>如何将值绑定到JDBC语句</p></li><li><p>如何从JDBC结果中提取</p></li></ul></li><li><p>它应该对与数据库之间的值执行任何转换</p></li><li><p>值的可变性-内部状态是可以像java.util.Date一样改变，还是像java.lang.String一样不可变</p></li></ul><p>本节介绍Hibernate如何确定这些片段，以及确定的过程。</p><p>映射主要由定义的基本java类型确定，这主要由反射实现。回退是将值映射到推荐的JDBC类型。最坏的情况是，如果Java类型是可序列化的，Hibernate将尝试通过二进制序列化来处理它。</p><p>对于Java类型不是标准类型的情况，或者如果需要一些专门的处理，Hibernate提供了两种主要方法来影响映射解析：</p><ul><li>多个注解组合处理</li><li>用户自定义</li></ul><p>这两种方法应视为互斥。自定义UserType始终优先于组合注释。</p><h3 id="枚举" tabindex="-1"><a class="header-anchor" href="#枚举"><span>枚举</span></a></h3><p>Hibernate以多种不同的方式支持将Java枚举映射为基本值类型。</p><h4 id="enumerated" tabindex="-1"><a class="header-anchor" href="#enumerated"><span><code>@Enumerated</code></span></a></h4><p>最初，与Jakarta Persistence兼容的映射枚举的方法是通过@Enumerated或@MapKeyEnumered注释，其原理是根据Jakarta.Persistence.EnumType指示的两种策略之一存储枚举值：</p><ul><li>ORDINAL：根据枚举值在枚举类中的序号位置存储，如java.lang.enum#ordinal</li><li>STRING：根据枚举值的名称存储，如java.lang.enum#name所示</li></ul><p>例如下面的枚举类型：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">PhoneType</span> <span class="token punctuation">{</span>
    <span class="token constant">LAND_LINE</span><span class="token punctuation">,</span>
    <span class="token constant">MOBILE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ORDINAL示例中，phone_type列被定义为（可为空）INTEGER类型，其值为：</p><ul><li>NULL： 空值</li><li>0： LAND_LINE值</li><li>1： MOBILE值</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Phone&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;phone_number&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Enumerated</span><span class="token punctuation">(</span><span class="token class-name">EnumType</span><span class="token punctuation">.</span><span class="token constant">ORDINAL</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;phone_type&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">PhoneType</span> type<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
phone<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
phone<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token string">&quot;123-456-78990&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
phone<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">PhoneType</span><span class="token punctuation">.</span><span class="token constant">MOBILE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Phone <span class="token punctuation">(</span>phone_number<span class="token punctuation">,</span> phone_type<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;123-456-78990&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在STRING示例中，phone_type列被定义为（可为空）VARCHAR类型，其值可能为：</p><ul><li>NULL</li><li>LAND_LINE</li><li>MOBILE</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Phone&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;phone_number&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Enumerated</span><span class="token punctuation">(</span><span class="token class-name">EnumType</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;phone_type&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">PhoneType</span> type<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Phone <span class="token punctuation">(</span>phone_number<span class="token punctuation">,</span> phone_type<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;123-456-78990&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MOBILE&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用属性转化器" tabindex="-1"><a class="header-anchor" href="#使用属性转化器"><span>使用属性转化器</span></a></h4><p>让我们考虑以下使用“M”和“F”代码存储其值的Gender枚举。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span> <span class="token punctuation">{</span>

    <span class="token function">MALE</span><span class="token punctuation">(</span><span class="token char">&#39;M&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">FEMALE</span><span class="token punctuation">(</span><span class="token char">&#39;F&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> code<span class="token punctuation">;</span>

    <span class="token class-name">Gender</span><span class="token punctuation">(</span><span class="token keyword">char</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Gender</span> <span class="token function">fromCode</span><span class="token punctuation">(</span><span class="token keyword">char</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token char">&#39;M&#39;</span> <span class="token operator">||</span> code <span class="token operator">==</span> <span class="token char">&#39;m&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant">MALE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token char">&#39;F&#39;</span> <span class="token operator">||</span> code <span class="token operator">==</span> <span class="token char">&#39;f&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant">FEMALE</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span>
            <span class="token string">&quot;The code &quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot; is not supported!&quot;</span>
       <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">char</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>您可以使用Jakarta Persistence AttributeConverter以符合Jakarta Persistence的方式映射枚举。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">GenderConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Gender</span> gender<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Converter</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GenderConverter</span>
		<span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Gender</span><span class="token punctuation">,</span> <span class="token class-name">Character</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">Character</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">Gender</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Gender</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">Character</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token function">fromCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自定义类型" tabindex="-1"><a class="header-anchor" href="#自定义类型"><span>自定义类型</span></a></h4><p>还可以使用Hibernate自定义类型映射来映射enum。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Type</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>userguide<span class="token punctuation">.</span>mapping<span class="token punctuation">.</span>basic<span class="token punctuation">.</span></span>GenderType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Gender</span> gender<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenderType</span> <span class="token keyword">extends</span> <span class="token class-name">UserTypeSupport</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Gender</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">GenderType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenderJavaType</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClassJavaType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Gender</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">GenderJavaType</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">GenderJavaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">GenderJavaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Gender</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> value<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Gender</span> <span class="token function">fromString</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> string <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">X</span> <span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token class-name">Gender</span> value<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">WrapperOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">CharacterJavaType</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span>
            value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> value<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            type<span class="token punctuation">,</span>
            options
       <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Gender</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">X</span> value<span class="token punctuation">,</span> <span class="token class-name">WrapperOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Gender</span><span class="token punctuation">.</span><span class="token function">fromCode</span><span class="token punctuation">(</span>
				<span class="token class-name">CharacterJavaType</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span> value<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
       <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="boolean" tabindex="-1"><a class="header-anchor" href="#boolean"><span>Boolean</span></a></h3><p>默认情况下，Boolean属性映射到Boolean列，至少在数据库具有专用Boolean类型时是如此。在没有的数据库上，Hibernate使用任何其他可用的：BIT、TINYINT或SMALLINT。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// this will be mapped to BIT or BOOLEAN on the database</span>
<span class="token annotation punctuation">@Basic</span>
<span class="token keyword">boolean</span> implicit<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，找到编码为字符或整数的布尔值是很常见的。这种情况正是AttributeConverter的意图。为了方便起见，Hibernate为常见的布尔映射情况提供了3个内置转换器：</p><ul><li>YesNoConverter将布尔值编码为“Y”或“N”，</li><li>TrueFalseConverter将布尔值编码为“T”或“F”，</li><li>NumericBooleanConverter将值编码为整数，1表示真，0表示假。</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// this will get mapped to CHAR or NCHAR with a conversion</span>
<span class="token annotation punctuation">@Basic</span>
<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>YesNoConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">boolean</span> convertedYesNo<span class="token punctuation">;</span>

<span class="token comment">// this will get mapped to CHAR or NCHAR with a conversion</span>
<span class="token annotation punctuation">@Basic</span>
<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>TrueFalseConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">boolean</span> convertedTrueFalse<span class="token punctuation">;</span>

<span class="token comment">// this will get mapped to TINYINT with a conversion</span>
<span class="token annotation punctuation">@Basic</span>
<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>NumericBooleanConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">boolean</span> convertedNumeric<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果在数据库中将布尔值定义为boolean、字符或整数以外的值，则也可以使用自定义AttributeConverter映射该值.</p><h3 id="byte" tabindex="-1"><a class="header-anchor" href="#byte"><span>Byte</span></a></h3><p>默认情况下，Hibernate将Byte/byte的值映射到TINYINT JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will both be mapped using TINYINT</span>
<span class="token class-name">Byte</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">byte</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="short" tabindex="-1"><a class="header-anchor" href="#short"><span>Short</span></a></h3><p>默认情况下，Hibernate将short/Short的值映射到SMALLINT JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will both be mapped using SMALLINT</span>
<span class="token class-name">Short</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">short</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="integer" tabindex="-1"><a class="header-anchor" href="#integer"><span>Integer</span></a></h3><p>默认情况下，Hibernate将Integer/int值映射到Integer JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will both be mapped using INTEGER</span>
<span class="token class-name">Integer</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">int</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="long" tabindex="-1"><a class="header-anchor" href="#long"><span>Long</span></a></h3><p>默认情况下，Hibernate将Long/Long值映射到BIGINT JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will both be mapped using BIGINT</span>
<span class="token class-name">Long</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">long</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="biginteger" tabindex="-1"><a class="header-anchor" href="#biginteger"><span>BigInteger</span></a></h3><p>默认情况下，Hibernate将BigInteger的值映射到NUMERIC JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// will be mapped using NUMERIC</span>
<span class="token class-name">BigInteger</span> wrapper<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="double" tabindex="-1"><a class="header-anchor" href="#double"><span>Double</span></a></h3><p>默认情况下，Hibernate将Double的值映射到Double、FLOAT、REAL或NUMERIC JDBC类型，具体取决于数据库的功能</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will be mapped using DOUBLE, FLOAT, REAL or NUMERIC</span>
<span class="token comment">// depending on the capabilities of the database</span>
<span class="token class-name">Double</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">double</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用[基本映射显式]部分中介绍的任何JDBC类型影响因素来影响特定类型。 如果使用@JdbcTypeCode，则仍会查询方言以确保数据库支持请求的类型。如果没有，则选择适当的类型</p><h3 id="float" tabindex="-1"><a class="header-anchor" href="#float"><span>Float</span></a></h3><p>默认情况下，Hibernate根据数据库的功能将Float的值映射到Float、REAL或NUMERIC JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will be mapped using FLOAT, REAL or NUMERIC</span>
<span class="token comment">// depending on the capabilities of the database</span>
<span class="token class-name">Float</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">float</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用[基本映射显式]部分中介绍的任何JDBC类型影响因素来影响特定类型。 如果使用@JdbcTypeCode，则仍会查询方言以确保数据库支持请求的类型。如果没有，则选择适当的类型</p><h3 id="bigdecimal" tabindex="-1"><a class="header-anchor" href="#bigdecimal"><span>BigDecimal</span></a></h3><p>默认情况下，Hibernate将BigDecimal的值映射到NUMERIC JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// will be mapped using NUMERIC</span>
<span class="token class-name">BigDecimal</span> wrapper<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="character" tabindex="-1"><a class="header-anchor" href="#character"><span>Character</span></a></h3><p>默认情况下，Hibernate将Character映射到CHAR JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// these will be mapped using CHAR</span>
<span class="token class-name">Character</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">char</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="string" tabindex="-1"><a class="header-anchor" href="#string"><span>String</span></a></h3><p>默认情况下，Hibernate将String映射到VARCHAR JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// will be mapped using VARCHAR</span>
<span class="token class-name">String</span> string<span class="token punctuation">;</span>

<span class="token comment">// will be mapped using CLOB</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token class-name">String</span> clobString<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者，可以使用@Column(length=…), 或者使用Hibernate Validator的@Size注释。对于非常大的字符串，可以使用org.hibernate.Length类定义的常量值之一，例如：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token class-name">Length</span><span class="token punctuation">.</span><span class="token constant">LONG</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>或者，您可以显式指定JDBC类型LONGVARCHAR，当未显式指定长度时，它被视为默认长度为length.LONG的VARCHAR映射：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@JdbcTypeCode</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">LONGVARCHAR</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果使用Hibernate生成模式，Hibernate将生成具有足够大的列类型的DDL，以容纳指定的最大长度。</p><blockquote><p>如果指定的最大长度太长，无法容纳数据库支持的最大VARCHAR列，Hibernate的模式导出器将自动将列类型升级为TEXT、CLOB或数据库的等效类型。请不要因为需要TEXT列就使用JPA的@Lob注释。@Lob注释的目的不是控制DDL生成！</p></blockquote><p>对于支持国际化字符集的数据库，还可以将字符串存储为国际化数据。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// will be mapped using NVARCHAR</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token class-name">String</span> nstring<span class="token punctuation">;</span>

<span class="token comment">// will be mapped using NCLOB</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token class-name">String</span> nclobString<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字符数组" tabindex="-1"><a class="header-anchor" href="#字符数组"><span>字符数组</span></a></h3><p>默认情况下，Hibernate将Character[]和char[]映射到VARCHAR JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitive<span class="token punctuation">;</span>
<span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapper<span class="token punctuation">;</span>

<span class="token comment">// mapped as CLOB</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitiveClob<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapperClob<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于支持国有化字符集的数据库，还可以将字符数组存储为国有化数据。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as NVARCHAR</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitiveNVarchar<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapperNVarchar<span class="token punctuation">;</span>

<span class="token comment">// mapped as NCLOB</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitiveNClob<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token annotation punctuation">@Nationalized</span>
<span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapperNClob<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="clob-nclob" tabindex="-1"><a class="header-anchor" href="#clob-nclob"><span>Clob / NClob</span></a></h3><p>默认情况下，Hibernate将java.sql.Clob类型映射到Clob，java.sql.NClob映射到NClob。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Product <span class="token punctuation">(</span>
  id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  warranty CLOB<span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让我们首先使用@Lob Jakarta Persistence注释和java.sql.Clob类型来映射它：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Lob</span>
    <span class="token keyword">private</span> <span class="token class-name">Clob</span> warranty<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要持久化这样的实体，必须使用Hibernate实用程序 ClobProxy 创建Clob：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> warranty <span class="token operator">=</span> <span class="token string">&quot;My product warranty&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Mobile phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

product<span class="token punctuation">.</span><span class="token function">setWarranty</span><span class="token punctuation">(</span><span class="token class-name">ClobProxy</span><span class="token punctuation">.</span><span class="token function">generateProxy</span><span class="token punctuation">(</span>warranty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要检索Clob内容，需要转换底层java.io.Reader：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Product</span> product <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Reader</span> reader <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getWarranty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCharacterStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;My product warranty&quot;</span><span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们还可以以物化形式映射CLOB。这样，我们可以使用String或char[]。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Lob</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> warranty<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们甚至可能希望将物化数据作为字符数组。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Lob</span>
	<span class="token keyword">private</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> warranty<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与CLOB一样，Hibernate也可以处理NCLOB SQL数据类型</p><h3 id="byte-array" tabindex="-1"><a class="header-anchor" href="#byte-array"><span>Byte array</span></a></h3><p>默认情况下，Hibernate将byte[]和byte[]类型的值映射到JDBC类型VARBINARY。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARBINARY</span>
<span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitive<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapper<span class="token punctuation">;</span>

<span class="token comment">// mapped as (materialized) BLOB</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitiveLob<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Lob</span>
<span class="token keyword">private</span> <span class="token class-name">Byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapperLob<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与字符串一样，可以使用@Column（length=…) 或Hibernate Validator的@Size注释。对于非常大的数组，可以使用org.hibernate.Length定义的常量。或者，如果没有显式指定长度，@JdbcTypeCode（Types.LONGVARBINARY）将被视为VARBINARY映射，默认长度为Length.LONG。</p><p>如果使用Hibernate生成模式，Hibernate将生成具有足够大的列类型的DDL，以容纳指定的最大长度。</p><h3 id="blob" tabindex="-1"><a class="header-anchor" href="#blob"><span>Blob</span></a></h3><p>默认情况下，Hibernate将java.sql.Blob java类型映射到Blob。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Product <span class="token punctuation">(</span>
    id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
    image <span class="token keyword">blob</span> <span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让我们首先使用JDBCjava.sql.Blob类型映射它。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Lob</span>
    <span class="token keyword">private</span> <span class="token class-name">Blob</span> image<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要持久化这样的实体，必须使用BlobProxy Hibernate实用程序创建Blob：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Mobile phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

product<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span><span class="token class-name">BlobProxy</span><span class="token punctuation">.</span><span class="token function">generateProxy</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要检索Blob内容，需要转换底层java.io.InputStream：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Product</span> product <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> product<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBinaryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertArrayEquals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">toBytes</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们还可以以物化形式（例如byte[]）映射BLOB。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Lob</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> image<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="duration" tabindex="-1"><a class="header-anchor" href="#duration"><span>Duration</span></a></h3><p>默认情况下，Hibernate会将Duration映射到INTERVAL_SECOND SQL类型，并在必要时回退到NUMERIC。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Duration</span> duration<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="instant" tabindex="-1"><a class="header-anchor" href="#instant"><span>Instant</span></a></h3><p>Instant映射到TIMESTAMP_UTC SQL类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIMESTAMP</span>
<span class="token keyword">private</span> <span class="token class-name">Instant</span> instant<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="localdate" tabindex="-1"><a class="header-anchor" href="#localdate"><span>LocalDate</span></a></h4><p>LocalDate映射到DATE JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as DATE</span>
<span class="token keyword">private</span> <span class="token class-name">LocalDate</span> localDate<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="localdatetime" tabindex="-1"><a class="header-anchor" href="#localdatetime"><span>LocalDateTime</span></a></h3><p>LocalDateTime映射到TIMESTAMP JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIMESTAMP</span>
<span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> localDateTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="localtime" tabindex="-1"><a class="header-anchor" href="#localtime"><span>LocalTime</span></a></h3><p>LocalTime映射到TIME JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIME</span>
<span class="token keyword">private</span> <span class="token class-name">LocalTime</span> localTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="offsetdatetime" tabindex="-1"><a class="header-anchor" href="#offsetdatetime"><span>OffsetDateTime</span></a></h3><p>OffsetDateTime映射到TIMESTAMP或TIMESTAMP_WITH_TIMEZONE JDBC类型，具体取决于数据库。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIMESTAMP or TIMESTAMP_WITH_TIMEZONE</span>
<span class="token keyword">private</span> <span class="token class-name">OffsetDateTime</span> offsetDateTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="offsettime" tabindex="-1"><a class="header-anchor" href="#offsettime"><span>OffsetTime</span></a></h3><p>OffsetTime映射到TIME或TIME_WITH_TIMEZONE JDBC类型，具体取决于数据库。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIME or TIME_WITH_TIMEZONE</span>
<span class="token keyword">private</span> <span class="token class-name">OffsetTime</span> offsetTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="timezone" tabindex="-1"><a class="header-anchor" href="#timezone"><span>TimeZone</span></a></h3><p>TimeZone映射到VARCHAR JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">private</span> <span class="token class-name">TimeZone</span> timeZone<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="zoneddatetime" tabindex="-1"><a class="header-anchor" href="#zoneddatetime"><span>ZonedDateTime</span></a></h3><p>ZonedDateTime映射到TIMESTAMP或TIMESTAMP_WITH_TIMEZONE JDBC类型，具体取决于数据库。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIMESTAMP or TIMESTAMP_WITH_TIMEZONE</span>
<span class="token keyword">private</span> <span class="token class-name">ZonedDateTime</span> zonedDateTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="zoneoffset" tabindex="-1"><a class="header-anchor" href="#zoneoffset"><span>ZoneOffset</span></a></h4><p>ZoneOffset映射到VARCHAR JDBC类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">private</span> <span class="token class-name">ZoneOffset</span> zoneOffset<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="calendar、date、time、timestamp" tabindex="-1"><a class="header-anchor" href="#calendar、date、time、timestamp"><span>Calendar、Date、Time、Timestamp</span></a></h3><h3 id="class" tabindex="-1"><a class="header-anchor" href="#class"><span>Class</span></a></h3><p>Hibernate将类引用映射到VARCHAR JDBC类型</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="currency" tabindex="-1"><a class="header-anchor" href="#currency"><span>Currency</span></a></h3><p>Hibernate将Currency引用映射到VARCHAR JDBC类型</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">private</span> <span class="token class-name">Currency</span> currency<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="locale" tabindex="-1"><a class="header-anchor" href="#locale"><span>Locale</span></a></h3><p>Hibernate将Locale引用映射到VARCHAR JDBC类型</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as VARCHAR</span>
<span class="token keyword">private</span> <span class="token class-name">Locale</span> locale<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="uuid" tabindex="-1"><a class="header-anchor" href="#uuid"><span>UUID</span></a></h3><p>Hibernate允许以多种方式映射UUID值。默认情况下，Hibernate将使用SQL类型UUID以本机形式存储UUID值，如果数据库没有本机UUID类型，则使用binary JDBC类型以二进制形式存储UUD值。</p><p>默认值使用二进制表示，因为它使用了更高效的列存储。然而，许多应用程序更喜欢基于字符的列存储的可读性。要切换默认映射，请将hibernate.type.preferred_uuid_jdbc_type配置设置为CHAR。</p><h5 id="uuid-as-binary" tabindex="-1"><a class="header-anchor" href="#uuid-as-binary"><span>UUID as binary</span></a></h5><p>如上所述，UUID属性的默认映射使用java.util.UUID#getMostSignificantBits和java.util.UUID#getLeastSignificantBit将UUID映射到byte[]，并将其存储为BINARY数据。之所以选择为默认值，只是因为从存储角度来看，它通常更高效。</p><h5 id="uuid-as-var-char" tabindex="-1"><a class="header-anchor" href="#uuid-as-var-char"><span>UUID as (var)char</span></a></h5><p>使用java.util.UUID#toString和java.util.UUID#fromString将UUID映射到字符串，并将其存储为CHAR或VARCHAR数据。</p><h5 id="uuid-as-identifier" tabindex="-1"><a class="header-anchor" href="#uuid-as-identifier"><span>UUID as identifier</span></a></h5><p>Hibernate支持使用UUID值作为标识符，甚至可以代表用户生成UUID值。</p><h3 id="inetaddress" tabindex="-1"><a class="header-anchor" href="#inetaddress"><span>InetAddress</span></a></h3><p>默认情况下，Hibernate将InetAddress映射到INET SQL类型，并在必要时回退到BINARY。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">InetAddress</span> address<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="json-mapping" tabindex="-1"><a class="header-anchor" href="#json-mapping"><span>JSON mapping</span></a></h3><p>如果通过@JdbcTypeCode（SqlTypes.JSON）显式配置，Hibernate将仅使用JSON类型。自动检测用于序列化/反序列化的JSON库，但可以通过设置hibernate.type.JSON_format_mapper来覆盖。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@JdbcTypeCode</span><span class="token punctuation">(</span> <span class="token class-name">SqlTypes</span><span class="token punctuation">.</span><span class="token constant">JSON</span> <span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> payload<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="xml-mapping" tabindex="-1"><a class="header-anchor" href="#xml-mapping"><span>XML mapping</span></a></h3><p>如果通过@JdbcTypeCode（SqlTypes.SQLXML）显式配置，Hibernate将仅使用XML类型。用于序列化/反序列化的XML库是自动检测的，但可以通过设置hibernate.type.XML_format_mapper来覆盖。</p><h3 id="基本数组映射" tabindex="-1"><a class="header-anchor" href="#基本数组映射"><span>基本数组映射</span></a></h3><p>基本数组，而不是byte[]/Byte[]和char[]/Character[]，默认情况下映射到类型SqlTypes.ARRAY，如果可能，它映射到SQL标准array类型，这是通过org.ibernate.dialect.dialect的新方法getArrayTypeName和supportsStandardArrays确定的。如果SQL标准数组类型不可用，数据将被建模为SqlTypes.JSON、SqlTypes.XML或SqlTypes.VARBINARY，这取决于通过新方法org.ibernate.dialect.dialect.getPreferredSqlTypeCodeForArray确定的数据库支持。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> wrapper<span class="token punctuation">;</span>
<span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> primitive<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="基本集合类型" tabindex="-1"><a class="header-anchor" href="#基本集合类型"><span>基本集合类型</span></a></h3><p>未使用@ElementCollection注释的基本集合（仅为集合的子类型）默认映射到类型代码SqlTypes.ARRAY，如果可能，该类型代码映射到SQL标准数组类型，这通过org.ibernate.dialect.dialect的新方法getArrayTypeName和supportsStandardArrays确定。如果SQL标准数组的类型不可用，数据将被建模为SqlTypes.JSON，SqlTypes.XML或SqlTypes.VARBINARY，具体取决于通过新方法org.ibernate.dialect.dialect.getPreferredSqlTypeCodeForArray确定的数据库支持。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Short</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
<span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Short</span><span class="token punctuation">&gt;</span></span> sortedSet<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="组合基本类型的映射" tabindex="-1"><a class="header-anchor" href="#组合基本类型的映射"><span>组合基本类型的映射</span></a></h3><h4 id="javatype" tabindex="-1"><a class="header-anchor" href="#javatype"><span>JavaType</span></a></h4><p>Hibernate需要了解Java类型的某些方面，才能正确有效地处理值。Hibernate通过org.ibernate.type.descriptor.java.JavaType合同了解这些功能。Hibernate为许多JDK类型（例如Integer、String）提供内置支持，但也支持应用程序更改任何标准JavaType注册的处理以及非标准类型的插件处理。Hibernate为应用程序提供了多种方式来影响要使用的JavaType描述符。</p><p>使用特定映射上的@JavaType注释可以在本地影响解析。所指示的描述符将仅用于该映射。也有@JavaType的形式，用于影响Map的键（@MapKeyJavaType）、List或数组的索引（@ListIndexJavaType），ID-BAG映射的标识符（@CollectionIdJavaType）以及ANY映射的鉴别器（@AnyDiscriminator）和键（@AnyKeyJavaClass，@AnyKeyJavaType）。</p><p>还可以通过向JavaTypeRegistry注册适当的JavaType描述符来全局影响解析。这种方法既可以“覆盖”某些Java类型的处理，也可以注册新类型。有关JavaTypeRegistry的讨论。</p><h4 id="jdbctype" tabindex="-1"><a class="header-anchor" href="#jdbctype"><span>JdbcType</span></a></h4><p>Hibernate还需要了解它应该使用的JDBC类型的各个方面（它应该如何绑定值，它应该如何提取值等），这是其org.Hibernate.type.descriptor.JDBC.JdbcType契约的作用。Hibernate为应用程序提供了多种方式来影响要使用的JdbcType描述符。</p><p>在本地，可以使用@JdbcType或@JdbcTypeCode注释来影响解析。还有一些注释可以影响与Map键（@MapKeyJdbcType，@MapKeyJdbcTypeCode）、List或数组的索引（@ListIndexJdbcType，@ListIndexJdbcTypeCode），ID-BAG映射的标识符（@CollectionIdJdbcType，@CollectionIdJdbcType）以及ANY映射的键（@AnyKeyJdbcType，@AnyKeyjdbcTypeCode）相关的Jdbc类型。@JdbcType指定要使用的特定Jdbc类型实现，而@JdbcTypeCode指定一个“代码”，然后根据JdbcTypeRegistry进行解析。</p><p>可以通过@JdbcTypeRegistration和TypeContributor来定制JdbcType注册表。有关JavaTypeRegistry的讨论，请参见Registrys。有关TypeContributor的讨论，请参阅TypeContributer。</p><h4 id="mutabilityplan" tabindex="-1"><a class="header-anchor" href="#mutabilityplan"><span>MutabilityPlan</span></a></h4><p>MutabilityPlan是Hibernate了解如何根据域值的内部可变性以及相关问题（如复制）来处理域值的方法。虽然这似乎是一个小问题，但它可能会对性能产生重大影响。请参阅AttributeConverter可变性计划，了解可能出现这种情况的一种情况。另一个讨论请参见案例研究：BitSet。</p><p>映射的MutabilityPlan可能会受到以下任何注释的影响：</p><ul><li><code>@Mutability</code></li><li><code>@Immutable</code></li><li><code>@MapKeyMutability</code></li><li><code>@CollectionIdMutability</code></li></ul><p>Hibernate按优先级顺序检查@Mutability和@Immutable的以下位置：</p><ul><li>映射的本地</li><li>在关联的AttributeConverter实现类（如果有）上</li><li>关于值的Java类型</li></ul><p>在大多数情况下，JavaType#getMutabilityPlan定义的回退是正确的策略。 Hibernate使用MutabilityPlan：</p><ul><li>检查值是否被认为是脏的</li><li>制作深度副本</li><li>将值封送至二级缓存和从二级缓存封送值</li></ul><p>一般来说，不可变值在所有这些情况下都表现得更好</p><ul><li>为了检查脏，Hibernate只需要检查对象标识（==），而不是相等（object#equals）。</li><li>相同的值实例可以用作其自身的深度副本。</li><li>可以从二级缓存以及我们放入二级缓存的值中使用相同的值。</li></ul><p>如果某个特定的Java类型被认为是可变的（例如Date），可以指定@Immutable或不可变的特定MutabilityPlan实现，让Hibernate将该值视为不可变。这也充当了应用程序的契约，即应用程序不会更改这些对象的内部状态。指定可变类型是不可变的，然后更改内部状态将导致问题；因此，只有在应用程序明确地不改变内部状态时才这样做。</p><h4 id="basicvalueconverter" tabindex="-1"><a class="header-anchor" href="#basicvalueconverter"><span>BasicValueConverter</span></a></h4><p>BasicValueConverter大致类似于AttributeConverter，因为它描述了在读取或写入基本值模型部分的值时发生的转换。事实上，Hibernate在内部将应用的AttributeConverter包装在BasicValueConverter中。它也在某些情况下应用隐式BasicValueConverter转换器，例如枚举处理等。</p><h4 id="解决合成问题" tabindex="-1"><a class="header-anchor" href="#解决合成问题"><span>解决合成问题</span></a></h4><p>使用这种组合方法，Hibernate需要解析映射的某些部分。通常这涉及到“填空”，因为它只针对映射的一部分进行配置。本节概述了如何解决此问题。</p><p>首先，我们寻找自定义类型。如果找到，则需要预先确定。有关详细信息，请参阅自定义类型映射</p><p>如果应用了AttributeConverter，我们将其用作解析的基础</p><ol><li><p>如果还使用@JavaType，则该特定JavaType用于转换器的“域类型”。否则，由转换器定义为其“域类型”的Java类型将根据JavaTypeRegistry进行解析</p></li><li><p>如果使用@JdbcType或@Jdbc TypeCode，则会使用指定的Jdbc类型，转换后的“关系Java类型”由JdbcType#getJdbcRecommendedJavaTypeMapping确定。否则，将使用转换器定义为其关系类型的Java类型，JdbcType由JdbcType#getRecommendedJdbcType确定</p></li><li><p>可在AttributeConverter实现、基本值映射或用作域类型的Java类型上使用@Mutability或@Immutable指定MutabilityPlan。否则，将使用转换域类型的JdbcType#getJdbcRecommendedJavaTypeMapping来确定可变性计划。</p></li></ol><p>接下来，我们尝试解析用于映射的JavaType。我们检查显式@JavaType，如果找到，则使用指定的JavaType。接下来，检查任何“隐含”指示；例如，List的索引具有隐式Java类型Integer。接下来，如果可能，我们使用反射。如果我们无法通过前面的步骤确定要使用的JavaType，我们尝试解析要使用的显式指定的JdbcType，如果找到，则使用其JdbcType#getJdbcRecommendedJavaTypeMapping作为映射的JavaType。如果此时无法确定JavaType，则会抛出错误。</p><p>然后检查先前解析的JavaType是否存在一些特殊情况。</p><ol><li>对于枚举值，我们检查显式@Enumerated并创建枚举映射。请注意，此解决方案仍然使用任何显式JdbcType指示符</li><li>对于时间值，我们检查@temporal并创建一个枚举映射。请注意，此解决方案仍然使用任何显式JdbcType指示符；这包括@JdbcType和@Jdbc TypeCode，以及@TimeZoneStorage和@TimeZone列（如果适用）。</li></ol><p>此时的退路是使用前面步骤中确定的JavaType和JdbcType来创建JDBC映射（它封装了JavaType和JdbcType），并将其与已解析的MutabilityPlan相结合 使用组合方法时，还有其他方法可以影响分辨率，如枚举、处理时间数据、处理LOB数据和处理国有化字符数据中所述 有关@JavaTypeRegistration和@JdbcTypeRegistratition的替代方案，请参阅TypeContributor。</p><h3 id="自定义类型映射" tabindex="-1"><a class="header-anchor" href="#自定义类型映射"><span>自定义类型映射</span></a></h3><p>另一种方法是使用@Type提供org.ibernate.usertype.UserType合约的实现。</p><p>对于特定的模型部分，也有相应的@Type专用形式：</p><ul><li>映射Map时，@Type描述Map值，而@MapKeyType描述Map键</li><li>映射id包时，@Type描述元素，而@CollectionIdType描述集合id</li><li>对于其他集合映射，@Type描述了元素</li><li>对于区分的关联映射（@Any和@ManyToAny），@Type描述了区分符值</li></ul><p>@Type允许更复杂的映射问题；但是，AttributeConverter和Compositional基本映射通常应首选为更简单的解决方案</p><h3 id="处理时间数据" tabindex="-1"><a class="header-anchor" href="#处理时间数据"><span>处理时间数据</span></a></h3><p>Hibernate支持以多种方式映射时间值，尽管这些策略最终归结为SQL规范定义的3种主要日期/时间类型：</p><ul><li>DATE</li><li>TIME</li><li>TIMESTAMP</li><li>TIMESTAMP WITH TIME ZONE</li></ul><p>java.time时间类型到特定SQL日期/时间类型的映射如下所示：</p><ul><li><p>DATE：java.time.LocalDate</p></li><li><p>TIME：java.time.LocalTime, java.time.OffsetTime</p></li><li><p>TIMESTAMP：java.time.Instant, java.time.LocalDateTime, java.time.OffsetDateTime and java.time.ZonedDateTime</p></li><li><p>TIMESTAMP WITH TIME ZONE：java.time.OffsetDateTime, java.time.ZonedDateTime</p></li></ul><p>尽管Hibernate建议使用java.time包来表示时间值，但它确实支持使用java.sql.Date、java.sql.time、java.sql_Timestamp、java.util.Date和java.util.Calendar。</p><ul><li><p>DATE：java.sql.Date</p></li><li><p>TIME：java.sql.Time</p></li><li><p>TIMESTAMP：java.sql.Timestamp</p></li></ul><p>将@Temporal应用于java.sql.Date、java.sql.Time、java.sql_Timestamp或任何java.Time类型都被视为异常。</p><p>当使用java.util.Date或java.util.Calendar时，Hibernate采用TIMESTAMP。要改变这种情况，请使用@Temporal。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// mapped as TIMESTAMP by default</span>
<span class="token class-name">Date</span> dateAsTimestamp<span class="token punctuation">;</span>

<span class="token comment">// explicitly mapped as DATE</span>
<span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span>
<span class="token class-name">Date</span> dateAsDate<span class="token punctuation">;</span>

<span class="token comment">// explicitly mapped as TIME</span>
<span class="token annotation punctuation">@Temporal</span><span class="token punctuation">(</span><span class="token class-name">TemporalType</span><span class="token punctuation">.</span><span class="token constant">TIME</span><span class="token punctuation">)</span>
<span class="token class-name">Date</span> dateAsTime<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用特定的时区" tabindex="-1"><a class="header-anchor" href="#使用特定的时区"><span>使用特定的时区</span></a></h4><p>默认情况下，当保存java.sql.Timestamp或java.sql.Time属性时，Hibernate将使用PreparedStatement.setTimestamp（int parameterIndex，java.sql.Ttimestamp）或PreparedSStatement.setTime（int paramarameterIndex，java.sql.Time x）。</p><p>当未指定时区时，JDBC驱动程序将使用底层JVM默认时区，如果应用程序在全球范围内使用，则该时区可能不适用。因此，每当从数据库保存/加载数据时，通常使用单个参考时区（例如UTC）。</p><p>另一种选择是将所有JVM配置为使用参考时区：</p><p>参数方式： <code>java -Duser.timezone=UTC</code></p><p>编程方式：<code>TimeZone.setDefault( TimeZone.getTimeZone( &quot;UTC&quot; ) );</code></p><p>然而，正如<a href="https://in.relation.to/2016/09/12/jdbc-time-zone-configuration-property/" target="_blank" rel="noopener noreferrer">本文<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>所解释的，这并不总是可行的，尤其是对于前端节点。因此，Hibernate提供了Hibernate.jdbc.time_zone配置属性，可以配置该属性：</p><p>声明性地，在SessionFactory级别：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>settings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>
    <span class="token class-name">AvailableSettings</span><span class="token punctuation">.</span><span class="token constant">JDBC_TIME_ZONE</span><span class="token punctuation">,</span>
    <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span> <span class="token string">&quot;UTC&quot;</span> <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>按每个会话编程:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token function">sessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">jdbcTimeZone</span><span class="token punctuation">(</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span> <span class="token string">&quot;UTC&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了这个配置属性，Hibernate将调用PreparedStatement.setTimestamp（int parameterIndex，java.sql.Timestamp，Calendar cal）或PreparedSStatement.setTime（int parametrIndex，java.ql.Time x，Calendar al），其中java.util.Calendar引用通过Hibernate.jdbc.Time_zone属性提供的时区。</p><h4 id="处理时间类型的时区" tabindex="-1"><a class="header-anchor" href="#处理时间类型的时区"><span>处理时间类型的时区</span></a></h4><p>默认情况下，Hibernate会将OffsetDateTime和ZonedDateTime转换并标准化为UTC格式的java.sql.Timestamp。可以通过配置hibernate.timezone.default_storage属性来更改此行为</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>settings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>
    <span class="token class-name">AvailableSettings</span><span class="token punctuation">.</span><span class="token constant">TIMEZONE_DEFAULT_STORAGE</span><span class="token punctuation">,</span>
    <span class="token class-name">TimeZoneStorageType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他可能的存储类型包括AUTO、COLUMN、NATIVE和NORMALIZE（默认值）。使用COLUMN，Hibernate将时区信息保存到一个专用列中，而NATIVE将需要数据库支持保留时区信息的TIMESTAMP With time zone数据类型。NORMALIZE不存储时区信息，只将时间戳转换为UTC。Hibernate通过方言#getTimeZoneSupport了解数据库/方言支持什么，如果NATIVE与不支持此功能的数据库一起使用，则会因启动错误而中止。对于AUTO，如果可能，Hibernate尝试使用NATIVE，否则返回COLUMN。</p><h3 id="timezonestorage" tabindex="-1"><a class="header-anchor" href="#timezonestorage"><span><code>@TimeZoneStorage</code></span></a></h3><p>Hibernate支持通过@TimeZoneStorage和@TimeZoneColumn注释定义存储以用于单个属性的时区信息。存储类型可以通过@TimeZoneStorage指定org.hibernate.annotations.TimeZoneStorageType来指定。默认存储类型为AUTO，这将确保保留时区信息。@TimeZoneColumn注释可与AUTO或COLUMN一起使用，并允许定义时区信息存储的列详细信息。</p><p>由于区域规则可能会更改，因此存储区域偏移量对于将来的时间戳可能会有问题。因此，存储偏移量仅对过去的时间戳是安全的，我们建议默认情况下坚持NORMALIZE策略。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@TimeZoneStorage</span><span class="token punctuation">(</span><span class="token class-name">TimeZoneStorageType</span><span class="token punctuation">.</span><span class="token constant">COLUMN</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TimeZoneColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;birthday_offset_offset&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;birthday_offset&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">OffsetDateTime</span> offsetDateTimeColumn<span class="token punctuation">;</span>

<span class="token annotation punctuation">@TimeZoneStorage</span><span class="token punctuation">(</span><span class="token class-name">TimeZoneStorageType</span><span class="token punctuation">.</span><span class="token constant">COLUMN</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TimeZoneColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;birthday_zoned_offset&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;birthday_zoned&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">ZonedDateTime</span> zonedDateTimeColumn<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="attributeconverters" tabindex="-1"><a class="header-anchor" href="#attributeconverters"><span>AttributeConverters</span></a></h3><p>使用自定义AttributeConverter，应用程序开发人员可以将给定的JDBC类型映射到实体基本类型。 在下面的示例中，java.time.Period将被映射到VARCHAR数据库列。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Converter</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeriodStringConverter</span>
        <span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Period</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">Period</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attribute<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Period</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Period</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>dbData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要使用此自定义转换器，@Convert注释必须修饰实体属性。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Event&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">PeriodStringConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Period</span> span<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当持久化这样的实体时，Hibernate将根据AttributeConverter逻辑进行类型转换：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Event <span class="token punctuation">(</span> span<span class="token punctuation">,</span> id <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">&#39;P1Y2M3D&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>AttributeConverter可以全局应用于（@Converter（autoApply=true））或本地应用。</p><h4 id="attributeconverter-java和jdbc类型" tabindex="-1"><a class="header-anchor" href="#attributeconverter-java和jdbc类型"><span>AttributeConverter Java和JDBC类型</span></a></h4><p>如果为转换的“数据库端”指定未知的Java类型（第二个AttributeConverter绑定参数），Hibernate将回退到Java.io.Serializable类型。 如果Hibernate不知道Java类型，您将遇到以下消息：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>HHH000481: Encountered Java type for which we could not locate a JavaType and which does not appear to implement equals and/or hashCode. This can lead to significant performance problems when performing equality/dirty checking involving this Java type. Consider registering a custom JavaType or at least implementing equals/hashCode.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果Java类型在JavaTypeRegistry中有注册，则它是“已知”的。虽然Hibernate确实将许多JDK类型加载到JavaTypeRegistry中，但应用程序也可以通过添加新的JavaType条目来扩展JavaTypeRegistry，如Compositional基本映射和TypeContributor中所讨论的。</p><h4 id="使用hbm映射映射attributeconverter" tabindex="-1"><a class="header-anchor" href="#使用hbm映射映射attributeconverter"><span>使用HBM映射映射AttributeConverter</span></a></h4><p>当使用HBM映射时，您仍然可以使用Jakarta Persistence AttributeConverter，因为Hibernate支持通过类型属性进行映射，如下例所示。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Money</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> cents<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Money</span><span class="token punctuation">(</span><span class="token keyword">long</span> cents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cents <span class="token operator">=</span> cents<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> cents<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCents</span><span class="token punctuation">(</span><span class="token keyword">long</span> cents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cents <span class="token operator">=</span> cents<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> owner<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Money</span> balance<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于Hibernate不知道如何持久化Money类型，我们可以使用Jakarta Persistence AttributeConverter将Money类型转换为Long。为此，我们将使用以下MoneyConverter实用程序：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MoneyConverter</span>
        <span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Money</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">Money</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attribute <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> attribute<span class="token punctuation">.</span><span class="token function">getCents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Money</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">Long</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dbData <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Money</span><span class="token punctuation">(</span>dbData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要使用HBM配置文件映射MoneyConverter，需要在property元素的type属性中使用<code>converted::</code>前缀。</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">hibernate-mapping</span> <span class="token name">PUBLIC</span>
        <span class="token string">&quot;-//Hibernate/Hibernate Mapping DTD 3.0//EN&quot;</span>
        <span class="token string">&quot;http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd&quot;</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hibernate-mapping</span> <span class="token attr-name">package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.hibernate.userguide.mapping.converter.hbm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Account<span class="token punctuation">&quot;</span></span> <span class="token attr-name">table</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>account<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>owner<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>balance<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>converted::org.hibernate.userguide.mapping.converter.hbm.MoneyConverter<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>class</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hibernate-mapping</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="attributeconverter-mutability-plan" tabindex="-1"><a class="header-anchor" href="#attributeconverter-mutability-plan"><span><code>AttributeConverter</code> Mutability Plan</span></a></h4><p>如果基础Java类型是不可变的，则由Jakarta Persistence AttributeConverter转换的基本类型是不可更改的；如果关联的属性类型也是可变的，那么基本类型是可变的。 因此，关联实体属性类型的JavaType#getMutabilityPlan提供了可变性。 这可以通过在以下任何一项上使用@Immutable或@Mutability进行调整：</p><ol><li>the basic value</li><li>the <code>AttributeConverter</code> class</li><li>the basic value type</li></ol><h4 id="不可变类型" tabindex="-1"><a class="header-anchor" href="#不可变类型"><span>不可变类型</span></a></h4><p>如果实体属性是字符串、基本包装器（例如Integer、Long）、枚举类型或任何其他不可变的Object类型，则只能通过将实体属性值重新分配为新值来更改实体属性值。</p><p>考虑到我们具有与AttributeConverters部分所示相同的Period实体属性：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Event&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">PeriodStringConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Period</span> span<span class="token punctuation">;</span>

    <span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改span属性的唯一方法是将其重新指定为其他值：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code> <span class="token class-name">Event</span> event <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">&quot;from Event&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 event<span class="token punctuation">.</span><span class="token function">setSpan</span><span class="token punctuation">(</span><span class="token class-name">Period</span>
     <span class="token punctuation">.</span><span class="token function">ofYears</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">plusMonths</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="可变类型" tabindex="-1"><a class="header-anchor" href="#可变类型"><span>可变类型</span></a></h4><p>另一方面，考虑以下示例，其中Money类型是可变的。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Money</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">long</span> cents<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> owner<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">MoneyConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Money</span> balance<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MoneyConverter</span>
		<span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Money</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">Money</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> attribute <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> attribute<span class="token punctuation">.</span><span class="token function">getCents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Money</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">Long</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> dbData <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Money</span><span class="token punctuation">(</span>dbData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可变对象允许您修改其内部结构，Hibernate的脏检查机制会将更改传播到数据库：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Account</span> account <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
account<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCents</span><span class="token punctuation">(</span><span class="token number">150</span> <span class="token operator">*</span> <span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尽管AttributeConverter类型可以是可变的，以便脏检查、深度复制和二级缓存能够正常工作，但将它们视为不可变（当它们确实是不可变时）更有效。 出于这个原因，尽可能选择不可变类型而不是可变类型。</p><h4 id="使用attributeconverter实体属性作为查询参数" tabindex="-1"><a class="header-anchor" href="#使用attributeconverter实体属性作为查询参数"><span>使用AttributeConverter实体属性作为查询参数</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Photo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Photo</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">CaptionConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">Caption</span> caption<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Caption</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Caption</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> text<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token operator">==</span> o <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span> o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">Caption</span> caption <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Caption</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
		<span class="token keyword">return</span> text <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> text<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span> caption<span class="token punctuation">.</span>text <span class="token punctuation">)</span> <span class="token operator">:</span> caption<span class="token punctuation">.</span>text <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> text <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> text<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CaptionConverter</span>
		<span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Caption</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">Caption</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> attribute<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Caption</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Caption</span><span class="token punctuation">(</span> dbData <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>传统上，当引用Caption实体属性时，只能使用DB数据Caption表示，在我们的例子中，它是一个字符串。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Photo</span> photo <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>
				<span class="token string">&quot;select p &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;from Photo p &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;where upper(caption) = upper(:caption) &quot;</span><span class="token punctuation">,</span> <span class="token class-name">Photo</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span> <span class="token string">&quot;caption&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nicolae Grigorescu&quot;</span> <span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了使用Java对象Caption表示，必须获取相关的Hibernate类型。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">SessionFactoryImplementor</span> sessionFactory <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getEntityManagerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span> <span class="token class-name">SessionFactoryImplementor</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">MappingMetamodelImplementor</span> mappingMetamodel <span class="token operator">=</span> sessionFactory
		<span class="token punctuation">.</span><span class="token function">getRuntimeMetamodels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">getMappingMetamodel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Type</span> captionType <span class="token operator">=</span> mappingMetamodel
		<span class="token punctuation">.</span><span class="token function">getEntityDescriptor</span><span class="token punctuation">(</span> <span class="token class-name">Photo</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">getPropertyType</span><span class="token punctuation">(</span> <span class="token string">&quot;caption&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Photo</span> photo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Photo</span><span class="token punctuation">)</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>
				<span class="token string">&quot;select p &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;from Photo p &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;where upper(caption) = upper(:caption) &quot;</span><span class="token punctuation">,</span> <span class="token class-name">Photo</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>
				<span class="token string">&quot;caption&quot;</span><span class="token punctuation">,</span>
				<span class="token keyword">new</span> <span class="token class-name">Caption</span><span class="token punctuation">(</span> <span class="token string">&quot;Nicolae Grigorescu&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token punctuation">(</span><span class="token class-name">BindableType</span><span class="token punctuation">)</span> captionType
		<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">getSingleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过传递关联的Hibernate类型，可以在绑定查询参数值时使用Caption对象。</p><h3 id="registries" tabindex="-1"><a class="header-anchor" href="#registries"><span>Registries</span></a></h3><p>我们已经多次介绍了JavaTypeRegistry和JdbcTypeRegistry，主要是在解析组合中讨论的映射解析方面。但它们各自也发挥着额外的重要作用。 JavaTypeRegistry是由Java类型键入的JavaType引用的注册表。除了映射解析之外，该注册表还用于处理各种API（如查询参数类型）中公开的类引用。JavaType引用可以通过@JavaTypeRegistration注册。</p><p>JdbcTypeRegistry是由整数代码键入的JdbcType引用的注册表。正如JdbcType中所讨论的，这些类型代码通常与java.sql.Types中的相应代码匹配，但这不是一个要求-可以使用java.sql.type定义的整数以外的整数。这对于映射JDBC用户数据类型（UDT）或其他专用数据库特定类型（例如PostgreSQL的UUID类型）可能很有用。除了在映射解析中使用它之外，该注册表还用作解析JDBC ResultSet中“发现”值的主要源。JdbcType引用可以通过@JdbcTypeRegistration注册。</p><h3 id="typecontributor" tabindex="-1"><a class="header-anchor" href="#typecontributor"><span>TypeContributor</span></a></h3><p>org.ibernate.boot.model.TypeContributor是一个重写或扩展hibernate类型系统部分的合约。 有许多方法可以集成TypeContributor。最常见的是将TypeContributor定义为Java服务（请参见Java.util.ServiceLoader）。</p><p>TypeContributor被传递一个TypeContributions引用，该引用允许注册自定义JavaType、JdbcType和BasicType引用。</p><p>虽然TypeContributor仍然公开了注册BasicType引用的功能，但这被认为是不推荐的。从6.0开始，这些BasicType注册仅在解释hbm.xml映射时使用，这些映射本身被认为是不推荐的。请改用自定义类型映射或合成基本映射。</p><h3 id="案例研究-bitset" tabindex="-1"><a class="header-anchor" href="#案例研究-bitset"><span>案例研究：BitSet</span></a></h3><p>到目前为止，我们已经介绍了许多指定基本值映射的方法。本节将通过应用到目前为止介绍的不同技术来研究java.util.BitSet类型的映射。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如前所述，Hibernate映射实现Serializable的基本类型的最坏情况是将其序列化到数据库。BitSet确实实现了Serializable，因此默认情况下Hibernate将通过序列化处理此映射。</p><p>这不是一个理想的映射。在下面的部分中，我们将研究如何改变BitSet如何映射到数据库的各个方面。</p><h5 id="using-attributeconverter" tabindex="-1"><a class="header-anchor" href="#using-attributeconverter"><span>Using <code>AttributeConverter</code></span></a></h5><p>这在大多数情况下都很有效，并且可以在Jakarta Persistence提供者之间移植。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Convert</span><span class="token punctuation">(</span>converter <span class="token operator">=</span> <span class="token class-name">BitSetConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Converter</span><span class="token punctuation">(</span>autoApply <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">BitSetConverter</span> <span class="token keyword">implements</span> <span class="token class-name">AttributeConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BitSet</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">convertToDatabaseColumn</span><span class="token punctuation">(</span><span class="token class-name">BitSet</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">BitSetHelper</span><span class="token punctuation">.</span><span class="token function">bitSetToString</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">BitSet</span> <span class="token function">convertToEntityAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">BitSetHelper</span><span class="token punctuation">.</span><span class="token function">stringToBitSet</span><span class="token punctuation">(</span>dbData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这大大提高了处理这些BitSet值的读写性能，因为AttributeConverter使用简单的可外化形式的BitSet，而不是序列化和反序列化值，可以更有效地实现这一点。</p><h4 id="使用javatypedescriptor" tabindex="-1"><a class="header-anchor" href="#使用javatypedescriptor"><span>使用<code>JavaTypeDescriptor</code></span></a></h4><p>如[基本映射显式]中所述，我们将为BitSet定义一个JavaType，默认情况下将值映射到VARCHAR进行存储。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BitSetJavaType</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClassJavaType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BitSet</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">BitSetJavaType</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitSetJavaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BitSetJavaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">BitSet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">MutabilityPlan</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BitSet</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMutabilityPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BitSetMutabilityPlan</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcType</span> <span class="token function">getRecommendedJdbcType</span><span class="token punctuation">(</span><span class="token class-name">JdbcTypeIndicators</span> indicators<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> indicators<span class="token punctuation">.</span><span class="token function">getTypeConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getJdbcTypeRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getDescriptor</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">VARCHAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">BitSet</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BitSetHelper</span><span class="token punctuation">.</span><span class="token function">bitSetToString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BitSet</span> <span class="token function">fromString</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BitSetHelper</span><span class="token punctuation">.</span><span class="token function">stringToBitSet</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">X</span> <span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token class-name">BitSet</span> value<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">WrapperOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BitSet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">X</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">X</span><span class="token punctuation">)</span> <span class="token function">toString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getComponentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">byte</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">X</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token function">unknownUnwrap</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">BitSet</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">X</span> value<span class="token punctuation">,</span> <span class="token class-name">WrapperOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">CharSequence</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">fromString</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span><span class="token punctuation">)</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">BitSet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">BitSet</span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token function">unknownWrap</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以使用@JavaType在本地应用该类型</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@JavaType</span><span class="token punctuation">(</span><span class="token class-name">BitSetJavaType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者我们可以使用@JavaTypeRegistration全局应用它。这允许在遇到BitSet类型时将注册的JavaType用作默认值</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JavaTypeRegistration</span><span class="token punctuation">(</span>javaType <span class="token operator">=</span> <span class="token class-name">BitSet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> descriptorClass <span class="token operator">=</span> <span class="token class-name">BitSetJavaType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="选择不同的jdbctypedescriptor" tabindex="-1"><a class="header-anchor" href="#选择不同的jdbctypedescriptor"><span>选择不同的JdbcTypeDescriptor</span></a></h4><p>默认情况下，我们的自定义BitSetJavaType将BitSet值映射到VARCHAR。这是一个比直接序列化更好的选项。但由于BitSet最终是二进制数据，我们可能真的希望将其映射为VARBINARY类型。一种方法是将BitSetJavaType#getRecommendedJdbcType更改为返回VARBINARY描述符。另一种选择是使用本地@JdbcType或@JdbcTypeCode。</p><p>指定JdbcType的示例假设我们的BitSetJavaType是全局注册的。 我们将再次将这些值作为VARBINARY存储在数据库中。然而，现在的区别是，强制方法#wrap和#unwrap将用于准备值，而不是依赖于序列化。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@JdbcTypeCode</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">VARBINARY</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在本例中，@JdbcTypeCode用于指示应使用为JDBC的VARBINARY类型注册的JdbcType。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@JdbcType</span><span class="token punctuation">(</span><span class="token class-name">CustomBinaryJdbcType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在本例中，@JdbcType已用于为该属性本地指定自定义BitSetJdbc类型描述符。 我们可以使用@JdbcTypeRegistration替换Hibernate处理所有VARBINARY的方式，使用我们的自定义impl</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@JdbcTypeRegistration</span><span class="token punctuation">(</span><span class="token class-name">CustomBinaryJdbcType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">BitSet</span> bitSet<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql引用标识符" tabindex="-1"><a class="header-anchor" href="#sql引用标识符"><span>SQL引用标识符</span></a></h3><p>您可以强制Hibernate在生成的SQL中引用标识符，方法是将表或列名括在映射文档的反引号中。传统上，Hibernate使用反引号来转义SQL保留关键字，而Jakarta Persistence使用双引号。</p><p>一旦转义了保留的关键字，Hibernate将为SQL方言使用正确的引号样式。这通常是双引号，但SQL Server使用括号，MySQL使用反引号。</p><p><em>Hibernate quoting</em></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;`name`&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;`number`&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>Jakarta Persistence quoting</em></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;\&quot;name\&quot;&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;\&quot;number\&quot;&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为name和number是保留字，Product实体映射使用反引号引用这些列名。保存以下Product实体时，Hibernate生成以下SQL插入语句：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;Mobile phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token string">&quot;123-456-7890&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Product <span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;Mobile phone&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123-456-7890&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="全局引号" tabindex="-1"><a class="header-anchor" href="#全局引号"><span>全局引号</span></a></h4><p>Hibernate还可以使用以下配置属性引用所有标识符（例如表、列）：</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span>
    <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hibernate.globally_quoted_identifiers<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，我们不需要手动引用任何标识符：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Product&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当持久化Product实体时，Hibernate将引用所有标识符，如下例所示：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token string">&quot;Product&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;Mobile phone&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;123-456-7890&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如您所见，表名和所有列都被引用了。</p><h3 id="生成属性" tabindex="-1"><a class="header-anchor" href="#生成属性"><span>生成属性</span></a></h3><p>本节讨论为非标识符属性生成值。有关生成标识符值的讨论，请参阅生成标识符值。</p><p>生成的属性的值是在执行SQL INSERT或UPDATE时生成的。应用程序可以通过多种方式生成这些值（SQLDEFAULT值、触发器等）。通常，应用程序需要刷新对象，这是一个主要缺点。</p><p>应用程序还可以将生成委托给Hibernate，在这种情况下，Hibernate将自行管理值生成和（潜在的[3]）状态刷新。</p><p>只能将@Basic和@Version属性标记为已生成。此外，生成的属性必须是不可插入和不可更新的。</p><p>Hibernate支持VM和DB生成。使用当前JVM时间戳作为生成值的生成是VM内策略的一个示例。使用数据库的current_timestamp函数的生成是数据库内策略的一个示例。</p><p>Hibernate支持以下生成策略：</p><ul><li><code>NEVER</code> (the default)：未生成给定的属性值</li><li>INSERT：属性值在插入时生成，但在后续更新时不会重新生成</li><li>ALWAYS：插入和更新时都会生成属性值。</li></ul><p>Hibernate支持多种方式将属性标记为生成：</p><ul><li>使用Hibernate提供的专用生成器</li></ul><ul><li><code>@CurrentTimestamp</code> - <a href="https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-CurrentTimestamp" target="_blank" rel="noopener noreferrer"><code>@CurrentTimestamp</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>@CreationTimestamp</code> - <a href="https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-CreationTimestamp" target="_blank" rel="noopener noreferrer"><code>@CreationTimestamp</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>@UpdateTimestamp</code> - <a href="https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-UpdateTimestamp" target="_blank" rel="noopener noreferrer"><code>@UpdateTimestamp</code> annotation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>@Generated</code> - <a href="https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#mapping-generated-Generated" target="_blank" rel="noopener noreferrer"><code>@Generated</code> annotation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><ul><li>@GeneratorType-已弃用，此处未涉及</li><li>使用自定义生成策略-自定义生成策略</li></ul><h5 id="currenttimestamp" tabindex="-1"><a class="header-anchor" href="#currenttimestamp"><span><code>@CurrentTimestamp</code></span></a></h5><p>@CurrentTimestamp注释是一种db生成策略，可以配置INSERT或ALWAYS策略。它使用数据库的current_timestamp函数作为生成的值</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@CurrentTimestamp</span><span class="token punctuation">(</span> timing <span class="token operator">=</span> <span class="token class-name">GenerationTiming</span><span class="token punctuation">.</span><span class="token constant">INSERT</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Instant</span> createdAt<span class="token punctuation">;</span>

<span class="token annotation punctuation">@CurrentTimestamp</span><span class="token punctuation">(</span> timing <span class="token operator">=</span> <span class="token class-name">GenerationTiming</span><span class="token punctuation">.</span><span class="token constant">ALWAYS</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Instant</span> lastUpdatedAt<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="creationtimestamp" tabindex="-1"><a class="header-anchor" href="#creationtimestamp"><span><code>@CreationTimestamp</code></span></a></h5><p>@CreationTimestamp注释是VM内INSERT策略。Hibernate将使用JVM的当前时间戳作为属性的插入值。支持大多数时间类型（java.time.Instant、java.util.Date、java.util.Calendar等）</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Event&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;`timestamp`&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@CreationTimestamp</span>
	<span class="token keyword">private</span> <span class="token class-name">Date</span> timestamp<span class="token punctuation">;</span>

	<span class="token comment">//Constructors, getters, and setters are omitted for brevity</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在插入事件时，Hibernate将用当前JVM时间戳值填充底层时间戳列</p><h5 id="updatetimestamp" tabindex="-1"><a class="header-anchor" href="#updatetimestamp"><span><code>@UpdateTimestamp</code></span></a></h5><p>@UpdateTimestamp注释是VM内INSERT策略。Hibernate将使用JVM的当前时间戳作为属性的插入和更新值。支持大多数时间类型（java.time.Instant、java.util.Date、java.util.Calendar等）</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Bid&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Bid</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;updated_on&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@UpdateTimestamp</span>
	<span class="token keyword">private</span> <span class="token class-name">Date</span> updatedOn<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;updated_by&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> updatedBy<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Long</span> cents<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters are omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="generated" tabindex="-1"><a class="header-anchor" href="#generated"><span><code>@Generated</code></span></a></h5><p>@Generated注释是一种DB内策略，可以配置timing等于INSERT或ALWAYS,这是DB中生成值的遗留映射。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName1<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName2<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName3<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName4<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> middleName5<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Generated</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">GenerationTime</span><span class="token punctuation">.</span><span class="token constant">ALWAYS</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span>
		<span class="token string">&quot;AS CONCAT(&quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(firstName, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + middleName1, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + middleName2, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + middleName3, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + middleName4, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + middleName5, &#39;&#39;), &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;	COALESCE(&#39; &#39; + lastName, &#39;&#39;) &quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> fullName<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自定义生成策略" tabindex="-1"><a class="header-anchor" href="#自定义生成策略"><span>自定义生成策略</span></a></h4><p>Hibernate还支持使用@ValueGenerationType和AnnotationValueGeneration可插拔API生成值，允许用户定义他们想要的任何生成策略。 让我们看一个生成UUID值的示例。首先是属性映射</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@GeneratedUuidValue</span><span class="token punctuation">(</span> timing <span class="token operator">=</span> <span class="token class-name">GenerationTiming</span><span class="token punctuation">.</span><span class="token constant">INSERT</span> <span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UUID</span> createdUuid<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GeneratedUuidValue</span><span class="token punctuation">(</span> timing <span class="token operator">=</span> <span class="token class-name">GenerationTiming</span><span class="token punctuation">.</span><span class="token constant">ALWAYS</span> <span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">UUID</span> updatedUuid<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个示例使用了一个名为@GeneratedUuidValue的注释，但该注释是在哪里定义的？这是应用程序提供的自定义注释。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@ValueGenerationType</span><span class="token punctuation">(</span> generatedBy <span class="token operator">=</span> <span class="token class-name">UuidValueGeneration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">GeneratedUuidValue</span> <span class="token punctuation">{</span>
	<span class="token class-name">GenerationTiming</span> <span class="token function">timing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的@ValueGenerationType（generatedBy=UuidValueGeneration.class）是重要的部分；它告诉Hibernate如何为属性生成值-在这里它将使用指定的UuidValueGeneration类</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UuidValueGeneration</span> <span class="token keyword">implements</span> <span class="token class-name">AnnotationValueGeneration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GeneratedUuidValue</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">ValueGenerator</span><span class="token generics"><span class="token punctuation">&lt;</span>UUID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">GenerationTiming</span> timing<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">GeneratedUuidValue</span> annotation<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> propertyType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		timing <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">timing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">GenerationTiming</span> <span class="token function">getGenerationTiming</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> timing<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ValueGenerator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getValueGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">referenceColumnInSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDatabaseGeneratedReferencedColumnValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">UUID</span> <span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">,</span> <span class="token class-name">Object</span> owner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列转化换器-读取和写入表达式" tabindex="-1"><a class="header-anchor" href="#列转化换器-读取和写入表达式"><span>列转化换器：读取和写入表达式</span></a></h3><p>Hibernate允许您自定义用于读取和写入映射到@Basic类型的列值的SQL。例如，如果您的数据库提供了一组数据加密函数，则可以像下面的示例一样为各个列调用它们。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Employee&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Id</span>
		<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@NaturalId</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;pswd&quot;</span><span class="token punctuation">)</span>
		<span class="token annotation punctuation">@ColumnTransformer</span><span class="token punctuation">(</span>
			read <span class="token operator">=</span> <span class="token string">&quot;decrypt(&#39;AES&#39;, &#39;00&#39;, pswd )&quot;</span><span class="token punctuation">,</span>
			write <span class="token operator">=</span> <span class="token string">&quot;encrypt(&#39;AES&#39;, &#39;00&#39;, ?)&quot;</span>
		<span class="token punctuation">)</span>
<span class="token comment">// For H2 2.0.202+ one must use the varbinary DDL type</span>
<span class="token comment">//		@Column(name = &quot;pswd&quot;, columnDefinition = &quot;varbinary&quot;)</span>
<span class="token comment">//		@ColumnTransformer(</span>
<span class="token comment">//			read = &quot;trim(trailing u&amp;&#39;\\0000&#39; from cast(decrypt(&#39;AES&#39;, &#39;00&#39;, pswd ) as character varying))&quot;,</span>
<span class="token comment">//			write = &quot;encrypt(&#39;AES&#39;, &#39;00&#39;, ?)&quot;</span>
<span class="token comment">//		)</span>
		<span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

		<span class="token keyword">private</span> <span class="token keyword">int</span> accessLevel<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">Department</span> department<span class="token punctuation">;</span>

		<span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;employees&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Project</span><span class="token punctuation">&gt;</span></span> projects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//Getters and setters omitted for brevity</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果属性使用多个列，则必须使用forColumn属性指定@ColumnTransformer读写表达式的目标列:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;Savings&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Savings</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Id</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@CompositeType</span><span class="token punctuation">(</span><span class="token class-name">MonetaryAmountUserType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@AttributeOverrides</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token annotation punctuation">@AttributeOverride</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;amount&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@AttributeOverride</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@ColumnTransformer</span><span class="token punctuation">(</span>
			forColumn <span class="token operator">=</span> <span class="token string">&quot;money&quot;</span><span class="token punctuation">,</span>
			read <span class="token operator">=</span> <span class="token string">&quot;money / 100&quot;</span><span class="token punctuation">,</span>
			write <span class="token operator">=</span> <span class="token string">&quot;? * 100&quot;</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">MonetaryAmount</span> wallet<span class="token punctuation">;</span>

	<span class="token comment">//Getters and setters omitted for brevity</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每当查询中引用属性时，Hibernate都会自动应用自定义表达式。此功能类似于派生属性[映射列公式]，但有两个区别：</p><ul><li>该属性由一个或多个列作为自动架构生成的一部分导出。</li><li>该属性是读写的，而不是只读的。</li></ul><p>如果指定了write表达式，则该表达式必须仅包含一个“？”值的占位符。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>doInJPA<span class="token punctuation">(</span>this::entityManagerFactory<span class="token punctuation">,</span> entityManager <span class="token operator">-</span><span class="token operator">&gt;</span> {
	Savings savings <span class="token operator">=</span> new Savings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	savings<span class="token punctuation">.</span>setId<span class="token punctuation">(</span><span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
	savings<span class="token punctuation">.</span>setWallet<span class="token punctuation">(</span>new MonetaryAmount<span class="token punctuation">(</span>BigDecimal<span class="token punctuation">.</span>TEN<span class="token punctuation">,</span> Currency<span class="token punctuation">.</span>getInstance<span class="token punctuation">(</span>Locale<span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	entityManager<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>savings<span class="token punctuation">)</span><span class="token punctuation">;</span>
}<span class="token punctuation">)</span><span class="token punctuation">;</span>

doInJPA<span class="token punctuation">(</span>this::entityManagerFactory<span class="token punctuation">,</span> entityManager <span class="token operator">-</span><span class="token operator">&gt;</span> {
	Savings savings <span class="token operator">=</span> entityManager<span class="token punctuation">.</span>find<span class="token punctuation">(</span>Savings<span class="token punctuation">.</span>class<span class="token punctuation">,</span> <span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
	assertEquals<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> savings<span class="token punctuation">.</span>getWallet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getAmount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>intValue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	assertEquals<span class="token punctuation">(</span>Currency<span class="token punctuation">.</span>getInstance<span class="token punctuation">(</span>Locale<span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">,</span> savings<span class="token punctuation">.</span>getWallet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getCurrency<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
}<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Savings <span class="token punctuation">(</span>money<span class="token punctuation">,</span> currency<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&#39;USD&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span>
    s<span class="token punctuation">.</span>id <span class="token keyword">as</span> id1_0_0_<span class="token punctuation">,</span>
    s<span class="token punctuation">.</span>money <span class="token operator">/</span> <span class="token number">100</span> <span class="token keyword">as</span> money2_0_0_<span class="token punctuation">,</span>
    s<span class="token punctuation">.</span>currency <span class="token keyword">as</span> currency3_0_0_
<span class="token keyword">FROM</span>
    Savings s
<span class="token keyword">WHERE</span>
    s<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="criteria查询" tabindex="-1"><a class="header-anchor" href="#criteria查询"><span>Criteria查询</span></a></h1><p>条件查询为HQL、JPQL和native SQL查询提供了一种类型安全的替代方法。</p><p>条件查询是一种编程的、类型安全的表达查询的方式。使用接口和类来表示查询的各个部分（如查询本身、select子句或order by等）。在引用属性方面，它们也是类型安全的，我们稍后会看到。</p><p>条件查询本质上是一个对象图，图中的每个部分表示一个原子的查询。执行条件查询的第一步是构建此图。在使用条件查询之前，首先需要熟悉jakarta.persistence.criteria.CriteriaBuilder接口。它是CriteriaQuery的构建工厂。通过调用jakarta.persistence.EntityManagerFactory或jakarta.persistence.EntityManager的getCriteriaBuilder（）方法，可以获得jakarta.prersistence.CriteriaBuilder实例。</p><p>下一步是获取jakarta.persistence.criteria.CriteriaQuery。为此，可以使用jakarta.prersistence.coriteria.CriteriaBuilder上的三种方法之一完成此操作：</p><ul><li><code>&lt;T&gt; CriteriaQuery&lt;T&gt; createQuery( Class&lt;T&gt; resultClass )</code></li><li><code>CriteriaQuery&lt;Tuple&gt; createTupleQuery()</code></li><li><code>CriteriaQuery&lt;Object&gt; createQuery()</code></li></ul><p>根据查询结果的类型，每种方法都有不同的用途。</p><h2 id="条件查询的类型" tabindex="-1"><a class="header-anchor" href="#条件查询的类型"><span>条件查询的类型</span></a></h2><p>条件查询的类型（也称为＜T＞）指示查询结果中的预期类型。这可能是实体、整数或任何其他对象。</p><h2 id="选择实体" tabindex="-1"><a class="header-anchor" href="#选择实体"><span>选择实体</span></a></h2><p>这可能是最常见的查询形式。应用程序希望查询实体实例。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1.</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.</span>
criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3.</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//4.</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>该示例使用createQuery()传入Person类引用，因为查询结果将是Person对象。</li><li>选择查询的实体， 对应SQL中的 <code>from table</code></li><li>指定返回那些列，本例中对CriteriaQuery#select方法的调用是不必要的，因为根将是隐含的选择，因为我们只有一个查询根。这里只做了一个示例的完整性。</li><li>Person_.name引用是Jakarta Persistence Metamodel引用的静态形式的一个示例。</li></ol><h2 id="选择表达式" tabindex="-1"><a class="header-anchor" href="#选择表达式"><span>选择表达式</span></a></h2><p>选择表达式的最简单形式是从实体中选择特定属性。但这个表达式也可能表示聚合、数学运算等。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNames <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在本例中，查询类型为java.lang.String，因为这是预期的结果类型（Person#nickName属性的类型为java.lang.String）。属性引用通过Root#get方法调用完成的。</p><h2 id="选择多个值" tabindex="-1"><a class="header-anchor" href="#选择多个值"><span>选择多个值</span></a></h2><p>实际上，使用条件查询选择多个值有几种不同的方法。我们将在这里探讨两个选项，一种推荐的方法是使用元组，另一种是包装器查询。</p><h5 id="示例-使用数组" tabindex="-1"><a class="header-anchor" href="#示例-使用数组"><span>示例：使用数组</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idPath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNamePath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>idPath<span class="token punctuation">,</span> nickNamePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> idAndNickNames <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从技术上讲，这被归类为类型化查询，但从处理结果中可以看出，这有点误导。无论如何，这里的预期结果类型是一个数组。</p><h5 id="示例-使用multiselect" tabindex="-1"><a class="header-anchor" href="#示例-使用multiselect"><span>示例：使用multiselect</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idPath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNamePath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>idPath<span class="token punctuation">,</span> nickNamePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> idAndNickNames <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="选择-包装器" tabindex="-1"><a class="header-anchor" href="#选择-包装器"><span>选择 包装器</span></a></h2><p>选择多个值的另一种选择是选择一个对象，该对象将“包装”多个值。返回示例查询，而不是返回[Person#id，Person#nickName]数组，而是声明一个保存这些值的类并将其用作返回对象。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonWrapper</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PersonWrapper</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> nickName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nickName <span class="token operator">=</span> nickName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNickName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> nickName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PersonWrapper</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">PersonWrapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idPath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNamePath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token class-name">PersonWrapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> idPath<span class="token punctuation">,</span> nickNamePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PersonWrapper</span><span class="token punctuation">&gt;</span></span> wrappers <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先，我们看到将用于包装结果值的包装器对象的简单定义。具体来说，请注意构造函数及其参数类型。因为我们将返回PersonWrapper对象，所以我们使用PersonWrappe作为条件查询的类型。</p><h2 id="元组条件查询" tabindex="-1"><a class="header-anchor" href="#元组条件查询"><span>元组条件查询</span></a></h2><p>选择多个值的更好方法是使用包装器（我们刚刚在选择包装器中看到）或使用jakarta.persistence.Tuple合约。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Tuple</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idPath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Path</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNamePath <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>idPath<span class="token punctuation">,</span> nickNamePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> tuples <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tuple</span> tuple <span class="token operator">:</span> tuples<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Long</span> id <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> nickName <span class="token operator">=</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nickNamePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//or using indices</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tuple</span> tuple <span class="token operator">:</span> tuples<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> nickName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此示例说明如何通过jakarta.persistence.Tuple接口访问查询结果。该示例使用jakarta.persistence.criteria.criteria.CriteriaBuilder的显式createTupleQuery（）。另一种方法是使用createQuery（Tuple.class）。</p><p>jakarta.persistence.Tuple合同提供了三种形式的底层元素访问：</p><ul><li>typed: <code>tuple.get( idPath )</code> 和 <code>tuple.get( nickNamePath )</code>使用的就是这种方式，这允许基于用于构建条件的jakarta.persistence.TupleElement表达式对底层元组值进行类型化访问。</li><li>positional： 允许基于位置访问基础元组值。简单的Object get（int position）形式与选择数组和使用multiselect选择数组中所示的访问非常相似。＜X＞X get（int position，Class＜X＞类型形式允许类型化位置访问，但基于显式提供的类型，元组值必须是类型可赋值的。</li><li>aliased：允许基于（可选）分配的别名访问基础元组值。示例查询未应用别名。别名将通过jakarta.persistence.criteriaSelection上的alias 方法应用。就像位置访问一样，有类型化（Object get（String alias））和非类型化（＜X＞X get（String别名，Class＜X＞type））形式。</li></ul><h2 id="from子句" tabindex="-1"><a class="header-anchor" href="#from子句"><span>from子句</span></a></h2><p>CriteriaQuery对象定义对一个或多个实体、可嵌入或基本抽象模式类型的查询。查询的根对象是实体，可以从中访问其他类型。</p><p>FROM子句的所有单独部分（roots, joins, paths）都实现了jakarta.persistence.criteria.FROM接口。</p><h2 id="roots" tabindex="-1"><a class="header-anchor" href="#roots"><span>roots</span></a></h2><p>根定义查询中所有join、路径和属性的基础。根始终是实体类型。根由jakarta.persistence.criteria.criteria.CriteriaQuery上的重载from方法定义并添加到条件中：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token function">from</span><span class="token punctuation">(</span> <span class="token class-name">EntityType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例如下：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>条件查询可以定义多个根，其效果是在新添加的根和其他根之间创建笛卡尔积：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Tuple</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personRoot <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Partner</span><span class="token punctuation">&gt;</span></span> partnerRoot <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Partner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>personRoot<span class="token punctuation">,</span> partnerRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Predicate</span> personRestriction <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
	builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>personRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">,</span>
	builder<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>personRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>phones<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Predicate</span> partnerRestriction <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>
	builder<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>partnerRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Partner_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> prefix<span class="token punctuation">)</span><span class="token punctuation">,</span>
	builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>partnerRoot<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Partner_</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>personRestriction<span class="token punctuation">,</span> partnerRestriction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> tuples <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="joins" tabindex="-1"><a class="header-anchor" href="#joins"><span>joins</span></a></h2><p>joins允许从其他jakarta.persistence.criteria.from导航到关联或嵌入属性。joins是由jakarta.persistence.criteria.From接口的大量重载join方法创建的。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Phone.person is a @ManyToOne</span>
<span class="token class-name">Join</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personJoin <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Person.addresses is an @ElementCollection</span>
<span class="token class-name">Join</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> addressesJoin <span class="token operator">=</span> personJoin<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>addresses<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>calls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> phones <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fetches" tabindex="-1"><a class="header-anchor" href="#fetches"><span>Fetches</span></a></h2><p>就像在HQL和JPQL中一样，条件查询可以指定与所有者一起fetch关联数据。fetch由jakarta.persistence.criteria.From接口的大量重载fetch方法创建。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Phone</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Phone.person is a @ManyToOne</span>
<span class="token class-name">Fetch</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personFetch <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Person.addresses is an @ElementCollection</span>
<span class="token class-name">Fetch</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> addressesJoin <span class="token operator">=</span> personFetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>addresses<span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>calls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> phones <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从技术上讲，嵌入属性总是从其所有者那里获取的。然而，为了定义Phone#addresses的获取，我们需要jakarta.persistence.criteria.Fetch，因为元素集合默认为LAZY。</p><h2 id="path-expressions" tabindex="-1"><a class="header-anchor" href="#path-expressions"><span>Path expressions</span></a></h2><p>Roots, joins 和 fetches本身也是路径表达式。</p><h2 id="使用参数" tabindex="-1"><a class="header-anchor" href="#使用参数"><span>使用参数</span></a></h2><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ParameterExpression</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nickNameParameter <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Person_</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">,</span> nickNameParameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">TypedQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>nickNameParameter<span class="token punctuation">,</span> <span class="token string">&quot;JD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用jakarta.persistence.criteria.CriteriaBuilder的parameter方法获取参数引用。然后使用参数引用将参数值绑定到jakarta.persistence.Query。</p><h2 id="using-group-by" tabindex="-1"><a class="header-anchor" href="#using-group-by"><span>Using group by</span></a></h2><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaBuilder</span> builder <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> criteria <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Tuple</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

criteria<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> builder<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> tuples <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tuple</span> tuple <span class="token operator">:</span> tuples<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Long</span> count <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> tuple<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="规范" tabindex="-1"><a class="header-anchor" href="#规范"><span>规范</span></a></h1><h3 id="path导航" tabindex="-1"><a class="header-anchor" href="#path导航"><span>path导航</span></a></h3><p>Path实例可以是Root实例、Join实例、通过get导航方法从另一个Path实例派生的Path实例，或者通过使用key或value方法从映射值关联或元素集合派生出的Path实例。</p><p>当执行条件查询时，使用Jakarta Persistence查询语言的路径导航， 等同于 inner join 的语义。也就是说，如果非终端Path实例的值为空，则该路径被认为没有值，并且不参与查询结果的确定。</p><p>get方法用于路径导航。get方法的参数由相应元模型类对应的SingularAttribute或集合值属性（CollectionAttribute、SetAttribute、ListAttribute或MapAttribute）指定。</p><h5 id="示例一" tabindex="-1"><a class="header-anchor" href="#示例一"><span>示例一：</span></a></h5><p>在下面的例子中，<em>ContactInfo</em>是由一个<em>address</em> 和一组<em>Phone</em> 组成的可嵌入类。<em>Phone</em> 是一个实体。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vendor</span><span class="token punctuation">&gt;</span></span> q <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Vendor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> emp <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Join</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContactInfo</span><span class="token punctuation">,</span> <span class="token class-name">Phone</span><span class="token punctuation">&gt;</span></span> phone <span class="token operator">=</span>emp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">Employee_</span><span class="token punctuation">.</span>contactInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">ContactInfo_</span><span class="token punctuation">.</span>phones<span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Employee_</span><span class="token punctuation">.</span>contactInfo<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ContactInfo_</span><span class="token punctuation">.</span>address<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Address_</span><span class="token punctuation">.</span>zipcode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;95054&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>phone<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Phone_</span><span class="token punctuation">.</span>vendor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下Jakarta Persistence查询语言查询是等效的：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>vendor
<span class="token keyword">FROM</span> Employee e <span class="token keyword">JOIN</span> e<span class="token punctuation">.</span>contactInfo<span class="token punctuation">.</span>phones p
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>contactInfo<span class="token punctuation">.</span>address<span class="token punctuation">.</span>zipcode <span class="token operator">=</span> <span class="token string">&#39;95054&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="示例二" tabindex="-1"><a class="header-anchor" href="#示例二"><span>示例二：</span></a></h5><p>在本例中，photos属性对应于map(key=照片标签,value=文件名)。map键是一个字符串，值是一个对象。此查询的结果将作为Tuple对象返回，其元素类型为String和object。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple</span><span class="token punctuation">&gt;</span></span> q <span class="token operator">=</span> cb<span class="token punctuation">.</span><span class="token function">createTupleQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">&gt;</span></span> item <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MapJoin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> photo <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">Item_</span><span class="token punctuation">.</span>photos<span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">multiselect</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Item_</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> photo<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>photo<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;%egret%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下Jakarta Persistence查询语言查询是等效的：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> i<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p
<span class="token keyword">FROM</span> Item i <span class="token keyword">JOIN</span> i<span class="token punctuation">.</span>photos p
<span class="token keyword">WHERE</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">LIKE</span> <span class="token string">&#39;%egret%&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/banrenshan/banrenshan.github.io/edit/main/src/gudie/15-Hibernate.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: CP_zhaozhiqiang@163.com">banrenshan</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/gudie/01-flyway.html" aria-label="flyway指南"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->flyway指南</div></a><a class="route-link nav-link next" href="/gudie/02-jsonassert.html" aria-label="JSONassert指南"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">JSONassert指南<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Brzzz3sI.js" defer></script>
  </body>
</html>
